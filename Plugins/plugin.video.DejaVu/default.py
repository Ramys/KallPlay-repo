import base64;exec base64.b64decode('IyAtKi0gY29kaW5nOiB1dGYtOCAtKi0KaW1wb3J0IHVybGxpYgppbXBvcnQgdXJsbGliMgppbXBvcnQgZGF0ZXRpbWUKaW1wb3J0IHJlCmltcG9ydCBvcwppbXBvcnQgYmFzZTY0CmltcG9ydCB4Ym1jcGx1Z2luCmltcG9ydCB4Ym1jZ3VpCmltcG9ydCB4Ym1jYWRkb24KaW1wb3J0IHhibWN2ZnMKaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgY29va2llbGliCmZyb20gQmVhdXRpZnVsU291cCBpbXBvcnQgQmVhdXRpZnVsU3RvbmVTb3VwLCBCZWF1dGlmdWxTb3VwLCBCZWF1dGlmdWxTT0FQCnRyeToKICAgIGltcG9ydCBqc29uCmV4Y2VwdDoKICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24KaW1wb3J0IHRpbWUKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBfRWRpdAoKTmZsID0gJycKRm9vdGJhbGwgPSAnJwpDcmlja2V0ID0gJycKVGVubmlzID0gJycgCkJveGluZyA9ICcnCkdvbGYgPSAnJwpNb3RvcnNwb3J0cyA9ICcnClJ1Z2J5ID0gJycKSG9ja2V5ID0gJycKTmJhID0gJycKRGFydHMgPSAnJwpXd2UgPSAnJwpIb3JzZV9SYWNpbmcgPSAnJwpVZmMgPSAnJwpCYXNlYmFsbCA9ICcnCgkKcmVzb2x2ZV91cmw9WycxZmljaGllci5jb20nLCAnMjRoZC5iZScsICdhbGxkZWJyaWQuY29tJywgJ2FsbG15dmlkZW9zLm5ldCcsICdhbGx2aWQuY2gnLCAnYXVlbmdpbmUuY29tJywgJ2Jhbmt1cGxvYWQuY29tJywgJ2Jlc3RzdHJlYW1zLm5ldCcsICdicmlza2ZpbGUuY29tJywgJ2Nhc3RhbXAuY29tJywgJ2NsaWNrbnVwbG9hZC5jb20nLCAnY2xpY2tudXBsb2FkLm1lJywgJ2NsaWNrbnVwbG9hZC5saW5rJywgJ2NsaWNrbnVwbG9hZC5vcmcnLCAnY2xvdWR5LmVjJywgJ2Nsb3VkemlsbGEudG8nLCAnY2xvdWR2aWRlby50dicsICduZW9kcml2ZS5jbycsICdjcnVuY2h5cm9sbC5jb20nLCAnZGFjbGlwcy5pbicsICdkYWNsaXBzLmNvbScsICdkYWlseW1vdGlvbi5jb20nLCAnZGl2eHN0YWdlLmV1JywgJ2RpdnhzdGFnZS5uZXQnLCAnZGl2eHN0YWdlLnRvJywgJ2NvdWxkdGltZS50bycsICdlY29zdHJlYW0udHYnLCAnZXhhc2hhcmUuY29tJywgJ2VzdHJlYW0udG8nLCAnZmFjZWJvb2suY29tJywgJ2Zhc3RwbGF5LmNjJywgJ2Zhc3RwbGF5LnRvJywgJ2Zhc3RwbGF5LnN4JywgJ2ZlbWJlZC5jb20nLCAnZmlsZWhvb3QuY29tJywgJ2ZpbGVudWtlLmNvbScsICdmaWxlcHVwLm5ldCcsICdmaWxtc2hvd29ubGluZS5uZXQnLCAnZmxhc2h4LnR2JywgJ3BsdXMuZ29vZ2xlLmNvbScsICdnb29nbGV2aWRlby5jb20nLCAncGljYXNhd2ViLmdvb2dsZS5jb20nLCAnZ29vZ2xldXNlcmNvbnRlbnQuY29tJywgJ2dvb2dsZWRyaXZlLmNvbScsICdnb3JpbGxhdmlkLmluJywgJ2dvcmlsbGF2aWQuY29tJywgJ2dvcmlsbGF2aWQuaW4nLCAnZ291bmxpbWl0ZWQudG8nLCAnZ3JpZnRob3N0LmNvbScsICdodWdlZmlsZXMubmV0JywgJ2lkb3dhdGNoLm5ldCcsICdpbmRhdmlkZW8uaHUnLCAnaXNoYXJlZC5ldScsICdqZXRsb2FkLm5ldCcsICdraW5nZmlsZXMubmV0JywgJ2xldHdhdGNoLnVzJywgJ2xldHdhdGNoLnRvJywgJ3ZpZHNoYXJlLnVzJywgJ21haWwucnUnLCAnbXkubWFpbC5ydScsICd2aWRlb2FwaS5teS5tYWlsLnJ1JywgJ2FwaS52aWRlby5tYWlsLnJ1JywgJ21lZ2EtZGVicmlkLmV1JywgJ21lZ2FtcDQubmV0JywgJ21lcnNhbGFheWl0dGVuLmNvbScsICdtaXhkcm9wLmNvJywgJ21vdmRpdnguY29tJywgJ21vdnBvZC5uZXQnLCAnbW92cG9kLmluJywgJ21vdnNoYXJlLm5ldCcsICd3aG9sZWNsb3VkLm5ldCcsICdtcDRlbmdpbmUuY29tJywgJ21wNHN0cmVhbS5jb20nLCAnbXA0dXBsb2FkLmNvbScsICdteXZpZHN0cmVhbS5uZXQnLCAnbm9zdmlkZW8uY29tJywgJ25vc2xvY2tlci5jb20nLCAnYXVyb3JhdmlkLnRvJywgJ25vdmFtb3YuY29tJywgJ25vd3ZpZGVvLnN4JywgJ25vd3ZpZGVvLmV1JywgJ25vd3ZpZGVvLmNoJywgJ25vd3ZpZGVvLnN4JywgJ25vd3ZpZGVvLmNvJywgJ25vd3ZpZGVvLmxpJywgJ25vd3ZpZGVvLmVjJywgJ25vd3ZpZGVvLmF0JywgJ25vd3ZpZGVvLmZvJywgJ29rLnJ1JywgJ29kbm9rbGFzc25pa2kucnUnLCAnb25seXN0cmVhbS50dicsICdvcGVubG9hZC5jbycsICdwbGF5NDQubmV0JywgJ3BsYXllZC50bycsICdwbGF5aGQudmlkZW8nLCAncGxheWhkLmZvJywgJ3BsYXl1Lm5ldCcsICdwbGF5dS5tZScsICdwbGF5d2lyZS5jb20nLCAnUHJlbWl1bWl6ZS5tZScsICdwcmltZXNoYXJlLnR2JywgJ3Byb21wdGZpbGUuY29tJywgJ3B1cmV2aWQuY29tJywgJ3JhcGlkdmlkZW8ud3MnLCAncmFwaWR2aWRlby5jb20nLCAncmcudG8nLCAncmFwaWRnYXRvci5uZXQnLCAnYXBpLnJlYWwtZGVicmlkLmNvbScsICdwcmVtaXVtLnJwbmV0LmJpeicsICdydXR1YmUucnUnLCAnc2hhcmVkMi5tZScsICdzaGFyZWQuc3gnLCAnc2hhcmVyZXBvLmNvbScsICdzaGFyZXNpeC5jb20nLCAnc2ltcGx5LWRlYnJpZC5jb20nLCAnc3BlZWRwbGF5Lnh5eicsICdzcGVlZHBsYXkudXMnLCAnc3BlZWRwbGF5My5wdycsICdzcGVlZHZpZGVvLm5ldCcsICdzdGFnZXZ1LmNvbScsICdzdHJlYW1jbG91ZC5ldScsICdzdHJlYW1pbi50bycsICdzdHJlYW0ubW9lJywgJ3N0cmVhbWFuZ28uY29tJywgJ3N0cmVhbWNoZXJyeS5jb20nLCAndGVyYW1peGVyLmNvbScsICd0aGV2aWRlby5tZScsICd0aGV2aWQubmV0JywgJ3RoZXZpZGVvcy50dicsICd0b2x0c2QtZmVsLnRrJywgJ3Ryb2xsdmlkLm5ldCcsICd0dW5lLnBrJywgJ3R1cmJvYml0Lm5ldCcsICd0dXNmaWxlcy5uZXQnLCAndHdpdGNoLnR2JywgJ3VwMnN0cmVhbS5jb20nLCAndXBsb2FkLmFmJywgJ3VwbG9hZGMuY29tJywgJ3VwbG9hZGMuY2gnLCAnemFsYWEuY29tJywgJ3VwbG9hZHgub3JnJywgJ3VwdG9ib3guY29tJywgJ3VwdG9zdHJlYW0uY29tJywgJ3VzZXJmaWxlcy5jb20nLCAndXNlcnNjbG91ZC5jb20nLCAndmVlaGQuY29tJywgJ3Zlb2guY29tJywgJ3ZpZC5hZycsICd2aWRidWxsLmNvbScsICd2aWRjcmF6eS5uZXQnLCAndXBsb2FkY3JhenkubmV0JywgJ3RoZXZpZGVvYmVlLnRvJywgJ3ZpZGVvYm94ZXIuY28nLCAndmlkZ2cudG8nLCAndmlkLmdnJywgJ3ZpZGVvaHV0LnRvJywgJ3ZpZGVvbWVnYS50dicsICd2aWRlb3Jhai50bycsICd2aWRlb3Jldi5jYycsICd2aWRlb3NreS50bycsICd2aWRlby50dCcsICd2aWRlb3dlZWQuZXMnLCAnYml0dmlkLnN4JywgJ3ZpZGVvd2VlZC5jb20nLCAndmlkZW93b29kLnR2JywgJ2J5em9vLm9yZycsICdwbGF5cGFuZGEubmV0JywgJ3ZpZGVvem9vLm1lJywgJ3ZpZGVvd2luZy5tZScsICd2aWRlb3dpbmcubWUnLCAnZWFzeXZpZGVvLm1lJywgJ3BsYXk0NC5uZXQnLCAncGxheWJiLm1lJywgJ3ZlcnlzdHJlYW0uY29tJywgJ3ZpZGVvNDQubmV0JywgJ3ZpZGlvLnN4JywgJ3ZpZGxveC5tZScsICd2aWRvemEubmV0JywgJ3ZpZC5tZScsICd2aWRzcG90Lm5ldCcsICd2aWR0by5tZScsICd2aWR1cC5tZScsICd2aWR1cC5vcmcnLCAndmlkemkudHYnLCAndmltZW8uY29tJywgJ3Zpdm8uc3gnLCAndmsuY29tJywgJ3ZrcGFzcy5jb20nLCAndm9kbG9ja2VyLmNvbScsICd2c2hhcmUuaW8nLCAndnNoYXJlLmV1JywgJ3dhdGNoZXJzLnRvJywgJ3dhdGNob25saW5lLnRvJywgJ3dhdGNodmlkZW8udXMnLCAnd2F0Y2h2aWRlbzIudXMnLCAnd2F0Y2h2aWRlbzMudXMnLCAnd2F0Y2h2aWRlbzQudXMnLCAnd2F0Y2h2aWRlbzUudXMnLCAnd2F0Y2h2aWRlbzYudXMnLCAnd2F0Y2h2aWRlbzcudXMnLCAnd2F0Y2h2aWRlbzgudXMnLCAnd2F0Y2h2aWRlbzkudXMnLCAnd2VzaGFyZS5tZScsICd4dmlkc3RhZ2UuY29tJywgJ3lvdWxvbC5iaXonLCAnc2hpdG1vdmllLmNvbScsICd5b3VydXBsb2FkLmNvbScsICd5b3V0dWJlLmNvbScsICd5b3V0dS5iZScsICd5b3V3YXRjaC5vcmcnLCAnYXBpLnpldmVyYS5jb20nLCAnemV0dGFob3N0LnR2JywgJ3pzdHJlYW0udG8nXQpnX2lnbm9yZVNldFJlc29sdmVkPVsncGx1Z2luLnZpZGVvLmRyYW1hc29ubGluZScsJ3BsdWdpbi52aWRlby5mNG1UZXN0ZXInLCdwbHVnaW4udmlkZW8uc2hhaGlkbWJjbmV0JywncGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsJywncGx1Z2luLnN0cmVhbS52YXVnaG5saXZlLnR2JywncGx1Z2luLnZpZGVvLlplbVRWLXNoYW5pJ10KCmNsYXNzIE5vUmVkaXJlY3Rpb24odXJsbGliMi5IVFRQRXJyb3JQcm9jZXNzb3IpOgogICBkZWYgaHR0cF9yZXNwb25zZShzZWxmLCByZXF1ZXN0LCByZXNwb25zZSk6CiAgICAgICByZXR1cm4gcmVzcG9uc2UKICAgaHR0cHNfcmVzcG9uc2UgPSBodHRwX3Jlc3BvbnNlCiAgICAgICAKYWRkb24gPSBfRWRpdC5hZGRvbgphZGRvbl92ZXJzaW9uID0gYWRkb24uZ2V0QWRkb25JbmZvKCd2ZXJzaW9uJykKcHJvZmlsZSA9IHhibWMudHJhbnNsYXRlUGF0aChhZGRvbi5nZXRBZGRvbkluZm8oJ3Byb2ZpbGUnKS5kZWNvZGUoJ3V0Zi04JykpCmhvbWUgPSB4Ym1jLnRyYW5zbGF0ZVBhdGgoYWRkb24uZ2V0QWRkb25JbmZvKCdwYXRoJykuZGVjb2RlKCd1dGYtOCcpKQpmYXZvcml0ZXMgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2Zhdm9yaXRlcycpCmhpc3RvcnkgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ2hpc3RvcnknKQoKUkVWID0gb3MucGF0aC5qb2luKHByb2ZpbGUsICdsaXN0X3JldmlzaW9uJykKaWNvbiA9IG9zLnBhdGguam9pbihob21lLCAnaWNvbi5wbmcnKQpGQU5BUlQgPSBvcy5wYXRoLmpvaW4oaG9tZSwgJ2ZhbmFydC5qcGcnKQpzb3VyY2VfZmlsZSA9IG9zLnBhdGguam9pbihwcm9maWxlLCAnc291cmNlX2ZpbGUnKQpmdW5jdGlvbnNfZGlyID0gcHJvZmlsZQpkZWJ1ZyA9IGFkZG9uLmdldFNldHRpbmcoJ2RlYnVnJykKaWYgb3MucGF0aC5leGlzdHMoZmF2b3JpdGVzKT09VHJ1ZToKICAgIEZBViA9IG9wZW4oZmF2b3JpdGVzKS5yZWFkKCkKZWxzZTogRkFWID0gW10KaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOgogICAgU09VUkNFUyA9IG9wZW4oc291cmNlX2ZpbGUpLnJlYWQoKQplbHNlOiBTT1VSQ0VTID0gW10KCgpkZWYgYWRkb25fbG9nKHN0cmluZyk6CiAgICBpZiBkZWJ1ZyA9PSAndHJ1ZSc6CiAgICAgICAgeGJtYy5sb2coIlthZGRvbi5saXZlLkRlamFWdSBMaXN0cy0lc106ICVzIiAlKGFkZG9uX3ZlcnNpb24sIHN0cmluZykpCgoKZGVmIG1ha2VSZXF1ZXN0KHVybCwgaGVhZGVycz1Ob25lKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIGhlYWRlcnMgaXMgTm9uZToKICAgICAgICAgICAgICAgIGhlYWRlcnMgPSB7J1VzZXItYWdlbnQnIDogJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgV09XNjQ7IHJ2OjE5LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTkuMCd9CiAgICAgICAgICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdCh1cmwsTm9uZSxoZWFkZXJzKQogICAgICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEpCiAgICAgICAgICAgIGRhdGEgPSByZXNwb25zZS5yZWFkKCkKICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQogICAgICAgICAgICByZXR1cm4gZGF0YQogICAgICAgIGV4Y2VwdCB1cmxsaWIyLlVSTEVycm9yLCBlOgogICAgICAgICAgICBhZGRvbl9sb2coJ1VSTDogJyt1cmwpCiAgICAgICAgICAgIGlmIGhhc2F0dHIoZSwgJ2NvZGUnKToKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnV2UgZmFpbGVkIHdpdGggZXJyb3IgY29kZSAtICVzLicgJSBlLmNvZGUpCiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihEZWphVnUsV2UgZmFpbGVkIHdpdGggZXJyb3IgY29kZSAtICIrc3RyKGUuY29kZSkrIiwxMDAwMCwiK2ljb24rIikiKQogICAgICAgICAgICBlbGlmIGhhc2F0dHIoZSwgJ3JlYXNvbicpOgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdXZSBmYWlsZWQgdG8gcmVhY2ggYSBzZXJ2ZXIuJykKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnUmVhc29uOiAlcycgJWUucmVhc29uKQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRGVqYVZ1LFdlIGZhaWxlZCB0byByZWFjaCBhIHNlcnZlci4gLSAiK3N0cihlLnJlYXNvbikrIiwxMDAwMCwiK2ljb24rIikiKQoKCQkJCQpkZWYgU0tpbmRleCgpOgogICAgYWRkb25fbG9nKCJTS2luZGV4IikKICAgIGdldERhdGEoX0VkaXQuTWFpbkJhc2UsJycpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgkJCmRlZiBPcGVuX1VybCh1cmwpOgogICAgcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCkKICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzOyBVOyBXaW5kb3dzIE5UIDUuMTsgZW4tR0I7IHJ2OjEuOS4wLjMpIEdlY2tvLzIwMDgwOTI0MTcgRmlyZWZveC8zLjAuMycpCiAgICByZXNwb25zZSA9ICcnCiAgICBsaW5rID0gJycKICAgIHRyeTogCiAgICAgICAgcmVzcG9uc2UgPSB1cmxsaWIyLnVybG9wZW4ocmVxKQogICAgICAgIGxpbms9cmVzcG9uc2UucmVhZCgpCiAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQogICAgZXhjZXB0OiBwYXNzCiAgICBpZiBsaW5rICE9ICcnOgogICAgICAgIHJldHVybiBsaW5rCiAgICBlbHNlOgogICAgICAgIGxpbmsgPSAnT3BlbmVkJwogICAgICAgIHJldHVybiBsaW5rCgkKZGVmIFNlYXJjaF9pbnB1dCh1cmwpOgogICAgRGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQogICAgU2VhcmNoX3RpdGxlID0gRGlhbG9nLmlucHV0KCdTZWFyY2gnLCB0eXBlPXhibWNndWkuSU5QVVRfQUxQSEFOVU0pCiAgICBTZWFyY2hfbmFtZSA9IFNlYXJjaF90aXRsZS5sb3dlcigpCiAgICBpZiBTZWFyY2hfbmFtZSA9PSAnJzoKICAgICAgICBwYXNzCiAgICBlbHNlOgogICAgICAgIFNlYXJjaF9sb29wKFNlYXJjaF9uYW1lLHVybCkgICAgCgkKZGVmIFNlYXJjaF9sb29wKFNlYXJjaF9uYW1lLHVybCk6CiAgICBIVE1MID0gT3Blbl9VcmwodXJsKQogICAgaWYgSFRNTCAhPSAnRmFpbGVkJzoKICAgICAgICBtYXRjaCA9IHJlLmNvbXBpbGUoJzxjaGFubmVsPi4rPzxuYW1lPiguKz8pPC9uYW1lPi4rPzx0aHVtYm5haWw+KC4rPyk8L3RodW1ibmFpbD4uKz88ZXh0ZXJuYWxsaW5rPiguKz8pPC9leHRlcm5hbGxpbms+Lis/PGZhbmFydD4oLis/KTwvZmFuYXJ0Pi4rPzwvY2hhbm5lbD4nLHJlLkRPVEFMTCkuZmluZGFsbChIVE1MKQogICAgICAgIGZvciBuYW1lLGltYWdlLHVybCxmYW5hcnQgaW4gbWF0Y2g6CiAgICAgICAgICAgIGlmIG5vdCAnaHR0cDonIGluIHVybDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIFNlYXJjaF9sb29wKFNlYXJjaF9uYW1lLHVybCkKICAgICAgICBtYXRjaDIgPSByZS5jb21waWxlKCc8dGl0bGU+KC4rPyk8L3RpdGxlPi4rPzxsaW5rPiguKz8pPC9saW5rPi4rPzx0aHVtYm5haWw+KC4rPyk8L3RodW1ibmFpbD4uKz88ZmFuYXJ0PiguKz8pPC9mYW5hcnQ+JyxyZS5ET1RBTEwpLmZpbmRhbGwoSFRNTCkKICAgICAgICBmb3IgbmFtZSx1cmwsaW1hZ2UsZmFuYXJ0IGluIG1hdGNoMjoKICAgICAgICAgICAgaWYgJ2h0dHA6JyBpbiB1cmw6CiAgICAgICAgICAgICAgICBpZiBTZWFyY2hfbmFtZS5sb3dlcigpIGluIG5hbWUubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCwgbmFtZSxpbWFnZSxmYW5hcnQsJycsJycsJycsJycsTm9uZSwnJywxKQoJCQoJCQpkZWYgZ2V0U291cmNlcygpOgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcykgPT0gVHJ1ZToKICAgICAgICAgICAgYWRkRGlyKCdGYXZvcml0ZXMnLCd1cmwnLDQsb3MucGF0aC5qb2luKGhvbWUsICdyZXNvdXJjZXMnLCAnZmF2b3JpdGUucG5nJyksRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoImJyb3dzZV94bWxfZGF0YWJhc2UiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgIGFkZERpcignWE1MIERhdGFiYXNlJywnaHR0cDovL3hibWNwbHVzLnhiLmZ1bnBpYy5kZS93d3ctZGF0YS9maWxlc3lzdGVtLycsMTUsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygiYnJvd3NlX2NvbW11bml0eSIpID09ICJ0cnVlIjoKICAgICAgICAgICAgYWRkRGlyKCdDb21tdW5pdHkgRmlsZXMnLCdjb21tdW5pdHlfZmlsZXMnLDE2LGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGhpc3RvcnkpID09IFRydWU6CiAgICAgICAgICAgIGFkZERpcignU2VhcmNoIEhpc3RvcnknLCdoaXN0b3J5JywyNSxvcy5wYXRoLmpvaW4oaG9tZSwgJ3Jlc291cmNlcycsICdmYXZvcml0ZS5wbmcnKSxGQU5BUlQsJycsJycsJycsJycpCiAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygic2VhcmNoeXQiKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgIGFkZERpcignU2VhcmNoOllvdXR1YmUnLCd5b3V0dWJlJywyNSxpY29uLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJzZWFyY2hETSIpID09ICJ0cnVlIjoKICAgICAgICAgICAgYWRkRGlyKCdTZWFyY2g6ZGFpbHltb3Rpb24nLCdkbW90aW9uJywyNSxpY29uLEZBTkFSVCwnJywnJywnJywnJykKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCJQdWxzYXJNIikgPT0gInRydWUiOgogICAgICAgICAgICBhZGREaXIoJ1B1bHNhcjpJTURCJywnSU1EQmlkcGxheScsMjcsaWNvbixGQU5BUlQsJycsJycsJycsJycpICAgICAgICAgICAgCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoc291cmNlX2ZpbGUpPT1UcnVlOgogICAgICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQogICAgICAgICAgICAjcHJpbnQgJ3NvdXJjZXMnLHNvdXJjZXMKICAgICAgICAgICAgaWYgbGVuKHNvdXJjZXMpID4gMToKICAgICAgICAgICAgICAgIGZvciBpIGluIHNvdXJjZXM6CiAgICAgICAgICAgICAgICAgICAgIyMgZm9yIHByZSAxLjAuOCBzb3VyY2VzCiAgICAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShpLCBsaXN0KToKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKGlbMF0uZW5jb2RlKCd1dGYtOCcpLGlbMV0uZW5jb2RlKCd1dGYtOCcpLDEsaWNvbixGQU5BUlQsJycsJycsJycsJycsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgdGh1bWIgPSBpY29uCiAgICAgICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IEZBTkFSVAogICAgICAgICAgICAgICAgICAgICAgICBkZXNjID0gJycKICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZSA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJwogICAgICAgICAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgndGh1bWJuYWlsJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHVtYiA9IGlbJ3RodW1ibmFpbCddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5hcnQgPSBpWydmYW5hcnQnXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2Rlc2NyaXB0aW9uJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjID0gaVsnZGVzY3JpcHRpb24nXQogICAgICAgICAgICAgICAgICAgICAgICBpZiBpLmhhc19rZXkoJ2RhdGUnKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGUgPSBpWydkYXRlJ10KICAgICAgICAgICAgICAgICAgICAgICAgaWYgaS5oYXNfa2V5KCdnZW5yZScpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBpWydnZW5yZSddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGkuaGFzX2tleSgnY3JlZGl0cycpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9IGlbJ2NyZWRpdHMnXQogICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIoaVsndGl0bGUnXS5lbmNvZGUoJ3V0Zi04JyksaVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpLDEsdGh1bWIsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSxjcmVkaXRzLCdzb3VyY2UnKQoKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIGxlbihzb3VyY2VzKSA9PSAxOgogICAgICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uoc291cmNlc1swXSwgbGlzdCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGdldERhdGEoc291cmNlc1swXVsxXS5lbmNvZGUoJ3V0Zi04JyksRkFOQVJUKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGdldERhdGEoc291cmNlc1swXVsndXJsJ10sIHNvdXJjZXNbMF1bJ2ZhbmFydCddKQoKCmRlZiBhZGRTb3VyY2UodXJsPU5vbmUpOgogICAgICAgIGlmIHVybCBpcyBOb25lOgogICAgICAgICAgICBpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X2ZpbGVfc291cmNlIikgPT0gIiI6CiAgICAgICAgICAgICAgIHNvdXJjZV91cmwgPSBhZGRvbi5nZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnKS5kZWNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgZWxpZiBub3QgYWRkb24uZ2V0U2V0dGluZygibmV3X3VybF9zb3VyY2UiKSA9PSAiIjoKICAgICAgICAgICAgICAgc291cmNlX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ25ld191cmxfc291cmNlJykuZGVjb2RlKCd1dGYtOCcpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc291cmNlX3VybCA9IHVybAogICAgICAgIGlmIHNvdXJjZV91cmwgPT0gJycgb3Igc291cmNlX3VybCBpcyBOb25lOgogICAgICAgICAgICByZXR1cm4KICAgICAgICBhZGRvbl9sb2coJ0FkZGluZyBOZXcgU291cmNlOiAnK3NvdXJjZV91cmwuZW5jb2RlKCd1dGYtOCcpKQoKICAgICAgICBtZWRpYV9pbmZvID0gTm9uZQogICAgICAgICNwcmludCAnc291cmNlX3VybCcsc291cmNlX3VybAogICAgICAgIGRhdGEgPSBnZXRTb3VwKHNvdXJjZV91cmwpCiAgICAgICAgcHJpbnQgJ3NvdXJjZV91cmwnLHNvdXJjZV91cmwKICAgICAgICBpZiBpc2luc3RhbmNlKGRhdGEsQmVhdXRpZnVsU09BUCk6CiAgICAgICAgICAgIGlmIGRhdGEuZmluZCgnY2hhbm5lbHNfaW5mbycpOgogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuY2hhbm5lbHNfaW5mbwogICAgICAgICAgICBlbGlmIGRhdGEuZmluZCgnaXRlbXNfaW5mbycpOgogICAgICAgICAgICAgICAgbWVkaWFfaW5mbyA9IGRhdGEuaXRlbXNfaW5mbwogICAgICAgIGlmIG1lZGlhX2luZm86CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYSA9IHt9CiAgICAgICAgICAgIHNvdXJjZV9tZWRpYVsndXJsJ10gPSBzb3VyY2VfdXJsCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aXRsZSddID0gbWVkaWFfaW5mby50aXRsZS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIHRyeTogc291cmNlX21lZGlhWyd0aHVtYm5haWwnXSA9IG1lZGlhX2luZm8udGh1bWJuYWlsLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2ZhbmFydCddID0gbWVkaWFfaW5mby5mYW5hcnQuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZ2VucmUnXSA9IG1lZGlhX2luZm8uZ2VucmUuc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGVzY3JpcHRpb24nXSA9IG1lZGlhX2luZm8uZGVzY3JpcHRpb24uc3RyaW5nCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICB0cnk6IHNvdXJjZV9tZWRpYVsnZGF0ZSddID0gbWVkaWFfaW5mby5kYXRlLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgdHJ5OiBzb3VyY2VfbWVkaWFbJ2NyZWRpdHMnXSA9IG1lZGlhX2luZm8uY3JlZGl0cy5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgJy8nIGluIHNvdXJjZV91cmw6CiAgICAgICAgICAgICAgICBuYW1lU3RyID0gc291cmNlX3VybC5zcGxpdCgnLycpWy0xXS5zcGxpdCgnLicpWzBdCiAgICAgICAgICAgIGlmICdcXCcgaW4gc291cmNlX3VybDoKICAgICAgICAgICAgICAgIG5hbWVTdHIgPSBzb3VyY2VfdXJsLnNwbGl0KCdcXCcpWy0xXS5zcGxpdCgnLicpWzBdCiAgICAgICAgICAgIGlmICclJyBpbiBuYW1lU3RyOgogICAgICAgICAgICAgICAgbmFtZVN0ciA9IHVybGxpYi51bnF1b3RlX3BsdXMobmFtZVN0cikKICAgICAgICAgICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKG5hbWVTdHIsJ0Rpc3BsYXllZCBOYW1lLCBSZW5hbWU/JykKICAgICAgICAgICAga2V5Ym9hcmQuZG9Nb2RhbCgpCiAgICAgICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBuZXdTdHIgPSBrZXlib2FyZC5nZXRUZXh0KCkKICAgICAgICAgICAgaWYgbGVuKG5ld1N0cikgPT0gMDoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBzb3VyY2VfbWVkaWEgPSB7fQogICAgICAgICAgICBzb3VyY2VfbWVkaWFbJ3RpdGxlJ10gPSBuZXdTdHIKICAgICAgICAgICAgc291cmNlX21lZGlhWyd1cmwnXSA9IHNvdXJjZV91cmwKICAgICAgICAgICAgc291cmNlX21lZGlhWydmYW5hcnQnXSA9IGZhbmFydAoKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PUZhbHNlOgogICAgICAgICAgICBzb3VyY2VfbGlzdCA9IFtdCiAgICAgICAgICAgIHNvdXJjZV9saXN0LmFwcGVuZChzb3VyY2VfbWVkaWEpCiAgICAgICAgICAgIGIgPSBvcGVuKHNvdXJjZV9maWxlLCJ3IikKICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZV9saXN0KSkKICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc291cmNlcyA9IGpzb24ubG9hZHMob3Blbihzb3VyY2VfZmlsZSwiciIpLnJlYWQoKSkKICAgICAgICAgICAgc291cmNlcy5hcHBlbmQoc291cmNlX21lZGlhKQogICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkKICAgICAgICAgICAgYi5jbG9zZSgpCiAgICAgICAgYWRkb24uc2V0U2V0dGluZygnbmV3X3VybF9zb3VyY2UnLCAiIikKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCduZXdfZmlsZV9zb3VyY2UnLCAiIikKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLk5vdGlmaWNhdGlvbihEZWphVnUsTmV3IHNvdXJjZSBhZGRlZC4sNTAwMCwiK2ljb24rIikiKQogICAgICAgIGlmIG5vdCB1cmwgaXMgTm9uZToKICAgICAgICAgICAgaWYgJ3hibWNwbHVzLnhiLmZ1bnBpYy5kZScgaW4gdXJsOgogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuVXBkYXRlKCVzP21vZGU9MTQscmVwbGFjZSkiICVzeXMuYXJndlswXSkKICAgICAgICAgICAgZWxpZiAnY29tbXVuaXR5LWxpbmtzJyBpbiB1cmw6CiAgICAgICAgICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCJYQk1DLkNvbnRhaW5lci5VcGRhdGUoJXM/bW9kZT0xMCxyZXBsYWNlKSIgJXN5cy5hcmd2WzBdKQogICAgICAgIGVsc2U6IGFkZG9uLm9wZW5TZXR0aW5ncygpCgkKCmRlZiBybVNvdXJjZShuYW1lKToKICAgICAgICBzb3VyY2VzID0ganNvbi5sb2FkcyhvcGVuKHNvdXJjZV9maWxlLCJyIikucmVhZCgpKQogICAgICAgIGZvciBpbmRleCBpbiByYW5nZShsZW4oc291cmNlcykpOgogICAgICAgICAgICBpZiBpc2luc3RhbmNlKHNvdXJjZXNbaW5kZXhdLCBsaXN0KToKICAgICAgICAgICAgICAgIGlmIHNvdXJjZXNbaW5kZXhdWzBdID09IG5hbWU6CiAgICAgICAgICAgICAgICAgICAgZGVsIHNvdXJjZXNbaW5kZXhdCiAgICAgICAgICAgICAgICAgICAgYiA9IG9wZW4oc291cmNlX2ZpbGUsInciKQogICAgICAgICAgICAgICAgICAgIGIud3JpdGUoanNvbi5kdW1wcyhzb3VyY2VzKSkKICAgICAgICAgICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgc291cmNlc1tpbmRleF1bJ3RpdGxlJ10gPT0gbmFtZToKICAgICAgICAgICAgICAgICAgICBkZWwgc291cmNlc1tpbmRleF0KICAgICAgICAgICAgICAgICAgICBiID0gb3Blbihzb3VyY2VfZmlsZSwidyIpCiAgICAgICAgICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKHNvdXJjZXMpKQogICAgICAgICAgICAgICAgICAgIGIuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuUmVmcmVzaCIpCgoKCmRlZiBnZXRfeG1sX2RhdGFiYXNlKHVybCwgYnJvd3NlPUZhbHNlKToKICAgICAgICBpZiB1cmwgaXMgTm9uZToKICAgICAgICAgICAgdXJsID0gJ2h0dHA6Ly94Ym1jcGx1cy54Yi5mdW5waWMuZGUvd3d3LWRhdGEvZmlsZXN5c3RlbS8nCiAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAobWFrZVJlcXVlc3QodXJsKSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFNvdXAuSFRNTF9FTlRJVElFUykKICAgICAgICBmb3IgaSBpbiBzb3VwKCdhJyk6CiAgICAgICAgICAgIGhyZWYgPSBpWydocmVmJ10KICAgICAgICAgICAgaWYgbm90IGhyZWYuc3RhcnRzd2l0aCgnPycpOgogICAgICAgICAgICAgICAgbmFtZSA9IGkuc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBuYW1lIG5vdCBpbiBbJ1BhcmVudCBEaXJlY3RvcnknLCAncmVjeWNsZV9iaW4vJ106CiAgICAgICAgICAgICAgICAgICAgaWYgaHJlZi5lbmRzd2l0aCgnLycpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBicm93c2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxNSxpY29uLGZhbmFydCwnJywnJywnJykKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDE0LGljb24sZmFuYXJ0LCcnLCcnLCcnKQogICAgICAgICAgICAgICAgICAgIGVsaWYgaHJlZi5lbmRzd2l0aCgnLnhtbCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBicm93c2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwraHJlZiwxLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzb3VyY2VfZmlsZSk9PVRydWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbmFtZSBpbiBTT1VSQ0VTOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZSsnIChpbiB1c2UpJyx1cmwraHJlZiwxMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHVybCtocmVmLDExLGljb24sZmFuYXJ0LCcnLCcnLCcnLCcnLCdkb3dubG9hZCcpCgoKZGVmIGdldENvbW11bml0eVNvdXJjZXMoYnJvd3NlPUZhbHNlKToKICAgICAgICB1cmwgPSAnaHR0cDovL2NvbW11bml0eS1saW5rcy5nb29nbGVjb2RlLmNvbS9zdm4vdHJ1bmsvJwogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKG1ha2VSZXF1ZXN0KHVybCksIGNvbnZlcnRFbnRpdGllcz1CZWF1dGlmdWxTb3VwLkhUTUxfRU5USVRJRVMpCiAgICAgICAgZmlsZXMgPSBzb3VwKCd1bCcpWzBdKCdsaScpWzE6XQogICAgICAgIGZvciBpIGluIGZpbGVzOgogICAgICAgICAgICBuYW1lID0gaSgnYScpWzBdWydocmVmJ10KICAgICAgICAgICAgaWYgYnJvd3NlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK25hbWUsMSxpY29uLGZhbmFydCwnJywnJywnJywnJywnZG93bmxvYWQnKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsK25hbWUsMTEsaWNvbixmYW5hcnQsJycsJycsJycsJycsJ2Rvd25sb2FkJykKCgpkZWYgZ2V0U291cCh1cmwsZGF0YT1Ob25lKToKICAgICAgICBwcmludCAnZ2V0c291cCcsdXJsLGRhdGEKICAgICAgICBpZiB1cmwuc3RhcnRzd2l0aCgnaHR0cDovLycpIG9yIHVybC5zdGFydHN3aXRoKCdodHRwczovLycpOgogICAgICAgICAgICBkYXRhID0gbWFrZVJlcXVlc3QodXJsKQogICAgICAgICAgICBpZiByZS5zZWFyY2goIiNFWFRNM1UiLGRhdGEpIG9yICdtM3UnIGluIHVybDogCiAgICAgICAgICAgICAgICBwcmludCAnZm91bmQgbTN1IGRhdGEnLGRhdGEKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhCiAgICAgICAgICAgICAgICAKICAgICAgICBlbGlmIGRhdGEgPT0gTm9uZToKICAgICAgICAgICAgaWYgeGJtY3Zmcy5leGlzdHModXJsKToKICAgICAgICAgICAgICAgIGlmIHVybC5zdGFydHN3aXRoKCJzbWI6Ly8iKSBvciB1cmwuc3RhcnRzd2l0aCgibmZzOi8vIik6CiAgICAgICAgICAgICAgICAgICAgY29weSA9IHhibWN2ZnMuY29weSh1cmwsIG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpKQogICAgICAgICAgICAgICAgICAgIGlmIGNvcHk6CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBvcGVuKG9zLnBhdGguam9pbihwcm9maWxlLCAndGVtcCcsICdzb3JjZV90ZW1wLnR4dCcpLCAiciIpLnJlYWQoKQogICAgICAgICAgICAgICAgICAgICAgICB4Ym1jdmZzLmRlbGV0ZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3RlbXAnLCAnc29yY2VfdGVtcC50eHQnKSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coImZhaWxlZCB0byBjb3B5IGZyb20gc21iOiIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGRhdGEgPSBvcGVuKHVybCwgJ3InKS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICBpZiByZS5tYXRjaCgiI0VYVE0zVSIsZGF0YSlvciAnbTN1JyBpbiB1cmw6IAogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnZm91bmQgbTN1IGRhdGEnLGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiU291cCBEYXRhIG5vdCBmb3VuZCEiKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgcmV0dXJuIEJlYXV0aWZ1bFNPQVAoZGF0YSwgY29udmVydEVudGl0aWVzPUJlYXV0aWZ1bFN0b25lU291cC5YTUxfRU5USVRJRVMpCgoKZGVmIGdldERhdGEodXJsLGZhbmFydCk6CiAgICBwcmludCAndXJsLWdldERhdGEnLHVybAogICAgU2V0Vmlld0xheW91dCA9ICJMaXN0IgogICAgIAogICAgc291cCA9IGdldFNvdXAodXJsKQogICAgI3ByaW50IHR5cGUoc291cCkKICAgIGlmIGlzaW5zdGFuY2Uoc291cCxCZWF1dGlmdWxTT0FQKToKICAgICAgICBpZiBsZW4oc291cCgnbGF5b3V0eXBlJykpID4gMDoKICAgICAgICAgICAgU2V0Vmlld0xheW91dCA9ICJUaHVtYm5haWwiCQkgICAgCgogICAgICAgIGlmIGxlbihzb3VwKCdjaGFubmVscycpKSA+IDA6CiAgICAgICAgICAgIGNoYW5uZWxzID0gc291cCgnY2hhbm5lbCcpCiAgICAgICAgICAgIGZvciBjaGFubmVsIGluIGNoYW5uZWxzOgojICAgICAgICAgICAgICAgIHByaW50IGNoYW5uZWwKCiAgICAgICAgICAgICAgICBsaW5rZWRVcmw9JycKICAgICAgICAgICAgICAgIGxjb3VudD0wCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgbGlua2VkVXJsID0gIGNoYW5uZWwoJ2V4dGVybmFsbGluaycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGxjb3VudD1sZW4oY2hhbm5lbCgnZXh0ZXJuYWxsaW5rJykpCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgICAgICNwcmludCAnbGlua2VkVXJsJyxsaW5rZWRVcmwsbGNvdW50CiAgICAgICAgICAgICAgICBpZiBsY291bnQ+MTogbGlua2VkVXJsPScnCgogICAgICAgICAgICAgICAgbmFtZSA9IGNoYW5uZWwoJ25hbWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IGNoYW5uZWwoJ3RodW1ibmFpbCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgdGh1bWJuYWlsID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNoYW5uZWwoJ2ZhbmFydCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGNoYW5uZWwoJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBkZXNjID0gY2hhbm5lbCgnaW5mbycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGRlc2MgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBkZXNjID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSBjaGFubmVsKCdnZW5yZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgZ2VucmUgPSAnJwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBkYXRlID0gY2hhbm5lbCgnZGF0ZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgIGlmIGRhdGUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBkYXRlID0gJycKCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9IGNoYW5uZWwoJ2NyZWRpdHMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICBpZiBjcmVkaXRzID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgY3JlZGl0cyA9ICcnCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIGxpbmtlZFVybD09Jyc6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdXJsLmVuY29kZSgndXRmLTgnKSwyLHRodW1ibmFpbCxmYW5BcnQsZGVzYyxnZW5yZSxkYXRlLGNyZWRpdHMsVHJ1ZSkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBuYW1lID09ICdbQ09MT1IgcmVkXUxpdmUgU3BvcnRbL0NPTE9SXSc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGREaXIobmFtZS5lbmNvZGUoJ3V0Zi04JyksbGlua2VkVXJsLmVuY29kZSgndXRmLTgnKSwzMSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgoJCQkJCQkgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLGxpbmtlZFVybC5lbmNvZGUoJ3V0Zi04JyksMSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxOb25lLCdzb3VyY2UnKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygnVGhlcmUgd2FzIGEgcHJvYmxlbSBhZGRpbmcgZGlyZWN0b3J5IGZyb20gZ2V0RGF0YSgpOiAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICBlbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coJ05vIENoYW5uZWxzOiBnZXRJdGVtcycpCiAgICAgICAgICAgIGdldEl0ZW1zKHNvdXAoJ2l0ZW0nKSxmYW5hcnQpCiAgICBlbHNlOgogICAgICAgIHBhcnNlX20zdShzb3VwKQoKICAgIGlmIFNldFZpZXdMYXlvdXQgPT0gIlRodW1ibmFpbCI6CiAgICAgICBTZXRWaWV3VGh1bWJuYWlsKCkKCSAgIApkZWYgV2l6SERNZW51KHVybCxpY29uaW1hZ2UsZmFuYXJ0KToKCWFkZERpcignRGVqYVZ1UGxheWxpc3RlZCcsdXJsLDEsaWNvbmltYWdlLGZhbmFydCwnJywnJywnJyxOb25lLCdzb3VyY2UnKQoJaHRtbCA9IHJlcXVlc3RzLmdldCgnaHR0cDovL3dpemhkc3BvcnRzLmlzLycpLmNvbnRlbnQKCWJsb2NrID0gcmUuY29tcGlsZSgnPHVsIGNsYXNzPSJzcG9ydHNfbWVudSI+KC4rPyk8L3VsPicscmUuRE9UQUxMKS5maW5kYWxsKGh0bWwpCglmb3IgaXRlbSBpbiBibG9jazoKCQltYXRjaCA9IHJlLmNvbXBpbGUoJzxhIGhyZWY9IiguKz8pIi4rP3NyYz0iKC4rPykiLis/PiAoLis/KTwvbGk+JykuZmluZGFsbChzdHIoaXRlbSkpCgkJZm9yIHVybDIsaWNvbmltYWdlLG5hbWUgaW4gbWF0Y2g6CgkJCW5hbWUgPSBuYW1lLnRpdGxlKCkKCQkJaWYgbmFtZSA9PSAnTmZsJzppbWFnZSA9IE5mbAoJCQllbGlmIG5hbWUgPT0gJ0Zvb3RiYWxsJzppbWFnZSA9IEZvb3RiYWxsCgkJCWVsaWYgbmFtZSA9PSAnQ3JpY2tldCc6aW1hZ2UgPSBDcmlja2V0CgkJCWVsaWYgbmFtZSA9PSAnVGVubmlzJzppbWFnZSA9IFRlbm5pcwoJCQllbGlmIG5hbWUgPT0gJ0JveGluZyc6aW1hZ2UgPSBCb3hpbmcKCQkJZWxpZiBuYW1lID09ICdHb2xmJzppbWFnZSA9IEdvbGYKCQkJZWxpZiBuYW1lID09ICdNb3Rvc3BvcnRzJzppbWFnZSA9IE1vdG9yc3BvcnRzCgkJCWVsaWYgbmFtZSA9PSAnUnVnYnknOmltYWdlID0gUnVnYnkKCQkJZWxpZiBuYW1lID09ICdIb2NrZXknOmltYWdlID0gSG9ja2V5CgkJCWVsaWYgbmFtZSA9PSAnTmJhJzppbWFnZSA9IE5iYQoJCQllbGlmIG5hbWUgPT0gJ0RhcnRzJzppbWFnZSA9IERhcnRzCgkJCWVsaWYgbmFtZSA9PSAnV3dlJzppbWFnZSA9IFd3ZQoJCQllbGlmIG5hbWUgPT0gJ0hvcnNlIFJhY2luZyc6aW1hZ2UgPSBIb3JzZV9SYWNpbmcKCQkJZWxpZiBuYW1lID09ICdVZmMnOmltYWdlID0gVWZjCgkJCWVsaWYgbmFtZSA9PSAnQmFzZWJhbGwnOmltYWdlID0gQmFzZWJhbGwKCQkJaWYgbmFtZSA9PSAnVHYgU2hvd3MnOnBhc3MKCQkJZWxpZiBuYW1lID09ICdPdGhlcnMnOnBhc3MKCQkJZWxpZiBuYW1lID09ICdQMlAgT25saW5lJzpwYXNzCgkJCWVsc2U6CgkJCQlpZiBpbWFnZSA9PSAnJzoKCQkJCQlpbWFnZSA9IGljb25pbWFnZQoJCQkJYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybDIuZW5jb2RlKCd1dGYtOCcpLDMyLGltYWdlLGZhbmFydCwnJywnJywnJyxOb25lLCdzb3VyY2UnKQoJCQkJCmRlZiBXaXpfR2V0X3VybCh1cmwpOgoJTGlzdCA9IFtdCgoJZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKCXRvZGF5c19kYXkgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJWQnKQoJdG9kYXlzX21vbnRoID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVtJykKCXRvZGF5c195ZWFyID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVZJykKCXRvZGF5c19ob3VyID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVIJykKCXRvZGF5c19taW51dGUgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJU0nKQoJZmluX2RhdGUgPSB0b2RheXNfZGF5KyctJyt0b2RheXNfbW9udGgrJy0nK3RvZGF5c195ZWFyCglodG1sID0gcmVxdWVzdHMuZ2V0KHVybCkuY29udGVudAoJYmxvY2sgPSByZS5jb21waWxlKCc8aDM+Lis/R2FtZXMgT24gOiAoLis/KTwvaDM+KC4rPyk8bGkgY2xhc3M9XCdzcG9ydHNfcmVkX2JhclwnPicscmUuRE9UQUxMKS5maW5kYWxsKGh0bWwpCglmb3IgZGF0ZSxyZXN0IGluIGJsb2NrOgoJCWlmIGRhdGUgPT0gZmluX2RhdGU6CgkJCW1hdGNoID0gcmUuY29tcGlsZSgnPGRpdiBjbGFzcz1cJ2NvbC1tZC0yXCc+Lis/PC9zcGFuPiguKz8pPC9kaXY+Lis/PGRpdiBjbGFzcz1cJ2NvbC1tZC02XCc+KC4rPyk8L2Rpdj4uKz9kaXYgY2xhc3M9ImNhcmQtYmxvY2sgZHJvcF9ib3giPiguKz8pPGRpdiBjbGFzcz0iY2FyZCI+JyxyZS5ET1RBTEwpLmZpbmRhbGwoc3RyKHJlc3QpKQoJCQlmb3IgdGltZSx0ZWFtcyxsaW5rX2Jsb2NrIGluIG1hdGNoOgoJCQkJdG90YWwgPSBsZW4obWF0Y2gpCgkJCQl0ZWFtcyA9IHRlYW1zLnJlcGxhY2UoJyAgJywnJykucmVwbGFjZSgnCScsJycpCgkJCQlsaW5rX2Jsb2NrID0gbGlua19ibG9jay5yZXBsYWNlKCcgICcsJycpCgkJCQl0aW1lX3NwbGl0ID0gcmUuZmluZGFsbCgnKC4rPyk6KC4rPyktKC4rPyk6KC4rPyk+JyxzdHIodGltZSsnPicpKQoJCQkJZm9yIHN0YXJ0X2hvdXIsc3RhcnRfbWluLGZpbl9ob3VyLGZpbl9taW4gaW4gdGltZV9zcGxpdDoKCQkJCQlzdGFydF9ubyA9IGludChzdGFydF9ob3VyKSoyNCtpbnQoc3RhcnRfbWluKQoJCQkJCWZpbl9ubyA9IGludChmaW5faG91cikqMjQraW50KGZpbl9taW4pCgkJCQkJdGltZV9ub3cgPSBpbnQodG9kYXlzX2hvdXIpKjI0K2ludCh0b2RheXNfbWludXRlKQoJCQkJCWlmIGZpbl9ubz50aW1lX25vdz5zdGFydF9ubzoKCQkJCQkJbmFtZSA9ICdbQ09MT1JncmVlbl0nKyB0ZWFtcysnWy9DT0xPUl0nCgkJCQkJZWxzZToKCQkJCQkJbmFtZSA9IHRlYW1zCgkJCQlsaW5rX2dldCA9IHJlLmNvbXBpbGUoIjxhIGhyZWY9JyguKz8pJz4uKz8+KC4rPyk8L2Rpdj48L2E+IikuZmluZGFsbChzdHIobGlua19ibG9jaykpCgkJCQlmb3IgbGluayxjaG5sIGluIGxpbmtfZ2V0OgoJCQkJCWxpbmsgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLlNwb3J0c0RldmlsLz9tb2RlPTEmYW1wO2l0ZW09Y2F0Y2hlciUzZHN0cmVhbXMlMjZ1cmw9JytsaW5rCgkJCQkJaWYgbGVuKGxpbmtfZ2V0KT4xOgoJCQkJCQlMaXN0LmFwcGVuZCgobGluayxjaG5sKSkKCQkJCQllbHNlOgoJCQkJCQlhZGRMaW5rKGxpbmssdGltZS5yZXBsYWNlKCcgJywnJykrJy0nK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSxpY29uLEZBTkFSVCwnJywnJywnJyxUcnVlLE5vbmUscmVnZXhzLHRvdGFsKQkJCQkJCQoJCQkJaWYgbGVuKExpc3QpPjE6CgkJCQkJdnVybCA9IHN0cihMaXN0KS5yZXBsYWNlKCdbJywnc3VibGluaycpLnJlcGxhY2UoJ10nLCcjJykucmVwbGFjZSgnc3VibGluayhcJycsJ3N1Ymxpbms6JykucmVwbGFjZSgncGx1Z2luOicsJ0xJU1RTT1VSQ0U6cGx1Z2luOicpLnJlcGxhY2UoIicsICciLCc6OkxJU1ROQU1FOicpLnJlcGxhY2UoIicpLCAoJyIsJzo6I3N1YmxpbmsnKS5yZXBsYWNlKCInKSIsJycpLnJlcGxhY2UoJ3N1YmxpbmtMSVNUU09VUkNFJywnc3VibGluazpMSVNUU09VUkNFJykKCQkJCQl4Ym1jLmxvZyh2dXJsKQoJCQkJCWFkZERpcih0aW1lLnJlcGxhY2UoJyAnLCcnKSsnLScrbmFtZSx2dXJsLDMwLGljb24sRkFOQVJULCcnLCcnLCcnLCcnKQoJCQkJCWRlbCBMaXN0WzpdCgkJCgoKCQoKIyBib3Jyb3cgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vZW5lbjkyL1AyUC1TdHJlYW1zLVhCTUMvYmxvYi9tYXN0ZXIvcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zL3Jlc291cmNlcy9jb3JlL2xpdmVzdHJlYW1zLnB5CiMgVGhpcyB3aWxsIG5vdCBnbyB0aHJvdWdoIHRoZSBnZXRJdGVtcyBmdW5jdGlvbnMgKCBtZWFucyB5b3UgbXVzdCBoYXZlIHJlYWR5IHRvIHBsYXkgdXJsLCBubyByZWdleCkKZGVmIHBhcnNlX20zdShkYXRhKToKICAgIGNvbnRlbnQgPSBkYXRhLnJzdHJpcCgpCiAgICBtYXRjaCA9IHJlLmNvbXBpbGUocicjRVhUSU5GOiguKz8pLCguKj8pW1xuXHJdKyhbXlxuXSspJykuZmluZGFsbChjb250ZW50KQogICAgdG90YWwgPSBsZW4obWF0Y2gpCiAgICBwcmludCAndG90YWwgbTN1IGxpbmtzJyx0b3RhbAogICAgZm9yIG90aGVyLGNoYW5uZWxfbmFtZSxzdHJlYW1fdXJsIGluIG1hdGNoOgogICAgICAgIGlmICd0dmctbG9nbycgaW4gb3RoZXI6CiAgICAgICAgICAgIHRodW1ibmFpbCA9IHJlX21lKG90aGVyLCd0dmctbG9nbz1bXCciXSguKj8pW1wnIl0nKQogICAgICAgICAgICBpZiB0aHVtYm5haWw6CiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbi5nZXRTZXR0aW5nKCdsb2dvLWZvbGRlclBhdGgnKSA9PSAiIjoKICAgICAgICAgICAgICAgICAgICBsb2dvX3VybCA9IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpCiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gbG9nb191cmwgKyB0aHVtYm5haWwKCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9IHRodW1ibmFpbAogICAgICAgICAgICAjZWxzZToKICAgICAgICAgICAgCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdGh1bWJuYWlsID0gJycKICAgICAgICBpZiAndHlwZScgaW4gb3RoZXI6CiAgICAgICAgICAgIG1vZGVfdHlwZSA9IHJlX21lKG90aGVyLCd0eXBlPVtcJyJdKC4qPylbXCciXScpCiAgICAgICAgICAgIGlmIG1vZGVfdHlwZSA9PSAneXQtZGwnOgogICAgICAgICAgICAgICAgc3RyZWFtX3VybCA9IHN0cmVhbV91cmwgKyImbW9kZT0xOCIKICAgICAgICAgICAgZWxpZiBtb2RlX3R5cGUgPT0gJ3JlZ2V4JzoKICAgICAgICAgICAgICAgIHVybCA9IHN0cmVhbV91cmwuc3BsaXQoJyZyZWdleHM9JykKICAgICAgICAgICAgICAgICNwcmludCB1cmxbMF0gZ2V0U291cCh1cmwsZGF0YT1Ob25lKQogICAgICAgICAgICAgICAgcmVnZXhzID0gcGFyc2VfcmVnZXgoZ2V0U291cCgnJyxkYXRhPXVybFsxXSkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsWzBdLCBjaGFubmVsX25hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUscmVnZXhzLHRvdGFsKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICBhZGRMaW5rKHN0cmVhbV91cmwsIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkKCQkKICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MCkiKQoJCmRlZiBnZXRDaGFubmVsSXRlbXMobmFtZSx1cmwsZmFuYXJ0KToKICAgICAgICBzb3VwID0gZ2V0U291cCh1cmwpCiAgICAgICAgY2hhbm5lbF9saXN0ID0gc291cC5maW5kKCdjaGFubmVsJywgYXR0cnM9eyduYW1lJyA6IG5hbWUuZGVjb2RlKCd1dGYtOCcpfSkKICAgICAgICBpdGVtcyA9IGNoYW5uZWxfbGlzdCgnaXRlbScpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmYW5BcnQgPSBjaGFubmVsX2xpc3QoJ2ZhbmFydCcpWzBdLnN0cmluZwogICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBmYW5BcnQgPSBmYW5hcnQKICAgICAgICBmb3IgY2hhbm5lbCBpbiBjaGFubmVsX2xpc3QoJ3N1YmNoYW5uZWwnKToKICAgICAgICAgICAgbmFtZSA9IGNoYW5uZWwoJ25hbWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gY2hhbm5lbCgndGh1bWJuYWlsJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiB0aHVtYm5haWwgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSAnJwogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBub3QgY2hhbm5lbCgnZmFuYXJ0Jyk6CiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygndXNlX3RodW1iJykgPT0gInRydWUiOgogICAgICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSB0aHVtYm5haWwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gY2hhbm5lbCgnZmFuYXJ0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBmYW5BcnQgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRlc2MgPSBjaGFubmVsKCdpbmZvJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkZXNjID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGVzYyA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBnZW5yZSA9IGNoYW5uZWwoJ2dlbnJlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGdlbnJlID0gJycKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGRhdGUgPSBjaGFubmVsKCdkYXRlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICBpZiBkYXRlID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZGF0ZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBjcmVkaXRzID0gY2hhbm5lbCgnY3JlZGl0cycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgY3JlZGl0cyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGNyZWRpdHMgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx1cmwuZW5jb2RlKCd1dGYtOCcpLDMsdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGNyZWRpdHMsZGF0ZSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgYWRkb25fbG9nKCdUaGVyZSB3YXMgYSBwcm9ibGVtIGFkZGluZyBkaXJlY3RvcnkgLSAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5BcnQpCgoKZGVmIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpOgogICAgICAgIHNvdXAgPSBnZXRTb3VwKHVybCkKICAgICAgICBjaGFubmVsX2xpc3QgPSBzb3VwLmZpbmQoJ3N1YmNoYW5uZWwnLCBhdHRycz17J25hbWUnIDogbmFtZS5kZWNvZGUoJ3V0Zi04Jyl9KQogICAgICAgIGl0ZW1zID0gY2hhbm5lbF9saXN0KCdzdWJpdGVtJykKICAgICAgICBnZXRJdGVtcyhpdGVtcyxmYW5hcnQpCgojaGFrYW1hYwpkZWYgR2V0U3VibGlua3MobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCk6CiAgICB4Ym1jLmxvZygnSSBHT1QgSEVSRSMjIyMjIyMjIyMjIyMjIycpCiAgICBMaXN0PVtdOyBMaXN0VT1bXTsgYz0wCiAgICBhbGxfdmlkZW9zID0gcmVnZXhfZ2V0X2FsbCh1cmwsICdzdWJsaW5rOicsICcjJykKICAgIGZvciBhIGluIGFsbF92aWRlb3M6CiAgICAgICAgaWYgJ0xJU1RTT1VSQ0U6JyBpbiBhOgogICAgICAgICAgICB2dXJsID0gcmVnZXhfZnJvbV90byhhLCAnTElTVFNPVVJDRTonLCAnOjonKQogICAgICAgICAgICBsaW5lbmFtZSA9IHJlZ2V4X2Zyb21fdG8oYSwgJ0xJU1ROQU1FOicsICc6OicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdnVybCA9IGEucmVwbGFjZSgnc3VibGluazonLCcnKS5yZXBsYWNlKCcjJywnJykKICAgICAgICAgICAgbGluZW5hbWUgPSBuYW1lCiAgICAgICAgaWYgbGVuKHZ1cmwpID4gMTA6CiAgICAgICAgICAgIGM9YysxOyBMaXN0LmFwcGVuZChsaW5lbmFtZSk7IExpc3RVLmFwcGVuZCh2dXJsKQogCiAgICBpZiBjPT0xOgogICAgICAgIHRyeToKICAgICAgICAgICAgI3ByaW50ICdwbGF5IDEgICBOYW1lOicgKyBuYW1lICsgJyAgIHVybDonICsgTGlzdFVbMF0gKyAnICAgICAnICsgc3RyKGMpCiAgICAgICAgICAgIGxpej14Ym1jZ3VpLkxpc3RJdGVtKG5hbWUsIGljb25JbWFnZT1pY29uaW1hZ2UsdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKTsgbGl6LnNldEluZm8oIHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUgfSApCiAgICAgICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9TGlzdFVbMF0sbGlzdGl0ZW09bGl6KQogICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsc29sdmVyKExpc3RVWzBdKSwgbGl6KQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgZWxzZToKICAgICAgICAgZGlhbG9nPXhibWNndWkuRGlhbG9nKCkKICAgICAgICAgck5vPWRpYWxvZy5zZWxlY3QoJ0RlamFWdVNlbGVjdCBBIFNvdXJjZScsIExpc3QpCiAgICAgICAgIGlmIHJObz49MDoKICAgICAgICAgICAgIHJOYW1lPW5hbWUKICAgICAgICAgICAgIHJVUkw9c3RyKExpc3RVW3JOb10pCiAgICAgICAgICAgICAjcHJpbnQgJ1N1YmxpbmtzICAgTmFtZTonICsgbmFtZSArICcgICB1cmw6JyArIHJVUkwKICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkodXJsc29sdmVyKHJVUkwpLCB4Ym1jZ3VpLkxpc3RJdGVtKHJOYW1lKSkKICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICB4Ym1jLlBsYXllcigpLnBsYXkoclVSTCwgeGJtY2d1aS5MaXN0SXRlbShyTmFtZSkpCgoJCQkJCmRlZiBTZWFyY2hDaGFubmVscygpOgojaGFrYW1hYyBjb2RlCiAgICBLZXlib2FyZE1lc3NhZ2UgPSAnTmFtZSBvZiBjaGFubmVsIHNob3cgb3IgbW92aWUnCiAgICBTZWFyY2hrZXkgPSAnJwogICAga2V5Ym9hcmQgPSB4Ym1jLktleWJvYXJkKFNlYXJjaGtleSwgS2V5Ym9hcmRNZXNzYWdlKQogICAga2V5Ym9hcmQuZG9Nb2RhbCgpCiAgICBpZiBrZXlib2FyZC5pc0NvbmZpcm1lZCgpOgogICAgICAgU2VhcmNoa2V5ID0ga2V5Ym9hcmQuZ2V0VGV4dCgpLnJlcGxhY2UoJ1xuJywnJykuc3RyaXAoKQogICAgICAgaWYgbGVuKFNlYXJjaGtleSkgPT0gMDogCiAgICAgICAgICB4Ym1jZ3VpLkRpYWxvZygpLm9rKCdSb2Jpbkhvb2QnLCAnTm90aGluZyBFbnRlcmVkJykKICAgICAgICAgIHJldHVybgkgICAKICAgIAogICAgU2VhcmNoa2V5ID0gU2VhcmNoa2V5Lmxvd2VyKCkKICAgIExpc3Q9W10KICAgIExpc3QuYXBwZW5kKF9FZGl0Lk1haW5CYXNlKQogICAgUGFzc2VkVXJscyA9IDAKICAgIEZvdW5kQ2hhbm5lbCA9IDEgCiAgICBSZWFkQ2hhbm5lbCA9IDAKICAgIEZvdW5kTWF0Y2ggPSAwCiAgICBwcm9ncmVzcyA9IHhibWNndWkuRGlhbG9nUHJvZ3Jlc3MoKQogICAgcHJvZ3Jlc3MuY3JlYXRlKCdEZWphVnVTZWFyY2hpbmcgUGxlYXNlIHdhaXQnLCcgJykKCQogICAgd2hpbGUgRm91bmRDaGFubmVsIDw+IFJlYWRDaGFubmVsOgogICAgICAgIEJhc2VTZWFyY2ggPSBMaXN0W1JlYWRDaGFubmVsXS5zdHJpcCgpCiAgICAgICAgcHJpbnQgJ3JlYWQgdGhpcyBvbmUgZnJvbSBmaWxlIGxpc3QgKCcgKyBzdHIoUmVhZENoYW5uZWwpICsgJyknICAKICAgICAgICBSZWFkQ2hhbm5lbCA9IFJlYWRDaGFubmVsICsgMQoKICAgICAgICBQYWdlU291cmNlID0gJycKICAgICAgICB0cnk6CiAgICAgICAgICAgIFBhZ2VTb3VyY2UgPSBuZXQuaHR0cF9HRVQoQmFzZVNlYXJjaCkuY29udGVudAogICAgICAgICAgICBQYWdlU291cmNlID0gUGFnZVNvdXJjZS5lbmNvZGUoJ2FzY2lpJywgJ2lnbm9yZScpLmRlY29kZSgnYXNjaWknKQogICAgICAgICAgICAjdGltZS5zbGVlcCgxKQogICAgICAgIGV4Y2VwdDogCiAgICAgICAgICAgIHBhc3MKCQkKICAgICAgICBpZiBsZW4oUGFnZVNvdXJjZSkgPCAxMDoKICAgICAgICAgICAgUGFnZVNvdXJjZSA9ICcnCiAgICAgICAgICAgIFBhc3NlZFVybHMgPSBQYXNzZWRVcmxzICsgMQogICAgICAgICAgICBwcmludCAnKioqIFBBU1NFRCAqKioqJyArIEJhc2VTZWFyY2ggKyAnICAqKioqKioqKioqKioqIFRvdGFsIFBhc3NlZCBVcmxzOiAnICsgc3RyKFBhc3NlZFVybHMpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoLjUpCiAKICAgICAgICBwZXJjZW50ID0gaW50KCAoIFJlYWRDaGFubmVsIC8gMzAwKSAqIDEwMCkgCiAgICAgICAgbWVzc2FnZSA9ICcgICAgIFBhZ2VzIFJlYWQ6ICcrc3RyKFJlYWRDaGFubmVsKSsnICAgICAgICBNYXRjaGVzIEZvdW5kOiAnICsgc3RyKEZvdW5kTWF0Y2gpCiAgICAgICAgcHJvZ3Jlc3MudXBkYXRlKHBlcmNlbnQsIiIsIG1lc3NhZ2UsICIiICkKCiAgICAgICAgaWYgcHJvZ3Jlc3MuaXNjYW5jZWxlZCgpOgogICAgICAgICAgIHJldHVybgogCQkKICAgICAgICBpZiBsZW4oUGFnZVNvdXJjZSkgPiAxMDoKICAgICAgICAgICAgYWxsX2xpbmtzID0gcmVnZXhfZ2V0X2FsbChQYWdlU291cmNlLCAnPGNoYW5uZWw+JywgJzwvY2hhbm5lbD4nKQogICAgICAgICAgICBmb3IgYSBpbiBhbGxfbGlua3M6CiAgICAgICAgICAgICAgICB2dXJsID0gcmVnZXhfZnJvbV90byhhLCAnPGV4dGVybmFsbGluaz4nLCAnPC9leHRlcm5hbGxpbms+JykKICAgICAgICAgICAgICAgICNuYW1lID0gcmVnZXhfZnJvbV90byhhLCAnPG5hbWU+JywgJzwvbmFtZT4nKQogICAgICAgICAgICAgICAgI3ByaW50IG5hbWUgKyAnICAgICcgKyB2dXJsCiAgICAgICAgICAgICAgICBpZiBsZW4odnVybCkgPiA1OgogICAgICAgICAgICAgICAgICAgRm91bmRDaGFubmVsID0gRm91bmRDaGFubmVsICsgMQogICAgICAgICAgICAgICAgICAgTGlzdC5hcHBlbmQodnVybCkKICAgICAgICAgICAgICAgICAgICNwcmludCAnRm91bmQgQ2hhbm5lbDogJysgc3RyKEZvdW5kQ2hhbm5lbCkgKycgOiAnKyB2dXJsIAoKICAgICAgICAgICAgYWxsX2l0ZW1zID0gcmVnZXhfZ2V0X2FsbChQYWdlU291cmNlLCAnPGl0ZW0+JywgJzwvaXRlbT4nKQogICAgICAgICAgICBmb3IgYSBpbiBhbGxfaXRlbXM6CiAgICAgICAgICAgICAgICB2dXJsID0gcmVnZXhfZnJvbV90byhhLCAnPGxpbms+JywgJzwvbGluaz4nKQogICAgICAgICAgICAgICAgbmFtZSA9IHJlZ2V4X2Zyb21fdG8oYSwgJzx0aXRsZT4nLCAnPC90aXRsZT4nKQogICAgICAgICAgICAgICAgVGVzdE5hbWUgPSAnICAnICsgbmFtZS5sb3dlcigpICsgJyAgJwogICAgICAgICAgICAgICAgI3ByaW50ICdUZXN0aW5nOicgKyBUZXN0TmFtZSArICcgICcgKyBTZWFyY2hrZXkKICAgICAgICAgICAgICAgIGlmIGxlbih2dXJsKSA+IDUgYW5kIFRlc3ROYW1lLmZpbmQoU2VhcmNoa2V5KSA+IDA6CiAgICAgICAgICAgICAgICAgICAgRm91bmRNYXRjaCA9IEZvdW5kTWF0Y2ggKyAxCiAgICAgICAgICAgICAgICAgICAgZmFuYXJ0ID0gJycKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSByZWdleF9mcm9tX3RvKGEsICc8dGh1bWJuYWlsPicsICc8L3RodW1ibmFpbD4nKQogICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IHJlZ2V4X2Zyb21fdG8oYSwgJzxmYW5hcnQ+JywgJzwvZmFuYXJ0PicpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGZhbmFydCkgPCA1OgogICAgICAgICAgICAgICAgICAgICAgIGZhbmFydCA9IGljb24KICAgICAgICAgICAgICAgICAgICBpZiB2dXJsLmZpbmQoJ3N1YmxpbmsnKSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLHZ1cmwsMzAsdGh1bWJuYWlsLGZhbmFydCwnJywnJywnJywnJykKICAgICAgICAgICAgICAgICAgICBlbHNlOiAKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTGluayhzdHIodnVybCksbmFtZSx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLFRydWUsTm9uZSwnJywxKQoJCQkJCQkKICAgIAogICAgcHJvZ3Jlc3MuY2xvc2UoKQogICAgeGJtYy5leGVjdXRlYnVpbHRpbigiQ29udGFpbmVyLlNldFZpZXdNb2RlKDUwKSIpCgkKZGVmIFNlYXJjaF9tM3UoZGF0YSxTZWFyY2hrZXkpOgogICAgY29udGVudCA9IGRhdGEucnN0cmlwKCkKICAgIG1hdGNoID0gcmUuY29tcGlsZShyJyNFWFRJTkY6KC4rPyksKC4qPylbXG5ccl0rKFteXG5dKyknKS5maW5kYWxsKGNvbnRlbnQpCiAgICB0b3RhbCA9IGxlbihtYXRjaCkKICAgIHByaW50ICd0b3RhbCBtM3UgbGlua3MnLHRvdGFsCiAgICBmb3Igb3RoZXIsY2hhbm5lbF9uYW1lLHN0cmVhbV91cmwgaW4gbWF0Y2g6CiAgICAgICAgaWYgJ3R2Zy1sb2dvJyBpbiBvdGhlcjoKICAgICAgICAgICAgdGh1bWJuYWlsID0gcmVfbWUob3RoZXIsJ3R2Zy1sb2dvPVtcJyJdKC4qPylbXCciXScpCiAgICAgICAgICAgIGlmIHRodW1ibmFpbDoKICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbC5zdGFydHN3aXRoKCdodHRwJyk6CiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gdGh1bWJuYWlsCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsaWYgbm90IGFkZG9uLmdldFNldHRpbmcoJ2xvZ28tZm9sZGVyUGF0aCcpID09ICIiOgogICAgICAgICAgICAgICAgICAgIGxvZ29fdXJsID0gYWRkb24uZ2V0U2V0dGluZygnbG9nby1mb2xkZXJQYXRoJykKICAgICAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBsb2dvX3VybCArIHRodW1ibmFpbAoKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgdGh1bWJuYWlsID0gdGh1bWJuYWlsCiAgICAgICAgICAgICNlbHNlOgogICAgICAgICAgICAKICAgICAgICBlbHNlOgogICAgICAgICAgICB0aHVtYm5haWwgPSAnJwogICAgICAgIGlmICd0eXBlJyBpbiBvdGhlcjoKICAgICAgICAgICAgbW9kZV90eXBlID0gcmVfbWUob3RoZXIsJ3R5cGU9W1wnIl0oLio/KVtcJyJdJykKICAgICAgICAgICAgaWYgbW9kZV90eXBlID09ICd5dC1kbCc6CiAgICAgICAgICAgICAgICBzdHJlYW1fdXJsID0gc3RyZWFtX3VybCArIiZtb2RlPTE4IgogICAgICAgICAgICBlbGlmIG1vZGVfdHlwZSA9PSAncmVnZXgnOgogICAgICAgICAgICAgICAgdXJsID0gc3RyZWFtX3VybC5zcGxpdCgnJnJlZ2V4cz0nKQogICAgICAgICAgICAgICAgI3ByaW50IHVybFswXSBnZXRTb3VwKHVybCxkYXRhPU5vbmUpCiAgICAgICAgICAgICAgICByZWdleHMgPSBwYXJzZV9yZWdleChnZXRTb3VwKCcnLGRhdGE9dXJsWzFdKSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYWRkTGluayh1cmxbMF0sIGNoYW5uZWxfbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSxyZWdleHMsdG90YWwpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgIGFkZExpbmsoc3RyZWFtX3VybCwgY2hhbm5lbF9uYW1lLHRodW1ibmFpbCwnJywnJywnJywnJywnJyxOb25lLCcnLHRvdGFsKQoKZGVmIEZpbmRGaXJzdFBhdHRlcm4odGV4dCxwYXR0ZXJuKToKICAgIHJlc3VsdCA9ICIiCiAgICB0cnk6ICAgIAogICAgICAgIG1hdGNoZXMgPSByZS5maW5kYWxsKHBhdHRlcm4sdGV4dCwgZmxhZ3M9cmUuRE9UQUxMKQogICAgICAgIHJlc3VsdCA9IG1hdGNoZXNbMF0KICAgIGV4Y2VwdDoKICAgICAgICByZXN1bHQgPSAiIgoKICAgIHJldHVybiByZXN1bHQKCQpkZWYgcmVnZXhfZ2V0X2FsbCh0ZXh0LCBzdGFydF93aXRoLCBlbmRfd2l0aCk6CiAgICByID0gcmUuZmluZGFsbCgiKD9pKSgiICsgc3RhcnRfd2l0aCArICJbXFNcc10rPyIgKyBlbmRfd2l0aCArICIpIiwgdGV4dCkKICAgIHJldHVybiByCQkJCQoKZGVmIHJlZ2V4X2Zyb21fdG8odGV4dCwgZnJvbV9zdHJpbmcsIHRvX3N0cmluZywgZXhjbHVkaW5nPVRydWUpOgogICAgaWYgZXhjbHVkaW5nOgoJICAgdHJ5OiByID0gcmUuc2VhcmNoKCIoP2kpIiArIGZyb21fc3RyaW5nICsgIihbXFNcc10rPykiICsgdG9fc3RyaW5nLCB0ZXh0KS5ncm91cCgxKQoJICAgZXhjZXB0OiByID0gJycKICAgIGVsc2U6CiAgICAgICB0cnk6IHIgPSByZS5zZWFyY2goIig/aSkoIiArIGZyb21fc3RyaW5nICsgIltcU1xzXSs/IiArIHRvX3N0cmluZyArICIpIiwgdGV4dCkuZ3JvdXAoMSkKICAgICAgIGV4Y2VwdDogciA9ICcnCiAgICByZXR1cm4gcgoKZGVmIGdldEl0ZW1zKGl0ZW1zLGZhbmFydCk6CiAgICAgICAgdG90YWwgPSBsZW4oaXRlbXMpCiAgICAgICAgcHJpbnQgJ1NUQVJUIEdFVCBJVEVNUyAqKioqKicKICAgICAgICBhZGRvbl9sb2coJ1RvdGFsIEl0ZW1zOiAlcycgJXRvdGFsKQogICAgICAgIGZvciBpdGVtIGluIGl0ZW1zOgogICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQogICAgICAgICAgICBpc0pzb25ycGMgPSBGYWxzZQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBuYW1lID0gaXRlbSgndGl0bGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIG5hbWUgaXMgTm9uZToKICAgICAgICAgICAgICAgICAgICBuYW1lID0gJ3Vua25vd24/JwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ05hbWUgRXJyb3InKQogICAgICAgICAgICAgICAgbmFtZSA9ICcnCgoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgaXRlbSgnZXBnJyk6CiAgICAgICAgICAgICAgICAgICAgaWYgaXRlbS5lcGdfdXJsOgogICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ0dldCBFUEcgUmVnZXgnKQogICAgICAgICAgICAgICAgICAgICAgICBlcGdfdXJsID0gaXRlbS5lcGdfdXJsLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBlcGdfcmVnZXggPSBpdGVtLmVwZ19yZWdleC5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXBnX25hbWUgPSBnZXRfZXBnKGVwZ191cmwsIGVwZ19yZWdleCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZXBnX25hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lICs9ICcgLSAnICsgZXBnX25hbWUKICAgICAgICAgICAgICAgICAgICBlbGlmIGl0ZW0oJ2VwZycpWzBdLnN0cmluZyA+IDE6CiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgKz0gZ2V0ZXBnKGl0ZW0oJ2VwZycpWzBdLnN0cmluZykKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ0VQRyBFcnJvcicpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHVybCA9IFtdCiAgICAgICAgICAgICAgICBpZiBsZW4oaXRlbSgnbGluaycpKSA+MDoKIyAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2l0ZW0gbGluaycsIGl0ZW0oJ2xpbmsnKQogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ2xpbmsnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGkuc3RyaW5nKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnc3BvcnRzZGV2aWwnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnc3BvcnRzZGV2aWwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcG9ydHNkZXZpbCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8uU3BvcnRzRGV2aWwvP21vZGU9MSZhbXA7aXRlbT1jYXRjaGVyJTNkc3RyZWFtcyUyNnVybD0nICtpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlciA9IGl0ZW0oJ3JlZmVyZXInKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlZmVyZXI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdyZWZlcmVyIGZvdW5kJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwb3J0c2RldmlsID0gc3BvcnRzZGV2aWwgKyAnJTI2cmVmZXJlcj0nICtyZWZlcmVyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNwb3J0c2RldmlsKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgncDJwJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3AycCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICdzb3A6Ly8nIGluIGk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc29wID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5wMnAtc3RyZWFtcy8/dXJsPScraS5zdHJpbmcgKycmYW1wO21vZGU9MiZhbXA7JyArICduYW1lPScrbmFtZSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHNvcCkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHAycD0ncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnAycC1zdHJlYW1zLz91cmw9JytpLnN0cmluZyArJyZhbXA7bW9kZT0xJmFtcDsnICsgJ25hbWU9JytuYW1lIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybC5hcHBlbmQocDJwKQogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgndmF1Z2huJykpID4wOgogICAgICAgICAgICAgICAgICAgIGZvciBpIGluIGl0ZW0oJ3ZhdWdobicpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhdWdobiA9ICdwbHVnaW46Ly9wbHVnaW4uc3RyZWFtLnZhdWdobmxpdmUudHYvP21vZGU9UGxheUxpdmVTdHJlYW0mYW1wO2NoYW5uZWw9JytpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh2YXVnaG4pCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdpbGl2ZScpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdpbGl2ZScpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCAnaHR0cCcgaW4gaS5zdHJpbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWxpdmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnRiaC5pbGl2ZS8/dXJsPWh0dHA6Ly93d3cuc3RyZWFtbGl2ZS50by92aWV3LycraS5zdHJpbmcrJyZhbXA7bGluaz05OSZhbXA7bW9kZT1pTGl2ZVBsYXknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlsaXZlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby50YmguaWxpdmUvP3VybD0nK2kuc3RyaW5nKycmYW1wO2xpbms9OTkmYW1wO21vZGU9aUxpdmVQbGF5JwogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgneXQtZGwnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgneXQtZGwnKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGkuc3RyaW5nID09IE5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB5dGRsID0gaS5zdHJpbmcgKyAnJm1vZGU9MTgnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKHl0ZGwpCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCd1dHViZScpKSA+MDoKICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCd1dHViZScpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbihpLnN0cmluZykgPT0gMTE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXR1YmUgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnlvdXR1YmUvcGxheS8/dmlkZW9faWQ9JysgaS5zdHJpbmcgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGkuc3RyaW5nLnN0YXJ0c3dpdGgoJ1BMJykgYW5kIG5vdCAnJm9yZGVyPScgaW4gaS5zdHJpbmcgOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0dWJlID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvPyZvcmRlcj1kZWZhdWx0JnBsYXlsaXN0X2lkPScgKyBpLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1dHViZSA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ueW91dHViZS9wbGF5Lz9wbGF5bGlzdF9pZD0nICsgaS5zdHJpbmcgCiAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZCh1dHViZSkKICAgICAgICAgICAgICAgIGVsaWYgbGVuKGl0ZW0oJ2ltZGInKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnaW1kYicpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgaS5zdHJpbmcgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2dlbmVzaXNvcnB1bHNhcicpID09ICcwJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbWRiID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5nZW5lc2lzLz9hY3Rpb249cGxheSZpbWRiPScraS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1kYiA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL21vdmllL3R0JytpLnN0cmluZysnL3BsYXknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGltZGIpICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxpZiBsZW4oaXRlbSgnZjRtJykpID4wOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiBpdGVtKCdmNG0nKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICcuZjRtJyBpbiBpLnN0cmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgJy5tM3U4JyBpbiBpLnN0cmluZzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPUhMUycKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZjRtID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5mNG1UZXN0ZXIvP3VybD0nK3VybGxpYi5xdW90ZV9wbHVzKGkuc3RyaW5nKSsnJmFtcDtzdHJlYW10eXBlPVNJTVBMRScKICAgICAgICAgICAgICAgICAgICAgICAgdXJsLmFwcGVuZChmNG0pCiAgICAgICAgICAgICAgICBlbGlmIGxlbihpdGVtKCdmdHYnKSkgPjA6CiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gaXRlbSgnZnR2Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBpLnN0cmluZyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZnR2ID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby5GLlQuVi8/bmFtZT0nK3VybGxpYi5xdW90ZShuYW1lKSArJyZ1cmw9JyAraS5zdHJpbmcgKycmbW9kZT0xMjUmY2hfZmFuYXJ0PW5hJwogICAgICAgICAgICAgICAgICAgICAgICB1cmwuYXBwZW5kKGZ0dikgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGxlbih1cmwpIDwgMToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ0Vycm9yIDxsaW5rPiBlbGVtZW50LCBQYXNzaW5nOicrbmFtZS5lbmNvZGUoJ3V0Zi04JywgJ2lnbm9yZScpKQogICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpc1hNTFNvdXJjZT1GYWxzZQoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2UgPSBpdGVtKCdleHRlcm5hbGxpbmsnKVswXS5zdHJpbmcKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBpc1hNTFNvdXJjZToKICAgICAgICAgICAgICAgIGV4dF91cmw9W2lzWE1MU291cmNlXQogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9VHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaXNYTUxTb3VyY2U9RmFsc2UKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaXNKc29ucnBjID0gaXRlbSgnanNvbnJwYycpWzBdLnN0cmluZwogICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgaWYgaXNKc29ucnBjOgogICAgICAgICAgICAgICAgZXh0X3VybD1baXNKc29ucnBjXQogICAgICAgICAgICAgICAgaXNKc29ucnBjPVRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlzSnNvbnJwYz1GYWxzZSAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aHVtYm5haWwgPSBpdGVtKCd0aHVtYm5haWwnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIHRodW1ibmFpbCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHRodW1ibmFpbCA9ICcnCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIG5vdCBpdGVtKCdmYW5hcnQnKToKICAgICAgICAgICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCd1c2VfdGh1bWInKSA9PSAidHJ1ZSI6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IHRodW1ibmFpbAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBpdGVtKCdmYW5hcnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGZhbkFydCA9IGZhbmFydAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkZXNjID0gaXRlbSgnaW5mbycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGVzYyA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRlc2MgPSAnJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgZ2VucmUgPSBpdGVtKCdnZW5yZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gTm9uZToKICAgICAgICAgICAgICAgICAgICByYWlzZQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBnZW5yZSA9ICcnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBkYXRlID0gaXRlbSgnZGF0ZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgaWYgZGF0ZSA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGRhdGUgPSAnJwoKICAgICAgICAgICAgcmVnZXhzID0gTm9uZQogICAgICAgICAgICBpZiBpdGVtKCdyZWdleCcpOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHJlZ19pdGVtID0gaXRlbSgncmVnZXgnKQogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHBhcnNlX3JlZ2V4KHJlZ19pdGVtKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MgICAgICAgICAgICAKICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgbGVuKHVybCkgPiAxOgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGFsdCA9IDAKICAgICAgICAgICAgICAgICAgICBwbGF5bGlzdCA9IFtdCiAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gdXJsOgogICAgICAgICAgICAgICAgICAgIAlpZiBhZGRvbi5nZXRTZXR0aW5nKCdhc2tfcGxheWxpc3RfaXRlbXMnKSA9PSAndHJ1ZSc6CgkgICAgICAgICAgICAgICAgICAgICAgICBpZiByZWdleHM6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkrJyZyZWdleHM9JytyZWdleHMpCgkgICAgICAgICAgICAgICAgICAgICAgICBlbGlmICBhbnkoeCBpbiBpIGZvciB4IGluIHJlc29sdmVfdXJsKSBhbmQgIGkuc3RhcnRzd2l0aCgnaHR0cCcpOgoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFwcGVuZChpKycmbW9kZT0xOScpICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGxheWxpc3QuYXBwZW5kKGkpCiAgICAgICAgICAgICAgICAgICAgaWYgYWRkb24uZ2V0U2V0dGluZygnYWRkX3BsYXlsaXN0JykgPT0gImZhbHNlIjogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gdXJsOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsdCArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ0FERExJTksgMScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKGksJyVzKSAlcycgJShhbHQsIG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSksdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsVHJ1ZSxwbGF5bGlzdCxyZWdleHMsdG90YWwpICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZExpbmsoJycsIG5hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSx0aHVtYm5haWwsZmFuQXJ0LGRlc2MsZ2VucmUsZGF0ZSxUcnVlLHBsYXlsaXN0LHJlZ2V4cyx0b3RhbCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgaXNYTUxTb3VyY2U6CiAgICAgICAgICAgICAgICAgICAgCWFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLmVuY29kZSgndXRmLTgnKSwxLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBpc0pzb25ycGM6CiAgICAgICAgICAgICAgICAgICAgICAgIGFkZERpcihuYW1lLmVuY29kZSgndXRmLTgnKSxleHRfdXJsWzBdLDUzLHRodW1ibmFpbCxmYW5hcnQsZGVzYyxnZW5yZSxkYXRlLE5vbmUsJ3NvdXJjZScpCiAgICAgICAgICAgICAgICAgICAgZWxpZiB1cmxbMF0uZmluZCgnc3VibGluaycpID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybFswXSwzMCx0aHVtYm5haWwsZmFuYXJ0LCcnLCcnLCcnLCcnKQogICAgICAgICAgICAgICAgICAgICAgICAjYWRkRGlyKG5hbWUuZW5jb2RlKCd1dGYtOCcpLHVybFswXSwzMCx0aHVtYm5haWwsZmFuYXJ0LGRlc2MsZ2VucmUsZGF0ZSwnc3VibGluaycpCQkJCQogICAgICAgICAgICAgICAgICAgIGVsc2U6IAogICAgICAgICAgICAgICAgICAgICAgICBhZGRMaW5rKHVybFswXSxuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJyksdGh1bWJuYWlsLGZhbkFydCxkZXNjLGdlbnJlLGRhdGUsVHJ1ZSxOb25lLHJlZ2V4cyx0b3RhbCkKCiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzdWNjZXNzJwogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBhZGRvbl9sb2coJ1RoZXJlIHdhcyBhIHByb2JsZW0gYWRkaW5nIGl0ZW0gLSAnK25hbWUuZW5jb2RlKCd1dGYtOCcsICdpZ25vcmUnKSkKICAgICAgICBwcmludCAnRklOSVNIIEdFVCBJVEVNUyAqKioqKicgICAgICAKCmRlZiBwYXJzZV9yZWdleChyZWdfaXRlbSk6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcmVnZXhzID0ge30KICAgICAgICAgICAgICAgICAgICBmb3IgaSBpbiByZWdfaXRlbToKICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddID0ge30KICAgICAgICAgICAgICAgICAgICAgICAgI3JlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnZXhwcmUnXSA9IGkoJ2V4cHJlcycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlJ10gPSBpKCdleHByZXMnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2V4cHJlJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydleHByZSddPScnCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIFJlZmVyZXIgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3BhZ2UnXSA9IGkoJ3BhZ2UnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyZWZlciddID0gaSgncmVmZXJlcicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBSZWZlcmVyIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb25uZWN0aW9uJ10gPSBpKCdjb25uZWN0aW9uJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIGNvbm5lY3Rpb24gLS0iKQoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydub3RwbGF5YWJsZSddID0gaSgnbm90cGxheWFibGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gbm90cGxheWFibGUgLS0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnbm9yZWRpcmVjdCddID0gaSgnbm9yZWRpcmVjdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBub3JlZGlyZWN0IC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydvcmlnaW4nXSA9IGkoJ29yaWdpbicpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBvcmlnaW4gLS0iKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2luY2x1ZGVoZWFkZXJzJ10gPSBpKCdpbmNsdWRlaGVhZGVycycpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyBpbmNsdWRlaGVhZGVycyAtLSIpICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsneC1yZXEnXSA9IGkoJ3gtcmVxJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vIHgtcmVxIC0tIikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWyd4LWZvcndhcmQnXSA9IGkoJ3gtZm9yd2FyZCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBObyB4LWZvcndhcmQgLS0iKQoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydhZ2VudCddID0gaSgnYWdlbnQnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm8gVXNlciBBZ2VudCAtLSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsncG9zdCddID0gaSgncG9zdCcpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBOb3QgYSBwb3N0IikKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyYXdwb3N0J10gPSBpKCdyYXdwb3N0JylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHJhd3Bvc3QiKQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2h0bWx1bmVzY2FwZSddID0gaSgnaHRtbHVuZXNjYXBlJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIGh0bWx1bmVzY2FwZSIpCgoKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydyZWFkY29va2llb25seSddID0gaSgncmVhZGNvb2tpZW9ubHknKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgcmVhZENvb2tpZU9ubHkiKQogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgaQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddID0gaSgnY29va2llamFyJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydjb29raWVqYXInXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2Nvb2tpZWphciddPScnCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIGNvb2tpZUphciIpCQkJCQkJCQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ3NldGNvb2tpZSddID0gaSgnc2V0Y29va2llJylbMF0uc3RyaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZG9uX2xvZygiUmVnZXg6IC0tIE5vdCBhIHNldGNvb2tpZSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2V4c1tpKCduYW1lJylbMF0uc3RyaW5nXVsnYXBwZW5kY29va2llJ10gPSBpKCdhcHBlbmRjb29raWUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCJSZWdleDogLS0gTm90IGEgYXBwZW5kY29va2llIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWdleHNbaSgnbmFtZScpWzBdLnN0cmluZ11bJ2lnbm9yZWNhY2hlJ10gPSBpKCdpZ25vcmVjYWNoZScpWzBdLnN0cmluZwogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBubyBpZ25vcmVjYWNoZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICN0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgICAgcmVnZXhzW2koJ25hbWUnKVswXS5zdHJpbmddWydpZ25vcmVjYWNoZSddID0gaSgnaWdub3JlY2FjaGUnKVswXS5zdHJpbmcKICAgICAgICAgICAgICAgICAgICAgICAgI2V4Y2VwdDoKICAgICAgICAgICAgICAgICAgICAgICAgIyAgICBhZGRvbl9sb2coIlJlZ2V4OiAtLSBubyBpZ25vcmVjYWNoZSIpCQkJCgogICAgICAgICAgICAgICAgICAgIHJlZ2V4cyA9IHVybGxpYi5xdW90ZShyZXByKHJlZ2V4cykpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2V4cwogICAgICAgICAgICAgICAgICAgICNwcmludCByZWdleHMKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICByZWdleHMgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgYWRkb25fbG9nKCdyZWdleCBFcnJvcjogJytuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykpCiNjb3BpZXMgZnJvbSBsYW1kYSdzIGltcGxlbWVudGF0aW9uCmRlZiBnZXRfdXN0cmVhbSh1cmwpOgogICAgdHJ5OgogICAgICAgIGZvciBpIGluIHJhbmdlKDEsIDUxKToKICAgICAgICAgICAgcmVzdWx0ID0gZ2V0VXJsKHVybCkKICAgICAgICAgICAgaWYgIkVYVC1YLVNUUkVBTS1JTkYiIGluIHJlc3VsdDogcmV0dXJuIHVybAogICAgICAgICAgICBpZiBub3QgIkVYVE0zVSIgaW4gcmVzdWx0OiByZXR1cm4KICAgICAgICAgICAgeGJtYy5zbGVlcCgyMDAwKQogICAgICAgIHJldHVybgogICAgZXhjZXB0OgogICAgICAgIHJldHVybgogICAgICAgIAogCmRlZiBnZXRSZWdleFBhcnNlZChyZWdleHMsIHVybCxjb29raWVKYXI9Tm9uZSxmb3JDb29raWVKYXJPbmx5PUZhbHNlLHJlY3Vyc2l2ZUNhbGw9RmFsc2UsY2FjaGVkUGFnZXM9e30sIHJhd1Bvc3Q9RmFsc2UsIGNvb2tpZV9qYXJfZmlsZT1Ob25lKTojMCwxLDIgPSBVUkwsIHJlZ2V4T25seSwgQ29va2llSmFyT25seQogICAgICAgIGlmIG5vdCByZWN1cnNpdmVDYWxsOgogICAgICAgICAgICByZWdleHMgPSBldmFsKHVybGxpYi51bnF1b3RlKHJlZ2V4cykpCiAgICAgICAgI2NhY2hlZFBhZ2VzID0ge30KICAgICAgICAjcHJpbnQgJ3VybCcsdXJsCiAgICAgICAgZG9SZWdleHMgPSByZS5jb21waWxlKCdcJGRvcmVnZXhcWyhbXlxdXSopXF0nKS5maW5kYWxsKHVybCkKICAgICAgICAjcHJpbnQgJ2RvUmVnZXhzJyxkb1JlZ2V4cyxyZWdleHMKICAgICAgICBzZXRyZXNvbHZlZD1UcnVlCiAgICAgICAgICAgICAgCiAKCgogICAgICAgIGZvciBrIGluIGRvUmVnZXhzOgogICAgICAgICAgICBpZiBrIGluIHJlZ2V4czoKICAgICAgICAgICAgICAgICNwcmludCAncHJvY2Vzc2luZyAnICxrCiAgICAgICAgICAgICAgICBtID0gcmVnZXhzW2tdCiAgICAgICAgICAgICAgICAjcHJpbnQgbQogICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09RmFsc2UKCgogICAgICAgICAgICAgICAgaWYgICdjb29raWVqYXInIGluIG06ICMgc28gZWl0aGVyIGNyZWF0ZSBvciByZXVzZSBleGlzdGluZyBqYXIKICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2Nvb2tpZWphciBleGlzdHMnLG1bJ2Nvb2tpZWphciddCiAgICAgICAgICAgICAgICAgICAgY29va2llSmFyUGFyYW09bVsnY29va2llamFyJ10KICAgICAgICAgICAgICAgICAgICBpZiAgJyRkb3JlZ2V4JyBpbiBjb29raWVKYXJQYXJhbToKICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnY29va2llamFyJ10sY29va2llSmFyLFRydWUsIFRydWUsY2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphclBhcmFtPVRydWUKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBjb29raWVKYXJQYXJhbT1UcnVlCiAgICAgICAgICAgICAgICAjcHJpbnQgJ21bY29va2llamFyXScsbVsnY29va2llamFyJ10sY29va2llSmFyCiAgICAgICAgICAgICAgICBpZiBjb29raWVKYXJQYXJhbToKICAgICAgICAgICAgICAgICAgICBpZiBjb29raWVKYXI9PU5vbmU6CiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY3JlYXRlIGNvb2tpZSBqYXInCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1Ob25lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdvcGVuWycgaW4gbVsnY29va2llamFyJ106CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb29raWVfamFyX2ZpbGU9bVsnY29va2llamFyJ10uc3BsaXQoJ29wZW5bJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZUphcj1nZXRDb29raWVKYXIoY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBjb29raWVfamFyX2ZpbGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29va2llSmFyKGNvb2tpZUphcixjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgICNpbXBvcnQgY29va2llbGliCiAgICAgICAgICAgICAgICAgICAgICAgICNjb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdjb29raWVKYXIgbmV3Jyxjb29raWVKYXIKICAgICAgICAgICAgICAgICAgICBlbGlmICdzYXZlWycgaW4gbVsnY29va2llamFyJ106CiAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9qYXJfZmlsZT1tWydjb29raWVqYXInXS5zcGxpdCgnc2F2ZVsnKVsxXS5zcGxpdCgnXScpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlX3BhdGg9b3MucGF0aC5qb2luKHByb2ZpbGUsY29va2llX2phcl9maWxlKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnY29tcGxldGVfcGF0aCcsY29tcGxldGVfcGF0aAogICAgICAgICAgICAgICAgICAgICAgICBzYXZlQ29va2llSmFyKGNvb2tpZUphcixjb29raWVfamFyX2ZpbGUpCiAgICAgICAgICAgICAgICAgICAgICAgIAogCiAgICAgICAgICAgICAgICBpZiAgbVsncGFnZSddIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3BhZ2UnXToKICAgICAgICAgICAgICAgICAgICBtWydwYWdlJ109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwYWdlJ10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKCiAgICAgICAgICAgICAgICBpZiAnc2V0Y29va2llJyBpbiBtIGFuZCBtWydzZXRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydzZXRjb29raWUnXToKICAgICAgICAgICAgICAgICAgICBtWydzZXRjb29raWUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ3NldGNvb2tpZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCiAgICAgICAgICAgICAgICBpZiAnYXBwZW5kY29va2llJyBpbiBtIGFuZCBtWydhcHBlbmRjb29raWUnXSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydhcHBlbmRjb29raWUnXToKICAgICAgICAgICAgICAgICAgICBtWydhcHBlbmRjb29raWUnXT1nZXRSZWdleFBhcnNlZChyZWdleHMsIG1bJ2FwcGVuZGNvb2tpZSddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMpCgogICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgICdwb3N0JyBpbiBtIGFuZCAnJGRvcmVnZXgnIGluIG1bJ3Bvc3QnXToKICAgICAgICAgICAgICAgICAgICBtWydwb3N0J109Z2V0UmVnZXhQYXJzZWQocmVnZXhzLCBtWydwb3N0J10sY29va2llSmFyLHJlY3Vyc2l2ZUNhbGw9VHJ1ZSxjYWNoZWRQYWdlcz1jYWNoZWRQYWdlcykKICAgICAgICAgICAgICAgICAgICBwcmludCAncG9zdCBpcyBub3cnLG1bJ3Bvc3QnXQoKICAgICAgICAgICAgICAgIGlmICAncmF3cG9zdCcgaW4gbSBhbmQgJyRkb3JlZ2V4JyBpbiBtWydyYXdwb3N0J106CiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsncmF3cG9zdCddLGNvb2tpZUphcixyZWN1cnNpdmVDYWxsPVRydWUsY2FjaGVkUGFnZXM9Y2FjaGVkUGFnZXMscmF3UG9zdD1UcnVlKQogICAgICAgICAgICAgICAgICAgICNwcmludCAncmF3cG9zdCBpcyBub3cnLG1bJ3Jhd3Bvc3QnXQogIAogICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZXBvY3RpbWUkJyBpbiBtWydyYXdwb3N0J106CiAgICAgICAgICAgICAgICAgICAgbVsncmF3cG9zdCddPW1bJ3Jhd3Bvc3QnXS5yZXBsYWNlKCckZXBvY3RpbWUkJyxnZXRFcG9jVGltZSgpKQogIAogICAgICAgICAgICAgICAgaWYgJ3Jhd3Bvc3QnIGluIG0gYW5kICckZXBvY3RpbWUyJCcgaW4gbVsncmF3cG9zdCddOgogICAgICAgICAgICAgICAgICAgIG1bJ3Jhd3Bvc3QnXT1tWydyYXdwb3N0J10ucmVwbGFjZSgnJGVwb2N0aW1lMiQnLGdldEVwb2NUaW1lMigpKQoKICAKICAgICAgICAgICAgICAgIGxpbms9JycKICAgICAgICAgICAgICAgIGlmIG1bJ3BhZ2UnXSBhbmQgbVsncGFnZSddIGluIGNhY2hlZFBhZ2VzIGFuZCBub3QgJ2lnbm9yZWNhY2hlJyBpbiBtIGFuZCBmb3JDb29raWVKYXJPbmx5PT1GYWxzZSA6CiAgICAgICAgICAgICAgICAgICAgbGluayA9IGNhY2hlZFBhZ2VzW21bJ3BhZ2UnXV0KICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaWYgbVsncGFnZSddIGFuZCAgbm90IG1bJ3BhZ2UnXT09JycgYW5kICBtWydwYWdlJ10uc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiAnJGVwb2N0aW1lJCcgaW4gbVsncGFnZSddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbVsncGFnZSddPW1bJ3BhZ2UnXS5yZXBsYWNlKCckZXBvY3RpbWUkJyxnZXRFcG9jVGltZSgpKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnJGVwb2N0aW1lMiQnIGluIG1bJ3BhZ2UnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1bJ3BhZ2UnXT1tWydwYWdlJ10ucmVwbGFjZSgnJGVwb2N0aW1lMiQnLGdldEVwb2NUaW1lMigpKQoKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdJbmdvcmluZyBDYWNoZScsbVsncGFnZSddCiAgICAgICAgICAgICAgICAgICAgICAgIHBhZ2Vfc3BsaXQ9bVsncGFnZSddLnNwbGl0KCd8JykKICAgICAgICAgICAgICAgICAgICAgICAgcGFnZVVybD1wYWdlX3NwbGl0WzBdCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPU5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHBhZ2Vfc3BsaXQpPjE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJfaW5fcGFnZT1wYWdlX3NwbGl0WzFdCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChwYWdlVXJsKQogICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1BZ2VudCcsICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjE7IHJ2OjE0LjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTQuMC4xJykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3JlZmVyJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ1JlZmVyZXInLCBtWydyZWZlciddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYWdlbnQnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICd4LXJlcScgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdYLVJlcXVlc3RlZC1XaXRoJywgbVsneC1yZXEnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3gtZm9yd2FyZCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5hZGRfaGVhZGVyKCdYLUZvcndhcmRlZC1Gb3InLCBtWyd4LWZvcndhcmQnXSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ3NldGNvb2tpZScgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ0Nvb2tpZScsIG1bJ3NldGNvb2tpZSddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnYXBwZW5kY29va2llJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2FwcGVuZGluZyBjb29raWUgdG8gY29va2llamFyJyxtWydhcHBlbmRjb29raWUnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llc3RvQXBlbmQ9bVsnYXBwZW5kY29va2llJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZXN0b0FwZW5kPWNvb2tpZXN0b0FwZW5kLnNwbGl0KCc7JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBoIGluIGNvb2tpZXN0b0FwZW5kOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4sdj1oLnNwbGl0KCc9JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3LG49IG4uc3BsaXQoJzonKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNrID0gY29va2llbGliLkNvb2tpZSh2ZXJzaW9uPTAsIG5hbWU9biwgdmFsdWU9diwgcG9ydD1Ob25lLCBwb3J0X3NwZWNpZmllZD1GYWxzZSwgZG9tYWluPXcsIGRvbWFpbl9zcGVjaWZpZWQ9RmFsc2UsIGRvbWFpbl9pbml0aWFsX2RvdD1GYWxzZSwgcGF0aD0nLycsIHBhdGhfc3BlY2lmaWVkPVRydWUsIHNlY3VyZT1GYWxzZSwgZXhwaXJlcz1Ob25lLCBkaXNjYXJkPVRydWUsIGNvbW1lbnQ9Tm9uZSwgY29tbWVudF91cmw9Tm9uZSwgcmVzdD17J0h0dHBPbmx5JzogTm9uZX0sIHJmYzIxMDk9RmFsc2UpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29va2llSmFyLnNldF9jb29raWUoY2spCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAnb3JpZ2luJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxLmFkZF9oZWFkZXIoJ09yaWdpbicsIG1bJ29yaWdpbiddKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBoZWFkZXJfaW5fcGFnZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcl9pbl9wYWdlPWhlYWRlcl9pbl9wYWdlLnNwbGl0KCcmJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBoIGluIGhlYWRlcl9pbl9wYWdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4sdj1oLnNwbGl0KCc9JykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXEuYWRkX2hlYWRlcihuLHYpCgoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGNvb2tpZUphcj09Tm9uZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnY29va2llSmFyVmFsJyxjb29raWVKYXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9oYW5kbGVyID0gdXJsbGliMi5IVFRQQ29va2llUHJvY2Vzc29yKGNvb2tpZUphcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKGNvb2tpZV9oYW5kbGVyLCB1cmxsaWIyLkhUVFBCYXNpY0F1dGhIYW5kbGVyKCksIHVybGxpYjIuSFRUUEhhbmRsZXIoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJ25vcmVkaXJlY3QnIGluIG06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyMiA9IHVybGxpYjIuYnVpbGRfb3BlbmVyKE5vUmVkaXJlY3Rpb24pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BlbmVyID0gdXJsbGliMi5pbnN0YWxsX29wZW5lcihvcGVuZXIyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiAnY29ubmVjdGlvbicgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICcuLi4uLi4uLi4uLi4uLi4uLi4uLi4uLi4uLmNvbm5lY3Rpb24vLy8vLy8uJyxtWydjb25uZWN0aW9uJ10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb20ga2VlcGFsaXZlIGltcG9ydCBIVFRQSGFuZGxlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAga2VlcGFsaXZlX2hhbmRsZXIgPSBIVFRQSGFuZGxlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuZXIgPSB1cmxsaWIyLmJ1aWxkX29wZW5lcihrZWVwYWxpdmVfaGFuZGxlcikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAnYWZ0ZXIgY29va2llIGphcicKICAgICAgICAgICAgICAgICAgICAgICAgcG9zdD1Ob25lCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAncG9zdCcgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3REYXRhPW1bJ3Bvc3QnXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgJyRMaXZlU3RyZWFtUmVjYXB0Y2hhJyBpbiBwb3N0RGF0YToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2FwdGNoYV9jaGFsbGVuZ2UsY2F0cGNoYV93b3JkKT1wcm9jZXNzUmVjYXB0Y2hhKG1bJ3BhZ2UnXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjYXB0Y2hhX2NoYWxsZW5nZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdERhdGErPSdyZWNhcHRjaGFfY2hhbGxlbmdlX2ZpZWxkOicrY2FwdGNoYV9jaGFsbGVuZ2UrJyxyZWNhcHRjaGFfcmVzcG9uc2VfZmllbGQ6JytjYXRwY2hhX3dvcmQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwbGl0cG9zdD1wb3N0RGF0YS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdD17fQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHAgaW4gc3BsaXRwb3N0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG49cC5zcGxpdCgnOicpWzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHY9cC5zcGxpdCgnOicpWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc3Rbbl09dgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdCA9IHVybGxpYi51cmxlbmNvZGUocG9zdCkKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdyYXdwb3N0JyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zdD1tWydyYXdwb3N0J10KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbVJlY2FwdGNoYScgaW4gcG9zdDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY2FwdGNoYV9jaGFsbGVuZ2UsY2F0cGNoYV93b3JkKT1wcm9jZXNzUmVjYXB0Y2hhKG1bJ3BhZ2UnXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjYXB0Y2hhX2NoYWxsZW5nZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3N0Kz0nJnJlY2FwdGNoYV9jaGFsbGVuZ2VfZmllbGQ9JytjYXB0Y2hhX2NoYWxsZW5nZSsnJnJlY2FwdGNoYV9yZXNwb25zZV9maWVsZD0nK2NhdHBjaGFfd29yZAoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBvc3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHVybGxpYjIudXJsb3BlbihyZXEscG9zdCkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkKCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsgPSByZXNwb25zZS5yZWFkKCkKICAgICAgICAgICAgICAgICAgICAgICAgbGluaz1qYXZhc2NyaXB0VW5Fc2NhcGUobGluaykKICAgICAgICAgICAgICAgICAgICAgICAgI3ByaW50IGxpbmsgVGhpcyBqdXN0IHByaW50IHdob2xlIHdlYnBhZ2UgaW4gTE9HCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdpbmNsdWRlaGVhZGVycycgaW4gbToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsrPXN0cihyZXNwb25zZS5oZWFkZXJzLmdldCgnU2V0LUNvb2tpZScpKQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY2xvc2UoKQogICAgICAgICAgICAgICAgICAgICAgICBjYWNoZWRQYWdlc1ttWydwYWdlJ11dID0gbGluawogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgbGluawogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ3N0b3JlIGxpbmsgZm9yJyxtWydwYWdlJ10sZm9yQ29va2llSmFyT25seQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZm9yQ29va2llSmFyT25seToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb29raWVKYXIjIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICBlbGlmIG1bJ3BhZ2UnXSBhbmQgIG5vdCBtWydwYWdlJ10uc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBtWydwYWdlJ10uc3RhcnRzd2l0aCgnJHB5RnVuY3Rpb246Jyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9ZG9FdmFsKG1bJ3BhZ2UnXS5zcGxpdCgnJHB5RnVuY3Rpb246JylbMV0sJycsY29va2llSmFyICkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvckNvb2tpZUphck9ubHk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvb2tpZUphciMgZG8gbm90aGluZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGluaz12YWwKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbms9bVsncGFnZSddCiAgICAgICAgICAgICAgICBpZiAnJHB5RnVuY3Rpb246cGxheW1lZGlhKCcgaW4gbVsnZXhwcmUnXSBvciAnQWN0aXZhdGVXaW5kb3cnICBpbiBtWydleHByZSddICAgb3IgIGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKToKICAgICAgICAgICAgICAgICAgICBzZXRyZXNvbHZlZD1GYWxzZQogICAgICAgICAgICAgICAgaWYgICckZG9yZWdleCcgaW4gbVsnZXhwcmUnXToKICAgICAgICAgICAgICAgICAgICBtWydleHByZSddPWdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgbVsnZXhwcmUnXSxjb29raWVKYXIscmVjdXJzaXZlQ2FsbD1UcnVlLGNhY2hlZFBhZ2VzPWNhY2hlZFBhZ2VzKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBub3QgbVsnZXhwcmUnXT09Jyc6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ2RvaW5nIGl0ICcsbVsnZXhwcmUnXQogICAgICAgICAgICAgICAgICAgIGlmICckTGl2ZVN0cmVhbUNhcHRjaGEnIGluIG1bJ2V4cHJlJ106CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1hc2tDYXB0Y2hhKG0sbGluayxjb29raWVKYXIpCiAgICAgICAgICAgICAgICAgICAgICAgICNwcmludCAndXJsIGFuZCB2YWwnLHVybCx2YWwKICAgICAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoIiRkb3JlZ2V4WyIgKyBrICsgIl0iLCB2YWwpCiAgICAgICAgICAgICAgICAgICAgZWxpZiBtWydleHByZSddLnN0YXJ0c3dpdGgoJyRweUZ1bmN0aW9uOicpOgogICAgICAgICAgICAgICAgICAgICAgICAjcHJpbnQgJ2V4cGVlZWVlZWVlZWVlZWVlZWVlZWUnLG1bJ2V4cHJlJ10KICAgICAgICAgICAgICAgICAgICAgICAgdmFsPWRvRXZhbChtWydleHByZSddLnNwbGl0KCckcHlGdW5jdGlvbjonKVsxXSxsaW5rLGNvb2tpZUphciApCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdBY3RpdmF0ZVdpbmRvdycgaW4gbVsnZXhwcmUnXTogcmV0dXJuIAogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAnc3RpbGwgaHJlJwogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAndXJsIGsgdmFsJyx1cmwsayx2YWwKCiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCIkZG9yZWdleFsiICsgayArICJdIiwgdmFsKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCBsaW5rPT0nJzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZyA9IHJlLmNvbXBpbGUobVsnZXhwcmUnXSkuc2VhcmNoKGxpbmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9JycKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVnLmdyb3VwKDEpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDogdHJhY2ViYWNrLnByaW50X2V4YygpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9bVsnZXhwcmUnXQogICAgICAgICAgICAgICAgICAgICAgICBpZiByYXdQb3N0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgJ3Jhd3Bvc3QnCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9dXJsbGliLnF1b3RlX3BsdXModmFsKQogICAgICAgICAgICAgICAgICAgICAgICBpZiAnaHRtbHVuZXNjYXBlJyBpbiBtOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgI3ZhbD11cmxsaWIudW5xdW90ZV9wbHVzKHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBIVE1MUGFyc2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWw9SFRNTFBhcnNlci5IVE1MUGFyc2VyKCkudW5lc2NhcGUodmFsKSAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsIHZhbCkKICAgICAgICAgICAgICAgICAgICAgICAgI3JldHVybiB2YWwKICAgICAgICAgICAgICAgIGVsc2U6ICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSgiJGRvcmVnZXhbIiArIGsgKyAiXSIsJycpCiAgICAgICAgaWYgJyRlcG9jdGltZSQnIGluIHVybDoKICAgICAgICAgICAgdXJsPXVybC5yZXBsYWNlKCckZXBvY3RpbWUkJyxnZXRFcG9jVGltZSgpKQogICAgICAgIGlmICckZXBvY3RpbWUyJCcgaW4gdXJsOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRlcG9jdGltZTIkJyxnZXRFcG9jVGltZTIoKSkKCiAgICAgICAgaWYgJyRHVUlEJCcgaW4gdXJsOgogICAgICAgICAgICBpbXBvcnQgdXVpZAogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRHVUlEJCcsc3RyKHV1aWQudXVpZDEoKSkudXBwZXIoKSkKICAgICAgICBpZiAnJGdldF9jb29raWVzJCcgaW4gdXJsOgogICAgICAgICAgICB1cmw9dXJsLnJlcGxhY2UoJyRnZXRfY29va2llcyQnLGdldENvb2tpZXNTdHJpbmcoY29va2llSmFyKSkgICAKCiAgICAgICAgaWYgcmVjdXJzaXZlQ2FsbDogcmV0dXJuIHVybAogICAgICAgIHByaW50ICdmaW5hbCB1cmwnLHVybAogICAgICAgIGlmIHVybD09IiI6IAogICAgICAgIAlyZXR1cm4KICAgICAgICBlbHNlOgogICAgICAgIAlyZXR1cm4gdXJsLHNldHJlc29sdmVkCgogICAgICAgICAgICAKICAgICAgICAKZGVmIGdldG1kNSh0KToKICAgIGltcG9ydCBoYXNobGliCiAgICBoPWhhc2hsaWIubWQ1KCkKICAgIGgudXBkYXRlKHQpCiAgICByZXR1cm4gaC5oZXhkaWdlc3QoKQoKZGVmIGRlY3J5cHRfdmF1Z2hubGl2ZShlbmNyeXB0ZWQpOgogICAgcmV0VmFsPSIiCiAgICBmb3IgdmFsIGluIGVuY3J5cHRlZC5zcGxpdCgnOicpOgogICAgICAgIHJldFZhbCs9Y2hyKGludCh2YWwucmVwbGFjZSgiMG0wIiwiIikpLzg0LzUpCiAgICByZXR1cm4gcmV0VmFsCgpkZWYgcGxheW1lZGlhKG1lZGlhX3VybCk6CiAgICB0cnk6CiAgICAgICAgaW1wb3J0ICBDdXN0b21QbGF5ZXIKICAgICAgICBwbGF5ZXIgPSBDdXN0b21QbGF5ZXIuTXlYQk1DUGxheWVyKCkKICAgICAgICBsaXN0aXRlbSA9IHhibWNndWkuTGlzdEl0ZW0oIGxhYmVsID0gc3RyKG5hbWUpLCBpY29uSW1hZ2UgPSAiRGVmYXVsdFZpZGVvLnBuZyIsIHRodW1ibmFpbEltYWdlID0geGJtYy5nZXRJbmZvSW1hZ2UoICJMaXN0SXRlbS5UaHVtYiIgKSwgcGF0aD1tZWRpYV91cmwgKQogICAgICAgIHBsYXllci5wbGF5KCBtZWRpYV91cmwsbGlzdGl0ZW0pCiAgICAgICAgeGJtYy5zbGVlcCgxMDAwKQogICAgICAgIHdoaWxlIHBsYXllci5pc19hY3RpdmU6CiAgICAgICAgICAgIHhibWMuc2xlZXAoMjAwKQogICAgZXhjZXB0OgogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoKQogICAgcmV0dXJuICcnCiAgICAKICAgICAgICAKZGVmIGdldF9zYXdfcnRtcChwYWdlX3ZhbHVlLCByZWZlcmVyPU5vbmUpOgogICAgaWYgcmVmZXJlcjoKICAgICAgICByZWZlcmVyPVsoJ1JlZmVyZXInLHJlZmVyZXIpXQogICAgaWYgcGFnZV92YWx1ZS5zdGFydHN3aXRoKCJodHRwIik6CiAgICAgICAgcGFnZV91cmw9cGFnZV92YWx1ZQogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlLGhlYWRlcnM9cmVmZXJlcikKCiAgICBzdHJfcGF0dGVybj0iKGV2YWxcKGZ1bmN0aW9uXChwLGEsYyxrLGUsKD86cnxkKS4qKSIKCiAgICByZWdfcmVzPXJlLmNvbXBpbGUoc3RyX3BhdHRlcm4pLmZpbmRhbGwocGFnZV92YWx1ZSkKICAgIHI9IiIKICAgIGlmIHJlZ19yZXMgYW5kIGxlbihyZWdfcmVzKT4wOgogICAgICAgIGZvciB2IGluIHJlZ19yZXM6CiAgICAgICAgICAgIHIxPWdldF91bnBhY2tlZCh2KQogICAgICAgICAgICByMj1yZV9tZShyMSwnXCcoLio/KVwnJykKICAgICAgICAgICAgaWYgJ3VuZXNjYXBlJyBpbiByMToKICAgICAgICAgICAgICAgIHIxPXVybGxpYi51bnF1b3RlKHIyKQogICAgICAgICAgICByKz1yMSsnXG4nCiAgICAgICAgcHJpbnQgJ2ZpbmFsIHZhbHVlIGlzICcscgogICAgICAgIAogICAgICAgIHBhZ2VfdXJsPXJlX21lKHIsJ3NyYz0iKC4qPykiJykKICAgICAgICAKICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV91cmwsaGVhZGVycz1yZWZlcmVyKQoKICAgICNwcmludCBwYWdlX3ZhbHVlCgogICAgcnRtcD1yZV9tZShwYWdlX3ZhbHVlLCdzdHJlYW1lclwnLio/XCcoLio/KVwnXCknKQogICAgcGxheXBhdGg9cmVfbWUocGFnZV92YWx1ZSwnZmlsZVwnLFxzXCcoLio/KVwnJykKCiAgICAKICAgIHJldHVybiBydG1wKycgcGxheXBhdGg9JytwbGF5cGF0aCArJyBwYWdlVXJsPScrcGFnZV91cmwKICAgIApkZWYgZ2V0X2xldG9uX3J0bXAocGFnZV92YWx1ZSwgcmVmZXJlcj1Ob25lKToKICAgIGlmIHJlZmVyZXI6CiAgICAgICAgcmVmZXJlcj1bKCdSZWZlcmVyJyxyZWZlcmVyKV0KICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgIHBhZ2VfdmFsdWU9IGdldFVybChwYWdlX3ZhbHVlLGhlYWRlcnM9cmVmZXJlcikKICAgIHN0cl9wYXR0ZXJuPSJ2YXIgYSA9ICguKj8pO1xzKnZhciBiID0gKC4qPyk7XHMqdmFyIGMgPSAoLio/KTtccyp2YXIgZCA9ICguKj8pO1xzKnZhciBmID0gKC4qPyk7XHMqdmFyIHZfcGFydCA9ICcoLio/KSc7IgogICAgcmVnX3Jlcz1yZS5jb21waWxlKHN0cl9wYXR0ZXJuKS5maW5kYWxsKHBhZ2VfdmFsdWUpWzBdIAoKICAgIGEsYixjLGQsZix2PShyZWdfcmVzKQogICAgZj1pbnQoZikKICAgIGE9aW50KGEpL2YKICAgIGI9aW50KGIpL2YKICAgIGM9aW50KGMpL2YKICAgIGQ9aW50KGQpL2YKCiAgICByZXQ9ICdydG1wOi8vJyArIHN0cihhKSArICcuJyArIHN0cihiKSArICcuJyArIHN0cihjKSArICcuJyArIHN0cihkKSArIHY7CiAgICByZXR1cm4gcmV0CgpkZWYgY3JlYXRlTTN1Rm9yRGFzaCh1cmwsdXNlcmFnZW50PU5vbmUpOgogICAgc3RyPScjRVhUTTNVJwogICAgc3RyKz0nXG4jRVhULVgtU1RSRUFNLUlORjpQUk9HUkFNLUlEPTEsQkFORFdJRFRIPTM2MTgxNicKICAgIHN0cis9J1xuJyt1cmwrJyZieXRlcz0wLTIwMDAwMCcjKyd8VXNlci1BZ2VudD0nK3VzZXJhZ2VudAogICAgc291cmNlX2ZpbGUgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSwgJ3Rlc3RmaWxlLm0zdScpCiAgICBzdHIrPSdcbicKICAgIFNhdmVUb0ZpbGUoc291cmNlX2ZpbGUsc3RyKQogICAgI3JldHVybiAnQzovVXNlcnMvc2hhbmkvRG93bmxvYWRzL3Rlc3QubTN1OCcKICAgIHJldHVybiBzb3VyY2VfZmlsZQoKZGVmIFNhdmVUb0ZpbGUoZmlsZV9uYW1lLHBhZ2VfZGF0YSxhcHBlbmQ9RmFsc2UpOgogICAgaWYgYXBwZW5kOgogICAgICAgIGYgPSBvcGVuKGZpbGVfbmFtZSwgJ2EnKQogICAgICAgIGYud3JpdGUocGFnZV9kYXRhKQogICAgICAgIGYuY2xvc2UoKSAgICAgICAgCiAgICBlbHNlOgogICAgICAgIGY9b3BlbihmaWxlX25hbWUsJ3diJykKICAgICAgICBmLndyaXRlKHBhZ2VfZGF0YSkKICAgICAgICBmLmNsb3NlKCkKICAgICAgICByZXR1cm4gJycKICAgIApkZWYgTG9hZEZpbGUoZmlsZV9uYW1lKToKCWY9b3BlbihmaWxlX25hbWUsJ3JiJykKCWQ9Zi5yZWFkKCkKCWYuY2xvc2UoKQoJcmV0dXJuIGQKICAgIApkZWYgZ2V0X3BhY2tlZF9pcGhvbmV0dl91cmwocGFnZV9kYXRhKToKCWltcG9ydCByZSxiYXNlNjQsdXJsbGliOyAKCXM9cGFnZV9kYXRhCgl3aGlsZSAnZ2VoKCcgaW4gczoKCQlpZiBzLnN0YXJ0c3dpdGgoJ2xvbCgnKTogcz1zWzU6LTFdICAgIAojCQlwcmludCAncyBpcyAnLHMKCQlzPXJlLmNvbXBpbGUoJyIoLio/KSInKS5maW5kYWxsKHMpWzBdOyAKCQlzPSAgYmFzZTY0LmI2NGRlY29kZShzKTsgCgkJcz11cmxsaWIudW5xdW90ZShzKTsgCglwcmludCBzCglyZXR1cm4gcwoKZGVmIGdldF9mZXJyYXJpX3VybChwYWdlX2RhdGEpOgogICAgcHJpbnQgJ2dldF9kYWdfdXJsMicscGFnZV9kYXRhCiAgICBwYWdlX2RhdGEyPWdldFVybChwYWdlX2RhdGEpOwogICAgcGF0dD0nKGh0dHAuKiknCiAgICBpbXBvcnQgdXVpZAogICAgcGxheWJhY2s9c3RyKHV1aWQudXVpZDEoKSkudXBwZXIoKQogICAgbGlua3M9cmUuY29tcGlsZShwYXR0KS5maW5kYWxsKHBhZ2VfZGF0YTIpCiAgICBoZWFkZXJzPVsoJ1gtUGxheWJhY2stU2Vzc2lvbi1JZCcscGxheWJhY2spXQogICAgZm9yIGwgaW4gbGlua3M6CiAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcGFnZV9kYXRhdGVtcD1nZXRVcmwobCxoZWFkZXJzPWhlYWRlcnMpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdDogcGFzcwogICAgCiAgICByZXR1cm4gcGFnZV9kYXRhKyd8JlgtUGxheWJhY2stU2Vzc2lvbi1JZD0nK3BsYXliYWNrCgogICAgCmRlZiBnZXRfZGFnX3VybChwYWdlX2RhdGEpOgogICAgcHJpbnQgJ2dldF9kYWdfdXJsJyxwYWdlX2RhdGEKICAgIGlmIHBhZ2VfZGF0YS5zdGFydHN3aXRoKCdodHRwOi8vZGFnLnRvdGFsLXN0cmVhbS5uZXQnKToKICAgICAgICBoZWFkZXJzPVsoJ1VzZXItQWdlbnQnLCdWZXJpc21vLUJsYWNrVUlfKDIuNC43LjUuOC4wLjM0KScpXQogICAgICAgIHBhZ2VfZGF0YT1nZXRVcmwocGFnZV9kYXRhLGhlYWRlcnM9aGVhZGVycyk7CgogICAgaWYgJzEyNy4wLjAuMScgaW4gcGFnZV9kYXRhOgogICAgICAgIHJldHVybiByZXZpc3RfZGFnKHBhZ2VfZGF0YSkKICAgIGVsaWYgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICE9ICcnOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJyZ2ZXJfdD0oW14mXSspJicpICsgJz93bXNBdXRoU2lnbj0nICsgcmVfbWUocGFnZV9kYXRhLCAnd21zQXV0aFNpZ24lM0QoW14lJl0rKScpICsgJz09L21wNDonICsgcmVfbWUocGFnZV9kYXRhLCAnXFw/eT0oW14mXSspJicpCiAgICBlbHNlOgogICAgICAgIGZpbmFsX3VybCA9IHJlX21lKHBhZ2VfZGF0YSwgJ2hyZWY9IihbXiJdKykiW14iXSskJykKICAgICAgICBpZiBsZW4oZmluYWxfdXJsKT09MDoKICAgICAgICAgICAgZmluYWxfdXJsPXBhZ2VfZGF0YQogICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJyAnLCAnJTIwJykKICAgIHJldHVybiBmaW5hbF91cmwKCmRlZiByZV9tZShkYXRhLCByZV9wYXR0ZW4pOgogICAgbWF0Y2ggPSAnJwogICAgbSA9IHJlLnNlYXJjaChyZV9wYXR0ZW4sIGRhdGEpCiAgICBpZiBtICE9IE5vbmU6CiAgICAgICAgbWF0Y2ggPSBtLmdyb3VwKDEpCiAgICBlbHNlOgogICAgICAgIG1hdGNoID0gJycKICAgIHJldHVybiBtYXRjaAoKZGVmIHJldmlzdF9kYWcocGFnZV9kYXRhKToKICAgIGZpbmFsX3VybCA9ICcnCiAgICBpZiAnMTI3LjAuMC4xJyBpbiBwYWdlX2RhdGE6CiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnIGxpdmU9dHJ1ZSB0aW1lb3V0PTE1IHBsYXlwYXRoPScgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbYS16QS1aMC05LV9cXC5AXSspJykKICAgICAgICAKICAgIGlmIHJlX21lKHBhZ2VfZGF0YSwgJ3Rva2VuPShbXiZdKykmJykgIT0gJyc6CiAgICAgICAgZmluYWxfdXJsID0gZmluYWxfdXJsICsgJz90b2tlbj0nICsgcmVfbWUocGFnZV9kYXRhLCAndG9rZW49KFteJl0rKSYnKQogICAgZWxpZiByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgIT0gJyc6CiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnJnZlcl90PShbXiZdKykmJykgKyAnP3dtc0F1dGhTaWduPScgKyByZV9tZShwYWdlX2RhdGEsICd3bXNBdXRoU2lnbiUzRChbXiUmXSspJykgKyAnPT0vbXA0OicgKyByZV9tZShwYWdlX2RhdGEsICdcXD95PShbXiZdKykmJykKICAgIGVsc2U6CiAgICAgICAgZmluYWxfdXJsID0gcmVfbWUocGFnZV9kYXRhLCAnSFJFRj0iKFteIl0rKSInKQoKICAgIGlmICdkYWcxLmFzeCcgaW4gZmluYWxfdXJsOgogICAgICAgIHJldHVybiBnZXRfZGFnX3VybChmaW5hbF91cmwpCgogICAgaWYgJ2RldmlubGl2ZWZzLmZwbGl2ZS5uZXQnIG5vdCBpbiBmaW5hbF91cmw6CiAgICAgICAgZmluYWxfdXJsID0gZmluYWxfdXJsLnJlcGxhY2UoJ2RldmlubGl2ZScsICdmbGl2ZScpCiAgICBpZiAncGVybWxpdmVmcy5mcGxpdmUubmV0JyBub3QgaW4gZmluYWxfdXJsOgogICAgICAgIGZpbmFsX3VybCA9IGZpbmFsX3VybC5yZXBsYWNlKCdwZXJtbGl2ZScsICdmbGl2ZScpCiAgICByZXR1cm4gZmluYWxfdXJsCgoKZGVmIGdldF91bndpc2UoIHN0cl9ldmFsKToKICAgIHBhZ2VfdmFsdWU9IiIKICAgIHRyeTogICAgICAgIAogICAgICAgIHNzPSJ3LGkscyxlPSgiK3N0cl9ldmFsKycpJyAKICAgICAgICBleGVjIChzcykKICAgICAgICBwYWdlX3ZhbHVlPXVud2lzZV9mdW5jKHcsaSxzLGUpCiAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQogICAgI3ByaW50ICd1bnBhY2tlZCcscGFnZV92YWx1ZQogICAgcmV0dXJuIHBhZ2VfdmFsdWUKICAgIApkZWYgdW53aXNlX2Z1bmMoIHcsIGksIHMsIGUpOgogICAgbElsbCA9IDA7CiAgICBsbDFJID0gMDsKICAgIElsMWwgPSAwOwogICAgbGwxbCA9IFtdOwogICAgbDFsSSA9IFtdOwogICAgd2hpbGUgVHJ1ZToKICAgICAgICBpZiAobElsbCA8IDUpOgogICAgICAgICAgICBsMWxJLmFwcGVuZCh3W2xJbGxdKQogICAgICAgIGVsaWYgKGxJbGwgPCBsZW4odykpOgogICAgICAgICAgICBsbDFsLmFwcGVuZCh3W2xJbGxdKTsKICAgICAgICBsSWxsKz0xOwogICAgICAgIGlmIChsbDFJIDwgNSk6CiAgICAgICAgICAgIGwxbEkuYXBwZW5kKGlbbGwxSV0pCiAgICAgICAgZWxpZiAobGwxSSA8IGxlbihpKSk6CiAgICAgICAgICAgIGxsMWwuYXBwZW5kKGlbbGwxSV0pCiAgICAgICAgbGwxSSs9MTsKICAgICAgICBpZiAoSWwxbCA8IDUpOgogICAgICAgICAgICBsMWxJLmFwcGVuZChzW0lsMWxdKQogICAgICAgIGVsaWYgKElsMWwgPCBsZW4ocykpOgogICAgICAgICAgICBsbDFsLmFwcGVuZChzW0lsMWxdKTsKICAgICAgICBJbDFsKz0xOwogICAgICAgIGlmIChsZW4odykgKyBsZW4oaSkgKyBsZW4ocykgKyBsZW4oZSkgPT0gbGVuKGxsMWwpICsgbGVuKGwxbEkpICsgbGVuKGUpKToKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgCiAgICBsSTFsID0gJycuam9pbihsbDFsKSMuam9pbignJyk7CiAgICBJMWxJID0gJycuam9pbihsMWxJKSMuam9pbignJyk7CiAgICBsbDFJID0gMDsKICAgIGwxbGwgPSBbXTsKICAgIGZvciBsSWxsIGluIHJhbmdlKDAsbGVuKGxsMWwpLDIpOgogICAgICAgICNwcmludCAnYXJyYXkgaScsbElsbCxsZW4obGwxbCkKICAgICAgICBsbDExID0gLTE7CiAgICAgICAgaWYgKCBvcmQoSTFsSVtsbDFJXSkgJSAyKToKICAgICAgICAgICAgbGwxMSA9IDE7CiAgICAgICAgI3ByaW50ICd2YWwgaXMgJywgbEkxbFtsSWxsOiBsSWxsKzJdCiAgICAgICAgbDFsbC5hcHBlbmQoY2hyKCAgICBpbnQobEkxbFtsSWxsOiBsSWxsKzJdLCAzNikgLSBsbDExKSk7CiAgICAgICAgbGwxSSs9MTsKICAgICAgICBpZiAobGwxSSA+PSBsZW4obDFsSSkpOgogICAgICAgICAgICBsbDFJID0gMDsKICAgIHJldD0nJy5qb2luKGwxbGwpCiAgICBpZiAnZXZhbChmdW5jdGlvbih3LGkscyxlKScgaW4gcmV0OgogICAgICAgIHByaW50ICdTVElMTCBHT2luZycKICAgICAgICByZXQ9cmUuY29tcGlsZSgnZXZhbFwoZnVuY3Rpb25cKHcsaSxzLGVcKS4qfVwoKC4qPylcKScpLmZpbmRhbGwocmV0KVswXSAKICAgICAgICByZXR1cm4gZ2V0X3Vud2lzZShyZXQpCiAgICBlbHNlOgogICAgICAgIHByaW50ICdGSU5JU0hFRCcKICAgICAgICByZXR1cm4gcmV0CiAgICAKZGVmIGdldF91bnBhY2tlZCggcGFnZV92YWx1ZSwgcmVnZXhfZm9yX3RleHQ9JycsIGl0ZXJhdGlvbnM9MSwgdG90YWxfaXRlcmF0aW9uPTEpOgogICAgdHJ5OiAgICAgICAgCiAgICAgICAgcmVnX2RhdGE9Tm9uZQogICAgICAgIGlmIHBhZ2VfdmFsdWUuc3RhcnRzd2l0aCgiaHR0cCIpOgogICAgICAgICAgICBwYWdlX3ZhbHVlPSBnZXRVcmwocGFnZV92YWx1ZSkKICAgICAgICBwcmludCAncGFnZV92YWx1ZScscGFnZV92YWx1ZQogICAgICAgIGlmIHJlZ2V4X2Zvcl90ZXh0IGFuZCBsZW4ocmVnZXhfZm9yX3RleHQpPjA6CiAgICAgICAgICAgIHBhZ2VfdmFsdWU9cmUuY29tcGlsZShyZWdleF9mb3JfdGV4dCkuZmluZGFsbChwYWdlX3ZhbHVlKVswXSAjZ2V0IHRoZSBqcyB2YXJpYWJsZQogICAgICAgIAogICAgICAgIHBhZ2VfdmFsdWU9dW5wYWNrKHBhZ2VfdmFsdWUsaXRlcmF0aW9ucyx0b3RhbF9pdGVyYXRpb24pCiAgICBleGNlcHQ6IHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQogICAgcHJpbnQgJ3VucGFja2VkJyxwYWdlX3ZhbHVlCiAgICBpZiAnc2F2MWxpdmUudHYnIGluIHBhZ2VfdmFsdWU6CiAgICAgICAgcGFnZV92YWx1ZT1wYWdlX3ZhbHVlLnJlcGxhY2UoJ3NhdjFsaXZlLnR2Jywnc2F3bGl2ZS50dicpICNxdWljayBmaXggc29tZSBidWcgc29tZXdoZXJlCiAgICAgICAgcHJpbnQgJ3NhdjEgdW5wYWNrZWQnLHBhZ2VfdmFsdWUKICAgIHJldHVybiBwYWdlX3ZhbHVlCgpkZWYgdW5wYWNrKHNKYXZhc2NyaXB0LGl0ZXJhdGlvbj0xLCB0b3RhbGl0ZXJhdGlvbnM9MiAgKToKICAgIHByaW50ICdpdGVyYXRpb24nLGl0ZXJhdGlvbgogICAgaWYgc0phdmFzY3JpcHQuc3RhcnRzd2l0aCgndmFyIF8weGNiOGE9Jyk6CiAgICAgICAgYVNwbGl0PXNKYXZhc2NyaXB0LnNwbGl0KCd2YXIgXzB4Y2I4YT0nKQogICAgICAgIHNzPSJteWFycmF5PSIrYVNwbGl0WzFdLnNwbGl0KCJldmFsKCIpWzBdCiAgICAgICAgZXhlYyhzcykKICAgICAgICBhMT02MgogICAgICAgIGMxPWludChhU3BsaXRbMV0uc3BsaXQoIiw2MiwiKVsxXS5zcGxpdCgnLCcpWzBdKQogICAgICAgIHAxPW15YXJyYXlbMF0KICAgICAgICBrMT1teWFycmF5WzNdCiAgICAgICAgd2l0aCBvcGVuKCd0ZW1wIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOgogICAgICAgICAgICBmaWxld3JpdGVyLndyaXRlKHN0cihrMSkpCiAgICAgICAgI2FhPTEvMAogICAgZWxzZToKCiAgICAgICAgYVNwbGl0ID0gc0phdmFzY3JpcHQuc3BsaXQoInJuIHB9KCciKQogICAgICAgIHByaW50IGFTcGxpdAogICAgICAgIAogICAgICAgIHAxLGExLGMxLGsxPSgnJywnMCcsJzAnLCcnKQogICAgIAogICAgICAgIHNzPSJwMSxhMSxjMSxrMT0oJyIrYVNwbGl0WzFdLnNwbGl0KCIuc3BsaSIpWzBdKycpJyAKICAgICAgICBleGVjKHNzKQogICAgazE9azEuc3BsaXQoJ3wnKQogICAgYVNwbGl0ID0gYVNwbGl0WzFdLnNwbGl0KCIpKSciKQojICAgIHByaW50ICcgcCBhcnJheSBpcyAnLGxlbihhU3BsaXQpCiMgICBwcmludCBsZW4oYVNwbGl0ICkKCiAgICAjcD1zdHIoYVNwbGl0WzBdKycpKScpIy5yZXBsYWNlKCJcXCIsIiIpIy5yZXBsYWNlKCdcXFxcJywnXFwnKQoKICAgICNwcmludCBhU3BsaXRbMV0KICAgICNhU3BsaXQgPSBhU3BsaXRbMV0uc3BsaXQoIiwiKQogICAgI3ByaW50IGFTcGxpdFswXSAKICAgICNhID0gaW50KGFTcGxpdFsxXSkKICAgICNjID0gaW50KGFTcGxpdFsyXSkKICAgICNrID0gYVNwbGl0WzNdLnNwbGl0KCIuIilbMF0ucmVwbGFjZSgiJyIsICcnKS5zcGxpdCgnfCcpCiAgICAjYT1pbnQoYSkKICAgICNjPWludChjKQogICAgCiAgICAjcD1wLnJlcGxhY2UoJ1xcJywgJycpCiMgICAgcHJpbnQgJ3AgdmFsIGlzICcscFswOjEwMF0sJy4uLi4uLi4uLi4uLicscFstMTAwOl0sbGVuKHApCiMgICAgcHJpbnQgJ3AxIHZhbCBpcyAnLHAxWzA6MTAwXSwnLi4uLi4uLi4uLi4uJyxwMVstMTAwOl0sbGVuKHAxKQogICAgCiAgICAjcHJpbnQgYSxhMQogICAgI3ByaW50IGMsYTEKICAgICNwcmludCAnayB2YWwgaXMgJyxrWy0xMDpdLGxlbihrKQojICAgIHByaW50ICdrMSB2YWwgaXMgJyxrMVstMTA6XSxsZW4oazEpCiAgICBlID0gJycKICAgIGQgPSAnJyMzMjgyMwoKICAgICNzVW5wYWNrZWQgPSBzdHIoX191bnBhY2socCwgYSwgYywgaywgZSwgZCkpCiAgICBzVW5wYWNrZWQxID0gc3RyKF9fdW5wYWNrKHAxLCBhMSwgYzEsIGsxLCBlLCBkLGl0ZXJhdGlvbikpCiAgICAKICAgICNwcmludCBzVW5wYWNrZWRbOjIwMF0rJy4uLi4nK3NVbnBhY2tlZFstMTAwOl0sIGxlbihzVW5wYWNrZWQpCiMgICAgcHJpbnQgc1VucGFja2VkMVs6MjAwXSsnLi4uLicrc1VucGFja2VkMVstMTAwOl0sIGxlbihzVW5wYWNrZWQxKQogICAgCiAgICAjZXhlYygnc1VucGFja2VkMT0iJytzVW5wYWNrZWQxKyciJykKICAgIGlmIGl0ZXJhdGlvbj49dG90YWxpdGVyYXRpb25zOgojICAgICAgICBwcmludCAnZmluYWwgcmVzJyxzVW5wYWNrZWQxWzoyMDBdKycuLi4uJytzVW5wYWNrZWQxWy0xMDA6XSwgbGVuKHNVbnBhY2tlZDEpCiAgICAgICAgcmV0dXJuIHNVbnBhY2tlZDEjLnJlcGxhY2UoJ1xcXFwnLCAnXFwnKQogICAgZWxzZToKIyAgICAgICAgcHJpbnQgJ2ZpbmFsIHJlcyBmb3IgdGhpcyBpdGVyYXRpb24gaXMnLGl0ZXJhdGlvbgogICAgICAgIHJldHVybiB1bnBhY2soc1VucGFja2VkMSxpdGVyYXRpb24rMSkjLnJlcGxhY2UoJ1xcJywgJycpLGl0ZXJhdGlvbikjLnJlcGxhY2UoJ1xcJywgJycpOyN1bnBhY2soc1VucGFja2VkLnJlcGxhY2UoJ1xcJywgJycpKQoKZGVmIF9fdW5wYWNrKHAsIGEsIGMsIGssIGUsIGQsIGl0ZXJhdGlvbix2PTEpOgoKICAgICN3aXRoIG9wZW4oJ2JlZm9yZSBmaWxlJytzdHIoaXRlcmF0aW9uKSsnLmpzJywgIndiIikgYXMgZmlsZXdyaXRlcjoKICAgICMgICAgZmlsZXdyaXRlci53cml0ZShzdHIocCkpCiAgICB3aGlsZSAoYyA+PSAxKToKICAgICAgICBjID0gYyAtMQogICAgICAgIGlmIChrW2NdKToKICAgICAgICAgICAgYWE9c3RyKF9faXRvYU5ldyhjLCBhKSkKICAgICAgICAgICAgaWYgdj09MToKICAgICAgICAgICAgICAgIHA9cmUuc3ViKCdcXGInICsgYWEgKydcXGInLCBrW2NdLCBwKSMgVEhJUyBJUyBCbG9vZHkgc2xvdyEKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHA9ZmluZEFuZFJlcGxhY2VXb3JkKHAsYWEsa1tjXSkKCiAgICAgICAgICAgICNwPWZpbmRBbmRSZXBsYWNlV29yZChwLGFhLGtbY10pCgogICAgICAgICAgICAKICAgICN3aXRoIG9wZW4oJ2FmdGVyIGZpbGUnK3N0cihpdGVyYXRpb24pKycuanMnLCAid2IiKSBhcyBmaWxld3JpdGVyOgogICAgIyAgICBmaWxld3JpdGVyLndyaXRlKHN0cihwKSkKICAgIHJldHVybiBwCgojCiNmdW5jdGlvbiBlcXVhbGF2ZW50IHRvIHJlLnN1YignXFxiJyArIGFhICsnXFxiJywga1tjXSwgcCkKZGVmIGZpbmRBbmRSZXBsYWNlV29yZChzb3VyY2Vfc3RyLCB3b3JkX3RvX2ZpbmQscmVwbGFjZV93aXRoKToKICAgIHNwbGl0cz1Ob25lCiAgICBzcGxpdHM9c291cmNlX3N0ci5zcGxpdCh3b3JkX3RvX2ZpbmQpCiAgICBpZiBsZW4oc3BsaXRzKT4xOgogICAgICAgIG5ld19zdHJpbmc9W10KICAgICAgICBjdXJyZW50X2luZGV4PTAKICAgICAgICBmb3IgY3VycmVudF9zcGxpdCBpbiBzcGxpdHM6CiAgICAgICAgICAgICNwcmludCAnaGVyZScsaQogICAgICAgICAgICBuZXdfc3RyaW5nLmFwcGVuZChjdXJyZW50X3NwbGl0KQogICAgICAgICAgICB2YWw9d29yZF90b19maW5kI2J5IGRlZmF1bHQgYXNzdW1lIGl0IHdhcyB3cm9uZyB0byBzcGxpdAoKICAgICAgICAgICAgI2lmIGl0cyBmaXJzdCBvbmUgYW5kIGl0ZW0gaXMgYmxhbmsgdGhlbiBjaGVjayBuZXh0IGl0ZW0gaXMgdmFsaWQgb3Igbm90CiAgICAgICAgICAgIGlmIGN1cnJlbnRfaW5kZXg9PWxlbihzcGxpdHMpLTE6CiAgICAgICAgICAgICAgICB2YWw9JycgIyBsYXN0IG9uZSBub3RoaW5nIHRvIGFwcGVuZCBub3JtYWxseQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgaWYgbGVuKGN1cnJlbnRfc3BsaXQpPT0wOiAjaWYgYmxhbmsgY2hlY2sgbmV4dCBvbmUgd2l0aCBjdXJyZW50IHNwbGl0IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgaWYgKCBsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPT0wIGFuZCB3b3JkX3RvX2ZpbmRbMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBvciAobGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT4wICBhbmQgc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV1bMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKTojIGZpcnN0IGp1c3QganVzdCBjaGVjayBuZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbD1yZXBsYWNlX3dpdGgKICAgICAgICAgICAgICAgICNub3QgYmxhbmssIHRoZW4gY2hlY2sgY3VycmVudCBlbmR2YWx1ZSBhbmQgbmV4dCBmaXJzdCB2YWx1ZQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiAoc3BsaXRzW2N1cnJlbnRfaW5kZXhdWy0xXS5sb3dlcigpIG5vdCBpbiAnYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXoxMjM0NTY3ODkwXycpIGFuZCAoKCBsZW4oc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV0pPT0wIGFuZCB3b3JkX3RvX2ZpbmRbMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSBvciAobGVuKHNwbGl0c1tjdXJyZW50X2luZGV4KzFdKT4wICBhbmQgc3BsaXRzW2N1cnJlbnRfaW5kZXgrMV1bMF0ubG93ZXIoKSBub3QgaW4gJ2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MTIzNDU2Nzg5MF8nKSk6IyBmaXJzdCBqdXN0IGp1c3QgY2hlY2sgbmV4dAogICAgICAgICAgICAgICAgICAgICAgICB2YWw9cmVwbGFjZV93aXRoCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBuZXdfc3RyaW5nLmFwcGVuZCh2YWwpCiAgICAgICAgICAgIGN1cnJlbnRfaW5kZXgrPTEKICAgICAgICAjYWFhYT0xLzAKICAgICAgICBzb3VyY2Vfc3RyPScnLmpvaW4obmV3X3N0cmluZykKICAgIHJldHVybiBzb3VyY2Vfc3RyICAgICAgICAKCmRlZiBfX2l0b2EobnVtLCByYWRpeCk6CiMgICAgcHJpbnQgJ251bSByZWQnLG51bSwgcmFkaXgKICAgIHJlc3VsdCA9ICIiCiAgICBpZiBudW09PTA6IHJldHVybiAnMCcKICAgIHdoaWxlIG51bSA+IDA6CiAgICAgICAgcmVzdWx0ID0gIjAxMjM0NTY3ODlhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eiJbbnVtICUgcmFkaXhdICsgcmVzdWx0CiAgICAgICAgbnVtIC89IHJhZGl4CiAgICByZXR1cm4gcmVzdWx0CgkKZGVmIF9faXRvYU5ldyhjYywgYSk6CiAgICBhYT0iIiBpZiBjYyA8IGEgZWxzZSBfX2l0b2FOZXcoaW50KGNjIC8gYSksYSkgCiAgICBjYyA9IChjYyAlIGEpCiAgICBiYj1jaHIoY2MgKyAyOSkgaWYgY2M+IDM1IGVsc2Ugc3RyKF9faXRvYShjYywzNikpCiAgICByZXR1cm4gYWErYmIKCgpkZWYgZ2V0Q29va2llc1N0cmluZyhjb29raWVKYXIpOgogICAgdHJ5OgogICAgICAgIGNvb2tpZVN0cmluZz0iIgogICAgICAgIGZvciBpbmRleCwgY29va2llIGluIGVudW1lcmF0ZShjb29raWVKYXIpOgogICAgICAgICAgICBjb29raWVTdHJpbmcrPWNvb2tpZS5uYW1lICsgIj0iICsgY29va2llLnZhbHVlICsiOyIKICAgIGV4Y2VwdDogcGFzcwogICAgI3ByaW50ICdjb29raWVTdHJpbmcnLGNvb2tpZVN0cmluZwogICAgcmV0dXJuIGNvb2tpZVN0cmluZwoKCmRlZiBzYXZlQ29va2llSmFyKGNvb2tpZUphcixDT09LSUVGSUxFKToKCXRyeToKCQljb21wbGV0ZV9wYXRoPW9zLnBhdGguam9pbihwcm9maWxlLENPT0tJRUZJTEUpCgkJY29va2llSmFyLnNhdmUoY29tcGxldGVfcGF0aCxpZ25vcmVfZGlzY2FyZD1UcnVlKQoJZXhjZXB0OiBwYXNzCgpkZWYgZ2V0Q29va2llSmFyKENPT0tJRUZJTEUpOgoKCWNvb2tpZUphcj1Ob25lCglpZiBDT09LSUVGSUxFOgoJCXRyeToKCQkJY29tcGxldGVfcGF0aD1vcy5wYXRoLmpvaW4ocHJvZmlsZSxDT09LSUVGSUxFKQoJCQljb29raWVKYXIgPSBjb29raWVsaWIuTFdQQ29va2llSmFyKCkKCQkJY29va2llSmFyLmxvYWQoY29tcGxldGVfcGF0aCxpZ25vcmVfZGlzY2FyZD1UcnVlKQoJCWV4Y2VwdDogCgkJCWNvb2tpZUphcj1Ob25lCgkKCWlmIG5vdCBjb29raWVKYXI6CgkJY29va2llSmFyID0gY29va2llbGliLkxXUENvb2tpZUphcigpCgkKCXJldHVybiBjb29raWVKYXIKICAgIApkZWYgZG9FdmFsKGZ1bl9jYWxsLHBhZ2VfZGF0YSxDb29raWVfSmFyKToKICAgIHJldF92YWw9JycKICAgIGlmIGZ1bmN0aW9uc19kaXIgbm90IGluIHN5cy5wYXRoOgogICAgICAgIHN5cy5wYXRoLmFwcGVuZChmdW5jdGlvbnNfZGlyKQogICAgCiAgICBwcmludCBmdW5fY2FsbAogICAgdHJ5OgogICAgICAgIHB5X2ZpbGU9J2ltcG9ydCAnK2Z1bl9jYWxsLnNwbGl0KCcuJylbMF0KICAgICAgICBwcmludCBweV9maWxlLHN5cy5wYXRoCiAgICAgICAgZXhlYyggcHlfZmlsZSkKICAgICAgICBwcmludCAnZG9uZScKICAgIGV4Y2VwdDoKICAgICAgICBwcmludCAnZXJyb3IgaW4gaW1wb3J0JwogICAgICAgIHRyYWNlYmFjay5wcmludF9leGMoZmlsZT1zeXMuc3Rkb3V0KQogICAgcHJpbnQgJ3JldF92YWw9JytmdW5fY2FsbAogICAgZXhlYyAoJ3JldF92YWw9JytmdW5fY2FsbCkKICAgIHByaW50IHJldF92YWwKICAgICNleGVjKCdyZXRfdmFsPTErMScpCiAgICByZXR1cm4gc3RyKHJldF92YWwpCiAgICAKZGVmIHByb2Nlc3NSZWNhcHRjaGEodXJsKToKCWh0bWxfdGV4dD1nZXRVcmwodXJsKQoJcmVjYXBDaGFsbGVuZ2U9IiIKCXNvbHV0aW9uPSIiCgljYXBfcmVnPSI8c2NyaXB0Lio/c3JjPVwiKC4qP3JlY2FwLio/KVwiIgoJbWF0Y2ggPXJlLmZpbmRhbGwoY2FwX3JlZywgaHRtbF90ZXh0KQoJY2FwdGNoYT1GYWxzZQoJY2FwdGNoYV9yZWxvYWRfcmVzcG9uc2VfY2hhbGw9Tm9uZQoJc29sdXRpb249Tm9uZQoJCglpZiBtYXRjaCBhbmQgbGVuKG1hdGNoKT4wOiAjbmV3IHNoaW55IGNhcHRjaGEhCgkJY2FwdGNoYV91cmw9bWF0Y2hbMF0KCQljYXB0Y2hhPVRydWUKCQkKCQljYXBfY2hhbGxfcmVnPSdjaGFsbGVuZ2UuKj9cJyguKj8pXCcnCgkJY2FwX2ltYWdlX3JlZz0nXCcoLio/KVwnJwoJCWNhcHRjaGFfc2NyaXB0PWdldFVybChjYXB0Y2hhX3VybCkKCQlyZWNhcENoYWxsZW5nZT1yZS5maW5kYWxsKGNhcF9jaGFsbF9yZWcsIGNhcHRjaGFfc2NyaXB0KVswXQoJCWNhcHRjaGFfcmVsb2FkPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS9yZWxvYWQ/Yz0nOwoJCWNhcHRjaGFfaz1jYXB0Y2hhX3VybC5zcGxpdCgnaz0nKVsxXQoJCWNhcHRjaGFfcmVsb2FkKz1yZWNhcENoYWxsZW5nZSsnJms9JytjYXB0Y2hhX2srJyZjYXB0Y2hhX2s9MSZ0eXBlPWltYWdlJmxhbmc9ZW4tR0InCgkJY2FwdGNoYV9yZWxvYWRfanM9Z2V0VXJsKGNhcHRjaGFfcmVsb2FkKQoJCWNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsPXJlLmZpbmRhbGwoY2FwX2ltYWdlX3JlZywgY2FwdGNoYV9yZWxvYWRfanMpWzBdCgkJY2FwdGNoYV9pbWFnZV91cmw9J2h0dHA6Ly93d3cuZ29vZ2xlLmNvbS9yZWNhcHRjaGEvYXBpL2ltYWdlP2M9JytjYXB0Y2hhX3JlbG9hZF9yZXNwb25zZV9jaGFsbAoJCWlmIG5vdCBjYXB0Y2hhX2ltYWdlX3VybC5zdGFydHN3aXRoKCJodHRwIik6CgkJCWNhcHRjaGFfaW1hZ2VfdXJsPSdodHRwOi8vd3d3Lmdvb2dsZS5jb20vcmVjYXB0Y2hhL2FwaS8nK2NhcHRjaGFfaW1hZ2VfdXJsCgkJaW1wb3J0IHJhbmRvbQoJCW49cmFuZG9tLnJhbmRyYW5nZSgxMDAsMTAwMCw1KQoJCWxvY2FsX2NhcHRjaGEgPSBvcy5wYXRoLmpvaW4ocHJvZmlsZSxzdHIobikgKyJjYXB0Y2hhLmltZyIgKQoJCWxvY2FsRmlsZSA9IG9wZW4obG9jYWxfY2FwdGNoYSwgIndiIikKCQlsb2NhbEZpbGUud3JpdGUoZ2V0VXJsKGNhcHRjaGFfaW1hZ2VfdXJsKSkKCQlsb2NhbEZpbGUuY2xvc2UoKQoJCXNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkKCQlzb2x1dGlvbiA9IHNvbHZlci5nZXQoKQoJCW9zLnJlbW92ZShsb2NhbF9jYXB0Y2hhKQoJcmV0dXJuIGNhcHRjaGFfcmVsb2FkX3Jlc3BvbnNlX2NoYWxsICxzb2x1dGlvbgoKZGVmIGdldFVybCh1cmwsIGNvb2tpZUphcj1Ob25lLHBvc3Q9Tm9uZSwgdGltZW91dD0yMCwgaGVhZGVycz1Ob25lKToKCgoJY29va2llX2hhbmRsZXIgPSB1cmxsaWIyLkhUVFBDb29raWVQcm9jZXNzb3IoY29va2llSmFyKQoJb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQoJI29wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQoJcmVxID0gdXJsbGliMi5SZXF1ZXN0KHVybCkKCXJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4xOyBXT1c2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzMzLjAuMTc1MC4xNTQgU2FmYXJpLzUzNy4zNicpCglpZiBoZWFkZXJzOgoJCWZvciBoLGh2IGluIGhlYWRlcnM6CgkJCXJlcS5hZGRfaGVhZGVyKGgsaHYpCgoJcmVzcG9uc2UgPSBvcGVuZXIub3BlbihyZXEscG9zdCx0aW1lb3V0PXRpbWVvdXQpCglsaW5rPXJlc3BvbnNlLnJlYWQoKQoJcmVzcG9uc2UuY2xvc2UoKQoJcmV0dXJuIGxpbms7CgpkZWYgZ2V0X2RlY29kZShzdHIscmVnPU5vbmUpOgoJaWYgcmVnOgoJCXN0cj1yZS5maW5kYWxsKHJlZywgc3RyKVswXQoJczEgPSB1cmxsaWIudW5xdW90ZShzdHJbMDogbGVuKHN0ciktMV0pOwoJdCA9ICcnOwoJZm9yIGkgaW4gcmFuZ2UoIGxlbihzMSkpOgoJCXQgKz0gY2hyKG9yZChzMVtpXSkgLSBzMVtsZW4oczEpLTFdKTsKCXQ9dXJsbGliLnVucXVvdGUodCkKCXByaW50IHQKCXJldHVybiB0CgpkZWYgamF2YXNjcmlwdFVuRXNjYXBlKHN0cik6Cglqcz1yZS5maW5kYWxsKCd1bmVzY2FwZVwoXCcoLio/KVwnJyxzdHIpCglwcmludCAnanMnLGpzCglpZiAobm90IGpzPT1Ob25lKSBhbmQgbGVuKGpzKT4wOgoJCWZvciBqIGluIGpzOgoJCQkjcHJpbnQgdXJsbGliLnVucXVvdGUoaikKCQkJc3RyPXN0ci5yZXBsYWNlKGogLHVybGxpYi51bnF1b3RlKGopKQoJcmV0dXJuIHN0cgoKaWlkPTAKZGVmIGFza0NhcHRjaGEobSxodG1sX3BhZ2UsIGNvb2tpZUphcik6CiAgICBnbG9iYWwgaWlkCiAgICBpaWQrPTEKICAgIGV4cHJlPSBtWydleHByZSddCiAgICBwYWdlX3VybCA9IG1bJ3BhZ2UnXQogICAgY2FwdGNoYV9yZWdleD1yZS5jb21waWxlKCdcJExpdmVTdHJlYW1DYXB0Y2hhXFsoW15cXV0qKVxdJykuZmluZGFsbChleHByZSlbMF0KCiAgICBjYXB0Y2hhX3VybD1yZS5jb21waWxlKGNhcHRjaGFfcmVnZXgpLmZpbmRhbGwoaHRtbF9wYWdlKVswXQogICAgcHJpbnQgZXhwcmUsY2FwdGNoYV9yZWdleCxjYXB0Y2hhX3VybAogICAgaWYgbm90IGNhcHRjaGFfdXJsLnN0YXJ0c3dpdGgoImh0dHAiKToKICAgICAgICBwYWdlXz0naHR0cDovLycrIiIuam9pbihwYWdlX3VybC5zcGxpdCgnLycpWzI6M10pCiAgICAgICAgaWYgY2FwdGNoYV91cmwuc3RhcnRzd2l0aCgiLyIpOgogICAgICAgICAgICBjYXB0Y2hhX3VybD1wYWdlXytjYXB0Y2hhX3VybAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGNhcHRjaGFfdXJsPXBhZ2VfKycvJytjYXB0Y2hhX3VybAogICAgCiAgICBsb2NhbF9jYXB0Y2hhID0gb3MucGF0aC5qb2luKHByb2ZpbGUsIHN0cihpaWQpKyJjYXB0Y2hhLmpwZyIgKQogICAgbG9jYWxGaWxlID0gb3Blbihsb2NhbF9jYXB0Y2hhLCAid2IiKQogICAgcHJpbnQgJyBjIGNhcHVybCcsY2FwdGNoYV91cmwKICAgIHJlcSA9IHVybGxpYjIuUmVxdWVzdChjYXB0Y2hhX3VybCkKICAgIHJlcS5hZGRfaGVhZGVyKCdVc2VyLUFnZW50JywgJ01vemlsbGEvNS4wIChXaW5kb3dzIE5UIDYuMTsgcnY6MTQuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xNC4wLjEnKQogICAgaWYgJ3JlZmVyJyBpbiBtOgogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdSZWZlcmVyJywgbVsncmVmZXInXSkKICAgIGlmICdhZ2VudCcgaW4gbToKICAgICAgICByZXEuYWRkX2hlYWRlcignVXNlci1hZ2VudCcsIG1bJ2FnZW50J10pCiAgICBpZiAnc2V0Y29va2llJyBpbiBtOgogICAgICAgIHByaW50ICdhZGRpbmcgY29va2llJyxtWydzZXRjb29raWUnXQogICAgICAgIHJlcS5hZGRfaGVhZGVyKCdDb29raWUnLCBtWydzZXRjb29raWUnXSkKICAgICAgICAKICAgICNjb29raWVfaGFuZGxlciA9IHVybGxpYjIuSFRUUENvb2tpZVByb2Nlc3Nvcihjb29raWVKYXIpCiAgICAjb3BlbmVyID0gdXJsbGliMi5idWlsZF9vcGVuZXIoY29va2llX2hhbmRsZXIsIHVybGxpYjIuSFRUUEJhc2ljQXV0aEhhbmRsZXIoKSwgdXJsbGliMi5IVFRQSGFuZGxlcigpKQogICAgI29wZW5lciA9IHVybGxpYjIuaW5zdGFsbF9vcGVuZXIob3BlbmVyKQogICAgdXJsbGliMi51cmxvcGVuKHJlcSkKICAgIHJlc3BvbnNlID0gdXJsbGliMi51cmxvcGVuKHJlcSkKCiAgICBsb2NhbEZpbGUud3JpdGUocmVzcG9uc2UucmVhZCgpKQogICAgcmVzcG9uc2UuY2xvc2UoKQogICAgbG9jYWxGaWxlLmNsb3NlKCkKICAgIHNvbHZlciA9IElucHV0V2luZG93KGNhcHRjaGE9bG9jYWxfY2FwdGNoYSkKICAgIHNvbHV0aW9uID0gc29sdmVyLmdldCgpCiAgICByZXR1cm4gc29sdXRpb24KICAgIApjbGFzcyBJbnB1dFdpbmRvdyh4Ym1jZ3VpLldpbmRvd0RpYWxvZyk6CiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICBzZWxmLmNwdGxvYyA9IGt3YXJncy5nZXQoJ2NhcHRjaGEnKQogICAgICAgIHNlbGYuaW1nID0geGJtY2d1aS5Db250cm9sSW1hZ2UoMzM1LDMwLDYyNCw2MCxzZWxmLmNwdGxvYykKICAgICAgICBzZWxmLmFkZENvbnRyb2woc2VsZi5pbWcpCiAgICAgICAgc2VsZi5rYmQgPSB4Ym1jLktleWJvYXJkKCkKCiAgICBkZWYgZ2V0KHNlbGYpOgogICAgICAgIHNlbGYuc2hvdygpCiAgICAgICAgdGltZS5zbGVlcCgyKSAgICAgICAgCiAgICAgICAgc2VsZi5rYmQuZG9Nb2RhbCgpCiAgICAgICAgaWYgKHNlbGYua2JkLmlzQ29uZmlybWVkKCkpOgogICAgICAgICAgICB0ZXh0ID0gc2VsZi5rYmQuZ2V0VGV4dCgpCiAgICAgICAgICAgIHNlbGYuY2xvc2UoKQogICAgICAgICAgICByZXR1cm4gdGV4dAogICAgICAgIHNlbGYuY2xvc2UoKQogICAgICAgIHJldHVybiBGYWxzZQogICAgCmRlZiBnZXRFcG9jVGltZSgpOgogICAgaW1wb3J0IHRpbWUKICAgIHJldHVybiBzdHIoaW50KHRpbWUudGltZSgpKjEwMDApKQoKZGVmIGdldEVwb2NUaW1lMigpOgogICAgaW1wb3J0IHRpbWUKICAgIHJldHVybiBzdHIoaW50KHRpbWUudGltZSgpKSkKCmRlZiBnZXRfcGFyYW1zKCk6CiAgICAgICAgcGFyYW09W10KICAgICAgICBwYXJhbXN0cmluZz1zeXMuYXJndlsyXQogICAgICAgIGlmIGxlbihwYXJhbXN0cmluZyk+PTI6CiAgICAgICAgICAgIHBhcmFtcz1zeXMuYXJndlsyXQogICAgICAgICAgICBjbGVhbmVkcGFyYW1zPXBhcmFtcy5yZXBsYWNlKCc/JywnJykKICAgICAgICAgICAgaWYgKHBhcmFtc1tsZW4ocGFyYW1zKS0xXT09Jy8nKToKICAgICAgICAgICAgICAgIHBhcmFtcz1wYXJhbXNbMDpsZW4ocGFyYW1zKS0yXQogICAgICAgICAgICBwYWlyc29mcGFyYW1zPWNsZWFuZWRwYXJhbXMuc3BsaXQoJyYnKQogICAgICAgICAgICBwYXJhbT17fQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4ocGFpcnNvZnBhcmFtcykpOgogICAgICAgICAgICAgICAgc3BsaXRwYXJhbXM9e30KICAgICAgICAgICAgICAgIHNwbGl0cGFyYW1zPXBhaXJzb2ZwYXJhbXNbaV0uc3BsaXQoJz0nKQogICAgICAgICAgICAgICAgaWYgKGxlbihzcGxpdHBhcmFtcykpPT0yOgogICAgICAgICAgICAgICAgICAgIHBhcmFtW3NwbGl0cGFyYW1zWzBdXT1zcGxpdHBhcmFtc1sxXQogICAgICAgIHJldHVybiBwYXJhbQoKCmRlZiBnZXRGYXZvcml0ZXMoKToKICAgICAgICBpdGVtcyA9IGpzb24ubG9hZHMob3BlbihmYXZvcml0ZXMpLnJlYWQoKSkKICAgICAgICB0b3RhbCA9IGxlbihpdGVtcykKICAgICAgICBmb3IgaSBpbiBpdGVtczoKICAgICAgICAgICAgbmFtZSA9IGlbMF0KICAgICAgICAgICAgdXJsID0gaVsxXQogICAgICAgICAgICBpY29uaW1hZ2UgPSBpWzJdCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGZhbkFydCA9IGlbM10KICAgICAgICAgICAgICAgIGlmIGZhbkFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIHJhaXNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ3VzZV90aHVtYicpID09ICJ0cnVlIjoKICAgICAgICAgICAgICAgICAgICBmYW5BcnQgPSBpY29uaW1hZ2UKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgZmFuQXJ0ID0gZmFuYXJ0CiAgICAgICAgICAgIHRyeTogcGxheWxpc3QgPSBpWzVdCiAgICAgICAgICAgIGV4Y2VwdDogcGxheWxpc3QgPSBOb25lCiAgICAgICAgICAgIHRyeTogcmVnZXhzID0gaVs2XQogICAgICAgICAgICBleGNlcHQ6IHJlZ2V4cyA9IE5vbmUKCiAgICAgICAgICAgIGlmIGlbNF0gPT0gMDoKICAgICAgICAgICAgICAgIGFkZExpbmsodXJsLG5hbWUsaWNvbmltYWdlLGZhbkFydCwnJywnJywnJywnZmF2JyxwbGF5bGlzdCxyZWdleHMsdG90YWwpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBhZGREaXIobmFtZSx1cmwsaVs0XSxpY29uaW1hZ2UsZmFuYXJ0LCcnLCcnLCcnLCcnLCdmYXYnKQoKCmRlZiBhZGRGYXZvcml0ZShuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUscGxheWxpc3Q9Tm9uZSxyZWdleHM9Tm9uZSk6CiAgICAgICAgZmF2TGlzdCA9IFtdCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGZhdm9yaXRlcyArICd0eHQnKToKICAgICAgICAgICAgb3MubWFrZWRpcnMoZmF2b3JpdGVzICsgJ3R4dCcpCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGhpc3RvcnkpOgogICAgICAgICAgICBvcy5tYWtlZGlycyhoaXN0b3J5KQogICAgICAgIHRyeToKICAgICAgICAgICAgIyBzZWVtcyB0aGF0IGFmdGVyCiAgICAgICAgICAgIG5hbWUgPSBuYW1lLmVuY29kZSgndXRmLTgnLCAnaWdub3JlJykKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmYXZvcml0ZXMpPT1GYWxzZToKICAgICAgICAgICAgYWRkb25fbG9nKCdNYWtpbmcgRmF2b3JpdGVzIEZpbGUnKQogICAgICAgICAgICBmYXZMaXN0LmFwcGVuZCgobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCxtb2RlLHBsYXlsaXN0LHJlZ2V4cykpCiAgICAgICAgICAgIGEgPSBvcGVuKGZhdm9yaXRlcywgInciKQogICAgICAgICAgICBhLndyaXRlKGpzb24uZHVtcHMoZmF2TGlzdCkpCiAgICAgICAgICAgIGEuY2xvc2UoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFkZG9uX2xvZygnQXBwZW5kaW5nIEZhdm9yaXRlcycpCiAgICAgICAgICAgIGEgPSBvcGVuKGZhdm9yaXRlcykucmVhZCgpCiAgICAgICAgICAgIGRhdGEgPSBqc29uLmxvYWRzKGEpCiAgICAgICAgICAgIGRhdGEuYXBwZW5kKChuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LG1vZGUpKQogICAgICAgICAgICBiID0gb3BlbihmYXZvcml0ZXMsICJ3IikKICAgICAgICAgICAgYi53cml0ZShqc29uLmR1bXBzKGRhdGEpKQogICAgICAgICAgICBiLmNsb3NlKCkKCgpkZWYgcm1GYXZvcml0ZShuYW1lKToKICAgICAgICBkYXRhID0ganNvbi5sb2FkcyhvcGVuKGZhdm9yaXRlcykucmVhZCgpKQogICAgICAgIGZvciBpbmRleCBpbiByYW5nZShsZW4oZGF0YSkpOgogICAgICAgICAgICBpZiBkYXRhW2luZGV4XVswXT09bmFtZToKICAgICAgICAgICAgICAgIGRlbCBkYXRhW2luZGV4XQogICAgICAgICAgICAgICAgYiA9IG9wZW4oZmF2b3JpdGVzLCAidyIpCiAgICAgICAgICAgICAgICBiLndyaXRlKGpzb24uZHVtcHMoZGF0YSkpCiAgICAgICAgICAgICAgICBiLmNsb3NlKCkKICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Db250YWluZXIuUmVmcmVzaCIpCgpkZWYgdXJsc29sdmVyKHVybCk6CiAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdVcGRhdGVjb21tb25yZXNvbHZlcnMnKSA9PSAndHJ1ZSc6CiAgICAgICAgbCA9IG9zLnBhdGguam9pbihob21lLCdnZW5lc2lzcmVzb2x2ZXJzLnB5JykKICAgICAgICBpZiB4Ym1jdmZzLmV4aXN0cyhsKToKICAgICAgICAgICAgb3MucmVtb3ZlKGwpCgogICAgICAgIGdlbmVzaXNfdXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9sYW1iZGE4MS9sYW1iZGEtYWRkb25zL21hc3Rlci9wbHVnaW4udmlkZW8uZ2VuZXNpcy9jb21tb25yZXNvbHZlcnMucHknCiAgICAgICAgdGg9IHVybGxpYi51cmxyZXRyaWV2ZShnZW5lc2lzX3VybCxsKQogICAgICAgIGFkZG9uLnNldFNldHRpbmcoJ1VwZGF0ZWNvbW1vbnJlc29sdmVycycsICdmYWxzZScpCiAgICB0cnk6CiAgICAgICAgaW1wb3J0IGdlbmVzaXNyZXNvbHZlcnMKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRGVqYVZ1LFBsZWFzZSBlbmFibGUgVXBkYXRlIENvbW1vbnJlc29sdmVycyB0byBQbGF5IGluIFNldHRpbmdzLiAtICwxMDAwMCkiKQoKICAgIHJlc29sdmVkPWdlbmVzaXNyZXNvbHZlcnMuZ2V0KHVybCkucmVzdWx0CiAgICBpZiB1cmwgPT0gcmVzb2x2ZWQgb3IgcmVzb2x2ZWQgaXMgTm9uZToKICAgICAgICAjaW1wb3J0CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRGVqYVZ1LElzIEZpbmRpbmcgWW91ciBMaW5rIC0gLDUwMDApIikKICAgICAgICBpbXBvcnQgcmVzb2x2ZXVybAogICAgICAgIGhvc3QgPSByZXNvbHZldXJsLkhvc3RlZE1lZGlhRmlsZSh1cmwpCiAgICAgICAgaWYgaG9zdDoKICAgICAgICAgICAgcmVzb2x2ZXIgPSByZXNvbHZldXJsLnJlc29sdmUodXJsKQogICAgICAgICAgICByZXNvbHZlZCA9IHJlc29sdmVyCiAgICBpZiByZXNvbHZlZCA6CiAgICAgICAgaWYgaXNpbnN0YW5jZShyZXNvbHZlZCxsaXN0KToKICAgICAgICAgICAgZm9yIGsgaW4gcmVzb2x2ZWQ6CiAgICAgICAgICAgICAgICBxdWFsaXR5ID0gYWRkb24uZ2V0U2V0dGluZygncXVhbGl0eScpCiAgICAgICAgICAgICAgICBpZiBrWydxdWFsaXR5J10gPT0gJ0hEJyAgOgogICAgICAgICAgICAgICAgICAgIHJlc29sdmVyID0ga1sndXJsJ10KICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgZWxpZiBrWydxdWFsaXR5J10gPT0gJ1NEJyA6CiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZXIgPSBrWyd1cmwnXQogICAgICAgICAgICAgICAgZWxpZiBrWydxdWFsaXR5J10gPT0gJzEwODBwJyBhbmQgYWRkb24uZ2V0U2V0dGluZygnMTA4MHBxdWFsaXR5JykgPT0gJ3RydWUnIDoKICAgICAgICAgICAgICAgICAgICByZXNvbHZlciA9IGtbJ3VybCddCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbHNlOgogICAgICAgICAgICByZXNvbHZlciA9IHJlc29sdmVkCiAgICByZXR1cm4gcmVzb2x2ZXIKZGVmIHBsYXlfcGxheWxpc3QobmFtZSwgbXVfcGxheWxpc3QpOgogICAgICAgIGltcG9ydCB1cmxwYXJzZQogICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2Fza19wbGF5bGlzdF9pdGVtcycpID09ICd0cnVlJzoKICAgICAgICAgICAgbmFtZXMgPSBbXQogICAgICAgICAgICBmb3IgaSBpbiBtdV9wbGF5bGlzdDoKICAgICAgICAgICAgICAgIGRfbmFtZT11cmxwYXJzZS51cmxwYXJzZShpKS5uZXRsb2MKICAgICAgICAgICAgICAgIGlmIGRfbmFtZSA9PSAnJzoKICAgICAgICAgICAgICAgICAgICBuYW1lcy5hcHBlbmQobmFtZSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgbmFtZXMuYXBwZW5kKGRfbmFtZSkKICAgICAgICAgICAgZGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQogICAgICAgICAgICBpbmRleCA9IGRpYWxvZy5zZWxlY3QoJ0Nob29zZSBhIHZpZGVvIHNvdXJjZScsIG5hbWVzKQogICAgICAgICAgICBpZiBpbmRleCA+PSAwOgogICAgICAgICAgICAgICAgaWYgIiZtb2RlPTE5IiBpbiBtdV9wbGF5bGlzdFtpbmRleF06CiAgICAgICAgICAgICAgICAgICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHVybHNvbHZlcihtdV9wbGF5bGlzdFtpbmRleF0ucmVwbGFjZSgnJm1vZGU9MTknLCcnKSkpCiAgICAgICAgICAgICAgICBlbGlmICIkZG9yZWdleCIgaW4gbXVfcGxheWxpc3RbaW5kZXhdIDoKCiAgICAgICAgICAgICAgICAgICAgc2VwYXRlID0gbXVfcGxheWxpc3RbaW5kZXhdLnNwbGl0KCcmcmVnZXhzPScpCgogICAgICAgICAgICAgICAgICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHNlcGF0ZVsxXSwgc2VwYXRlWzBdKQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHVybCA9IG11X3BsYXlsaXN0W2luZGV4XQogICAgICAgICAgICAgICAgICAgIHhibWMuUGxheWVyKCkucGxheSh1cmwpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcGxheWxpc3QgPSB4Ym1jLlBsYXlMaXN0KDEpICMgMSBtZWFucyB2aWRlbwogICAgICAgICAgICBwbGF5bGlzdC5jbGVhcigpCiAgICAgICAgICAgIGl0ZW0gPSAwCiAgICAgICAgICAgIGZvciBpIGluIG11X3BsYXlsaXN0OgogICAgICAgICAgICAgICAgaXRlbSArPSAxCiAgICAgICAgICAgICAgICBpbmZvID0geGJtY2d1aS5MaXN0SXRlbSgnJXMpICVzJyAlKHN0cihpdGVtKSxuYW1lKSkKICAgICAgICAgICAgICAgIHBsYXlsaXN0LmFkZChpLCBpbmZvKQogICAgICAgICAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigncGxheWxpc3QucGxheW9mZnNldCh2aWRlbywwKScpCgoKZGVmIGRvd25sb2FkX2ZpbGUobmFtZSwgdXJsKToKICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdzYXZlX2xvY2F0aW9uJykgPT0gIiI6CiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKCdEZWphVnUnLCdDaG9vc2UgYSBsb2NhdGlvbiB0byBzYXZlIGZpbGVzLicsMTUwMDAsIitpY29uKyIpIikKICAgICAgICAgICAgYWRkb24ub3BlblNldHRpbmdzKCkKICAgICAgICBwYXJhbXMgPSB7J3VybCc6IHVybCwgJ2Rvd25sb2FkX3BhdGgnOiBhZGRvbi5nZXRTZXR0aW5nKCdzYXZlX2xvY2F0aW9uJyl9CiAgICAgICAgZG93bmxvYWRlci5kb3dubG9hZChuYW1lLCBwYXJhbXMpCiAgICAgICAgZGlhbG9nID0geGJtY2d1aS5EaWFsb2coKQogICAgICAgIHJldCA9IGRpYWxvZy55ZXNubygnRGVqYVZ1JywgJ0RvIHlvdSB3YW50IHRvIGFkZCB0aGlzIGZpbGUgYXMgYSBzb3VyY2U/JykKICAgICAgICBpZiByZXQ6CiAgICAgICAgICAgIGFkZFNvdXJjZShvcy5wYXRoLmpvaW4oYWRkb24uZ2V0U2V0dGluZygnc2F2ZV9sb2NhdGlvbicpLCBuYW1lKSkKCgpkZWYgYWRkRGlyKG5hbWUsdXJsLG1vZGUsaWNvbmltYWdlLGZhbmFydCxkZXNjcmlwdGlvbixnZW5yZSxkYXRlLGNyZWRpdHMsc2hvd2NvbnRleHQ9RmFsc2UpOgogICAgICAgIAogICAgICAgIHU9c3lzLmFyZ3ZbMF0rIj91cmw9Iit1cmxsaWIucXVvdGVfcGx1cyh1cmwpKyImbW9kZT0iK3N0cihtb2RlKSsiJm5hbWU9Iit1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSsiJmljb25pbWFnZT0iK3VybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSkrIiZmYW5hcnQ9Iit1cmxsaWIucXVvdGVfcGx1cyhmYW5hcnQpCiAgICAgICAgb2s9VHJ1ZQogICAgICAgIGlmIGRhdGUgPT0gJyc6CiAgICAgICAgICAgIGRhdGUgPSBOb25lCiAgICAgICAgZWxzZToKICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuXG5EYXRlOiAlcycgJWRhdGUKICAgICAgICBsaXo9eGJtY2d1aS5MaXN0SXRlbShuYW1lLCBpY29uSW1hZ2U9IkRlZmF1bHRGb2xkZXIucG5nIiwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSwgImNyZWRpdHMiOiBjcmVkaXRzIH0pCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJGYW5hcnRfSW1hZ2UiLCBmYW5hcnQpCiAgICAgICAgaWYgc2hvd2NvbnRleHQ6CiAgICAgICAgICAgIGNvbnRleHRNZW51ID0gW10KICAgICAgICAgICAgaWYgc2hvd2NvbnRleHQgPT0gJ3NvdXJjZSc6CiAgICAgICAgICAgICAgICBpZiBuYW1lIGluIHN0cihTT1VSQ0VTKToKICAgICAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdSZW1vdmUgZnJvbSBTb3VyY2VzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT04Jm5hbWU9JXMpJyAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQogICAgICAgICAgICBlbGlmIHNob3djb250ZXh0ID09ICdkb3dubG9hZCc6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdEb3dubG9hZCcsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTkmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpCiAgICAgICAgICAgIGVsaWYgc2hvd2NvbnRleHQgPT0gJ2Zhdic6CiAgICAgICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdSZW1vdmUgZnJvbSBBZGQtb24gRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXM/bW9kZT02Jm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKQoJCQkJCQkJCQkKICAgICAgICAgICAgaWYgbm90IG5hbWUgaW4gRkFWOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnQWRkIHRvIEFkZC1vbiBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTUmbmFtZT0lcyZ1cmw9JXMmaWNvbmltYWdlPSVzJmZhbmFydD0lcyZmYXZfbW9kZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMoaWNvbmltYWdlKSwgdXJsbGliLnF1b3RlX3BsdXMoZmFuYXJ0KSwgbW9kZSkpKQogICAgICAgICAgICBsaXouYWRkQ29udGV4dE1lbnVJdGVtcyhjb250ZXh0TWVudSkKICAgICAgICBvaz14Ym1jcGx1Z2luLmFkZERpcmVjdG9yeUl0ZW0oaGFuZGxlPWludChzeXMuYXJndlsxXSksdXJsPXUsbGlzdGl0ZW09bGl6LGlzRm9sZGVyPVRydWUpCgogICAgICAgIHJldHVybiBvawpkZWYgeXRkbF9kb3dubG9hZCh1cmwsdGl0bGUsbWVkaWFfdHlwZT0ndmlkZW8nKToKICAgICMgcGxheSBpbiB4Ym1jIHdoaWxlIHBsYXlpbmcgZ28gYmFjayB0byBjb250ZXh0TWVudShjKSB0byAiISFEb3dubG9hZCEhIgogICAgIyBUcmlhbCB5YXNjZWVuOiBzZXBlcmF0ZSB8VXNlci1BZ2VudD0KICAgIGltcG9ydCB5b3V0dWJlZGwKICAgIGlmIG5vdCB1cmwgPT0gJyc6CiAgICAgICAgaWYgbWVkaWFfdHlwZT09ICdhdWRpbyc6CiAgICAgICAgICAgIHlvdXR1YmVkbC5zaW5nbGVfWUQodXJsLGRvd25sb2FkPVRydWUsYXVkaW89VHJ1ZSkKICAgICAgICBlbHNlOgogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKHVybCxkb3dubG9hZD1UcnVlKSAgIAogICAgZWxpZiB4Ym1jLlBsYXllcigpLmlzUGxheWluZygpID09IFRydWUgOgogICAgICAgIGltcG9ydCBZRFN0cmVhbUV4dHJhY3RvcgogICAgICAgIGlmIFlEU3RyZWFtRXh0cmFjdG9yLmlzRG93bmxvYWRpbmcoKSA9PSBUcnVlOgoKICAgICAgICAgICAgWURTdHJlYW1FeHRyYWN0b3IubWFuYWdlRG93bmxvYWRzKCkKICAgICAgICBlbHNlOgogICAgICAgICAgICB4Ym1jX3VybCA9IHhibWMuUGxheWVyKCkuZ2V0UGxheWluZ0ZpbGUoKQoKICAgICAgICAgICAgeGJtY191cmwgPSB4Ym1jX3VybC5zcGxpdCgnfFVzZXItQWdlbnQ9JylbMF0KICAgICAgICAgICAgaW5mbyA9IHsndXJsJzp4Ym1jX3VybCwndGl0bGUnOnRpdGxlLCdtZWRpYV90eXBlJzptZWRpYV90eXBlfQogICAgICAgICAgICB5b3V0dWJlZGwuc2luZ2xlX1lEKCcnLGRvd25sb2FkPVRydWUsZGxfaW5mbz1pbmZvKSAgICAKICAgIGVsc2U6CiAgICAgICAgeGJtYy5leGVjdXRlYnVpbHRpbigiWEJNQy5Ob3RpZmljYXRpb24oRE9XTkxPQUQsRmlyc3QgUGxheSBbQ09MT1IgeWVsbG93XVdISUxFIHBsYXlpbmcgZG93bmxvYWRbL0NPTE9SXSAsMTAwMDApIikKIApkZWYgc2VhcmNoKHNpdGVfbmFtZSxzZWFyY2hfdGVybT1Ob25lKToKICAgIHRodW1ibmFpbD0nJwogICAgaWYgb3MucGF0aC5leGlzdHMoaGlzdG9yeSkgPT0gRmFsc2Ugb3IgYWRkb24uZ2V0U2V0dGluZygnY2xlYXJzZWFjaGhpc3RvcnknKT09J3RydWUnOgogICAgICAgIFNhdmVUb0ZpbGUoaGlzdG9yeSwnJykKICAgICAgICBhZGRvbi5zZXRTZXR0aW5nKCJjbGVhcnNlYWNoaGlzdG9yeSIsImZhbHNlIikKICAgIGlmIHNpdGVfbmFtZSA9PSAnaGlzdG9yeScgOgogICAgICAgIGNvbnRlbnQgPSBMb2FkRmlsZShoaXN0b3J5KQogICAgICAgIG1hdGNoID0gcmUuY29tcGlsZSgnKC4rPyk6KC4qPykoPzpccnxcbiknKS5maW5kYWxsKGNvbnRlbnQpCgogICAgICAgIGZvciBuYW1lLHNlYXJjaF90ZXJtIGluIG1hdGNoOgogICAgICAgICAgICBpZiAncGx1Z2luOi8vJyBpbiBzZWFyY2hfdGVybToKICAgICAgICAgICAgICAgIGFkZExpbmsoc2VhcmNoX3Rlcm0sIG5hbWUsdGh1bWJuYWlsLCcnLCcnLCcnLCcnLCcnLE5vbmUsJycsdG90YWw9aW50KGxlbihtYXRjaCkpKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYWRkRGlyKG5hbWUrJzonK3NlYXJjaF90ZXJtLG5hbWUsMjYsaWNvbixGQU5BUlQsJycsJycsJycsJycpCiAgICBpZiBub3Qgc2VhcmNoX3Rlcm06ICAgIAogICAgICAgIGtleWJvYXJkID0geGJtYy5LZXlib2FyZCgnJywnRW50ZXIgU2VhcmNoIFRlcm0nKQogICAgICAgIGtleWJvYXJkLmRvTW9kYWwoKQogICAgICAgIGlmIChrZXlib2FyZC5pc0NvbmZpcm1lZCgpID09IEZhbHNlKToKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgc2VhcmNoX3Rlcm0gPSBrZXlib2FyZC5nZXRUZXh0KCkKICAgICAgICBpZiBsZW4oc2VhcmNoX3Rlcm0pID09IDA6CiAgICAgICAgICAgIHJldHVybiAgICAgICAgCiAgICBzZWFyY2hfdGVybSA9IHNlYXJjaF90ZXJtLnJlcGxhY2UoJyAnLCcrJykKICAgIHNlYXJjaF90ZXJtID0gc2VhcmNoX3Rlcm0uZW5jb2RlKCd1dGYtOCcpCiAgICBpZiAneW91dHViZScgaW4gc2l0ZV9uYW1lOgogICAgICAgICN5b3V0dWJlID0geW91dHViZSNMYW5hIERlbCBSZXkKICAgICAgICBpbXBvcnQgX3l0cGxpc3QKCiAgICAgICAgc2VhcmNoX3JlcyA9IHt9CiAgICAgICAgc2VhcmNoX3JlcyA9IF95dHBsaXN0LllvVVR1YmUoJ3NlYXJjaFlUJyx5b3V0dWJlPXNlYXJjaF90ZXJtLG1heF9wYWdlPTQsbm9zYXZlPSdub3NhdmUnKQogICAgICAgIHRvdGFsID0gbGVuKHNlYXJjaF9yZXMpCiAgICAgICAgZm9yIGl0ZW0gaW4gc2VhcmNoX3JlczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbmFtZSA9IHNlYXJjaF9yZXNbaXRlbV1bJ3RpdGxlJ10KICAgICAgICAgICAgICAgIGRhdGU9IHNlYXJjaF9yZXNbaXRlbV1bJ2RhdGUnXQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gc2VhcmNoX3Jlc1tpdGVtXVsnZGVzYyddCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ1VOQVZBSUFCTEUnCgogICAgICAgICAgICAgICAgdXJsID0gJ3BsdWdpbjovL3BsdWdpbi52aWRlby55b3V0dWJlL3BsYXkvP3ZpZGVvX2lkPScgKyBzZWFyY2hfcmVzW2l0ZW1dWyd1cmwnXQogICAgICAgICAgICAgICAgdGh1bWJuYWlsID0naHR0cDovL2ltZy55b3V0dWJlLmNvbS92aS8nK3NlYXJjaF9yZXNbaXRlbV1bJ3VybCddKycvMC5qcGcnCiAgICAgICAgICAgICAgICBhZGRMaW5rKHVybCwgbmFtZSx0aHVtYm5haWwsJycsJycsJycsJycsJycsTm9uZSwnJyx0b3RhbCkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgCWFkZG9uX2xvZyggJ1RoaXMgaXRlbSBpcyBpZ25vcmVkOjonKQogICAgICAgIHBhZ2VfZGF0YSA9IHNpdGVfbmFtZSArJzonKyBzZWFyY2hfdGVybSArICdcbicKICAgICAgICBTYXZlVG9GaWxlKG9zLnBhdGguam9pbihwcm9maWxlLCdoaXN0b3J5JykscGFnZV9kYXRhLGFwcGVuZD1UcnVlKQogICAgZWxpZiAnZG1vdGlvbicgaW4gc2l0ZV9uYW1lOgogICAgICAgIHVybE1haW4gPSAiaHR0cHM6Ly9hcGkuZGFpbHltb3Rpb24uY29tIiAKICAgICAgICAjeW91dHViZSA9IHlvdXR1YmUjTGFuYSBEZWwgUmV5CiAgICAgICAgaW1wb3J0IF9ETXNlYXJjaAogICAgICAgIGZhbWlseUZpbHRlciA9IHN0cihhZGRvbi5nZXRTZXR0aW5nKCdmYW1pbHlGaWx0ZXInKSkKICAgICAgICBfRE1zZWFyY2gubGlzdFZpZGVvcyh1cmxNYWluKyIvdmlkZW9zP2ZpZWxkcz1kZXNjcmlwdGlvbixkdXJhdGlvbixpZCxvd25lci51c2VybmFtZSx0YWtlbl90aW1lLHRodW1ibmFpbF9sYXJnZV91cmwsdGl0bGUsdmlld3NfdG90YWwmc2VhcmNoPSIrc2VhcmNoX3Rlcm0rIiZzb3J0PXJlbGV2YW5jZSZsaW1pdD0xMDAmZmFtaWx5X2ZpbHRlcj0iK2ZhbWlseUZpbHRlcisiJmxvY2FsaXphdGlvbj1lbl9FTiZwYWdlPTEiKQogICAgCiAgICAgICAgcGFnZV9kYXRhID0gc2l0ZV9uYW1lICsnOicrIHNlYXJjaF90ZXJtKyAnXG4nCiAgICAgICAgU2F2ZVRvRmlsZShvcy5wYXRoLmpvaW4ocHJvZmlsZSwnaGlzdG9yeScpLHBhZ2VfZGF0YSxhcHBlbmQ9VHJ1ZSkgICAgICAgIAogICAgZWxpZiAnSU1EQmlkcGxheScgaW4gc2l0ZV9uYW1lOgogICAgICAgIHVybE1haW4gPSAiaHR0cDovL3d3dy5vbWRiYXBpLmNvbS8/dD0iIAogICAgICAgIHVybD0gdXJsTWFpbitzZWFyY2hfdGVybQoKICAgICAgICBoZWFkZXJzID0gZGljdCh7J1VzZXItQWdlbnQnOidNb3ppbGxhLzUuMCAoV2luZG93cyBOVCA2LjM7IHJ2OjMzLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMzMuMCcsJ1JlZmVyZXInOiAnaHR0cDovL2pva2VyLm9yZy8nLCdBY2NlcHQtRW5jb2RpbmcnOidnemlwLCBkZWZsYXRlJywnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOCcsJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uLCB0ZXh0L3BsYWluLCAqLyonfSkKICAgIAogICAgICAgIHI9cmVxdWVzdHMuZ2V0KHVybCxoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgZGF0YSA9IHIuanNvbigpCiAgICAgICAgcmVzID0gZGF0YVsnUmVzcG9uc2UnXQogICAgICAgIGlmIHJlcyA9PSAnVHJ1ZSc6CiAgICAgICAgICAgIGltZGJJRCA9IGRhdGFbJ2ltZGJJRCddCiAgICAgICAgICAgIG5hbWU9IGRhdGFbJ1RpdGxlJ10gKyBkYXRhWydSZWxlYXNlZCddCiAgICAgICAgICAgIGRpYWxvZyA9IHhibWNndWkuRGlhbG9nKCkKICAgICAgICAgICAgcmV0ID0gZGlhbG9nLnllc25vKCdDaGVjayBNb3ZpZSBUaXRsZScsICdQTEFZIDo6ICVzID8nJW5hbWUpCiAgICAgICAgICAgIGlmIHJldDoKICAgICAgICAgICAgICAgIHVybCA9ICdwbHVnaW46Ly9wbHVnaW4udmlkZW8ucHVsc2FyL21vdmllLycraW1kYklEKycvcGxheScKICAgICAgICAgICAgICAgIHBhZ2VfZGF0YSA9IG5hbWUgKyc6JysgdXJsKyAnXG4nCiAgICAgICAgICAgICAgICBTYXZlVG9GaWxlKGhpc3RvcnkscGFnZV9kYXRhLGFwcGVuZD1UcnVlKQogICAgICAgICAgICAgICAgcmV0dXJuIHVybAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKFNpbXBsZUtvcmUsTm8gSU1EQiBtYXRjaCBmb3VuZCAsNzAwMCwiK2ljb24rIikiKQojIyBMdW5hdGl4eiBQc2V1ZG9UViBmZWF0dXJlCmRlZiBhc2NpaShzdHJpbmcpOgogICAgaWYgaXNpbnN0YW5jZShzdHJpbmcsIGJhc2VzdHJpbmcpOgogICAgICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCB1bmljb2RlKToKICAgICAgICAgICBzdHJpbmcgPSBzdHJpbmcuZW5jb2RlKCdhc2NpaScsICdpZ25vcmUnKQogICAgcmV0dXJuIHN0cmluZwpkZWYgdW5pKHN0cmluZywgZW5jb2RpbmcgPSAndXRmLTgnKToKICAgIGlmIGlzaW5zdGFuY2Uoc3RyaW5nLCBiYXNlc3RyaW5nKToKICAgICAgICBpZiBub3QgaXNpbnN0YW5jZShzdHJpbmcsIHVuaWNvZGUpOgogICAgICAgICAgICBzdHJpbmcgPSB1bmljb2RlKHN0cmluZywgZW5jb2RpbmcsICdpZ25vcmUnKQogICAgcmV0dXJuIHN0cmluZwpkZWYgcmVtb3ZlTm9uQXNjaWkocyk6IHJldHVybiAiIi5qb2luKGZpbHRlcihsYW1iZGEgeDogb3JkKHgpPDEyOCwgcykpCgpkZWYgc2VuZEpTT04oIGNvbW1hbmQpOgogICAgZGF0YSA9ICcnCiAgICB0cnk6CiAgICAgICAgZGF0YSA9IHhibWMuZXhlY3V0ZUpTT05SUEModW5pKGNvbW1hbmQpKQogICAgZXhjZXB0IFVuaWNvZGVFbmNvZGVFcnJvcjoKICAgICAgICBkYXRhID0geGJtYy5leGVjdXRlSlNPTlJQQyhhc2NpaShjb21tYW5kKSkKCiAgICByZXR1cm4gdW5pKGRhdGEpCgojaGFrYW1hYyB0aGFua3MgUm9tYW5fVl9NCmRlZiBTZXRWaWV3VGh1bWJuYWlsKCk6CiAgICBza2luX3VzZWQgPSB4Ym1jLmdldFNraW5EaXIoKQogICAgaWYgc2tpbl91c2VkID09ICdza2luLmNvbmZsdWVuY2UnOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ0NvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApJykKICAgIGVsaWYgc2tpbl91c2VkID09ICdza2luLmFlb24ubm94JzoKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdDb250YWluZXIuU2V0Vmlld01vZGUoNTExKScpIAogICAgZWxzZToKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdDb250YWluZXIuU2V0Vmlld01vZGUoNTAwKScpCgkKCQpkZWYgcGx1Z2lucXVlcnlieUpTT04odXJsKToKICAgIGpzb25fcXVlcnkgPSB1bmkoJ3sianNvbnJwYyI6IjIuMCIsIm1ldGhvZCI6IkZpbGVzLkdldERpcmVjdG9yeSIsInBhcmFtcyI6eyJkaXJlY3RvcnkiOiIlcyIsIm1lZGlhIjoidmlkZW8iLCJwcm9wZXJ0aWVzIjpbInRodW1ibmFpbCIsInRpdGxlIiwieWVhciIsImRhdGVhZGRlZCIsImZhbmFydCIsInJhdGluZyIsInNlYXNvbiIsImVwaXNvZGUiLCJzdHVkaW8iXX0sImlkIjoxfScpICV1cmwKCiAgICBqc29uX2ZvbGRlcl9kZXRhaWwgPSBqc29uLmxvYWRzKHNlbmRKU09OKGpzb25fcXVlcnkpKQogICAgZm9yIGkgaW4ganNvbl9mb2xkZXJfZGV0YWlsWydyZXN1bHQnXVsnZmlsZXMnXSA6CiAgICAgICAgdXJsID0gaVsnZmlsZSddCiAgICAgICAgbmFtZSA9IHJlbW92ZU5vbkFzY2lpKGlbJ2xhYmVsJ10pCiAgICAgICAgdGh1bWJuYWlsID0gcmVtb3ZlTm9uQXNjaWkoaVsndGh1bWJuYWlsJ10pCiAgICAgICAgdHJ5OgogICAgICAgICAgICBmYW5hcnQgPSByZW1vdmVOb25Bc2NpaShpWydmYW5hcnQnXSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICBmYW5hcnQgPSAnJwogICAgICAgIHRyeToKICAgICAgICAgICAgZGF0ZSA9IGlbJ3llYXInXQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIGRhdGUgPSAnJwogICAgICAgIHRyeToKICAgICAgICAgICAgZXBpc29kZSA9IGlbJ2VwaXNvZGUnXQogICAgICAgICAgICBzZWFzb24gPSBpWydzZWFzb24nXQogICAgICAgICAgICBpZiBlcGlzb2RlID09IC0xIG9yIHNlYXNvbiA9PSAtMToKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJycKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uID0gJ1tDT0xPUiB5ZWxsb3ddIFMnICsgc3RyKHNlYXNvbikrJ1svQ09MT1JdW0NPTE9SIGhvdHBpbmtdIEUnICsgc3RyKGVwaXNvZGUpICsnWy9DT0xPUl0nCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgZGVzY3JpcHRpb24gPSAnJwogICAgICAgIHRyeToKICAgICAgICAgICAgc3R1ZGlvID0gaVsnc3R1ZGlvJ10KICAgICAgICAgICAgaWYgc3R1ZGlvOgogICAgICAgICAgICAgICAgZGVzY3JpcHRpb24gKz0gJ1xuIFN0dWRpbzpbQ09MT1Igc3RlZWxibHVlXSAnICsgc3R1ZGlvWzBdICsgJ1svQ09MT1JdJwogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHN0dWRpbyA9ICcnCgogICAgICAgIGlmIGlbJ2ZpbGV0eXBlJ10gPT0gJ2ZpbGUnOgogICAgICAgICAgICBhZGRMaW5rKHVybCxuYW1lLHRodW1ibmFpbCxmYW5hcnQsZGVzY3JpcHRpb24sJycsZGF0ZSwnJyxOb25lLCcnLHRvdGFsPWxlbihqc29uX2ZvbGRlcl9kZXRhaWxbJ3Jlc3VsdCddWydmaWxlcyddKSkKICAgICAgICAgICAgI3hibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApIikKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWRkRGlyKG5hbWUsdXJsLDUzLHRodW1ibmFpbCxmYW5hcnQsZGVzY3JpcHRpb24sJycsZGF0ZSwnJykKICAgICAgICAgICAgI3hibWMuZXhlY3V0ZWJ1aWx0aW4oIkNvbnRhaW5lci5TZXRWaWV3TW9kZSg1MDApIikKCmRlZiBhZGRMaW5rKHVybCxuYW1lLGljb25pbWFnZSxmYW5hcnQsZGVzY3JpcHRpb24sZ2VucmUsZGF0ZSxzaG93Y29udGV4dCxwbGF5bGlzdCxyZWdleHMsdG90YWwsc2V0Q29va2llPSIiKToKICAgICAgICAjcHJpbnQgJ3VybCxuYW1lJyx1cmwsbmFtZQogICAgICAgIGNvbnRleHRNZW51ID1bXQogICAgICAgIHRyeToKICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgb2sgPSBUcnVlCiAgICAgICAKICAgICAgICBpZiByZWdleHM6IAogICAgICAgICAgICBtb2RlID0gJzE3JwogICAgICAgICAgIAogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCBDdXJyZW50bHkgUGxheWluZyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMSZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgICAgICAgICAgIAogICAgICAgIGVsaWYgIGFueSh4IGluIHVybCBmb3IgeCBpbiByZXNvbHZlX3VybCkgYW5kICB1cmwuc3RhcnRzd2l0aCgnaHR0cCcpOgogICAgICAgICAgICBtb2RlID0gJzE5JwogICAgICAgICAgCiAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ1tDT0xPUiB3aGl0ZV0hIURvd25sb2FkIEN1cnJlbnRseSBQbGF5aW5nISFbL0NPTE9SXScsJ1hCTUMuUnVuUGx1Z2luKCVzP3VybD0lcyZtb2RlPTIxJm5hbWU9JXMpJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAlKHN5cy5hcmd2WzBdLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpLCB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKSkpKSAgICAgICAgICAgCiAgICAgICAgZWxpZiB1cmwuZW5kc3dpdGgoJyZtb2RlPTE4Jyk6CiAgICAgICAgICAgIHVybD11cmwucmVwbGFjZSgnJm1vZGU9MTgnLCcnKQogICAgICAgICAgICBtb2RlID0gJzE4JyAKICAgICAgICAgIAogICAgICAgICAgICBjb250ZXh0TWVudS5hcHBlbmQoKCdbQ09MT1Igd2hpdGVdISFEb3dubG9hZCEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yMyZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXModXJsKSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSkpKSkgCiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2RsYXVkaW9vbmx5JykgPT0gJ3RydWUnOgogICAgICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnISFEb3dubG9hZCBbQ09MT1Igc2VhYmx1ZV1BdWRpbyEhWy9DT0xPUl0nLCdYQk1DLlJ1blBsdWdpbiglcz91cmw9JXMmbW9kZT0yNCZuYW1lPSVzKScKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGVsaWYgdXJsLnN0YXJ0c3dpdGgoJ21hZ25ldDo/eHQ9Jykgb3IgJy50b3JyZW50JyBpbiB1cmw6CiAgICAgICAgICAKICAgICAgICAgICAgaWYgJyYnIGluIHVybCBhbmQgbm90ICcmYW1wOycgaW4gdXJsIDoKICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCcmJywnJmFtcDsnKQogICAgICAgICAgICB1cmwgPSAncGx1Z2luOi8vcGx1Z2luLnZpZGVvLnB1bHNhci9wbGF5P3VyaT0nICsgdXJsCiAgICAgICAgICAgIG1vZGUgPSAnMTInCiAgICAgICAgICAgICAgICAgICAgIAogICAgICAgIGVsc2U6IAogICAgICAgICAgICBtb2RlID0gJzEyJwogICAgICAKICAgICAgICAgICAgY29udGV4dE1lbnUuYXBwZW5kKCgnW0NPTE9SIHdoaXRlXSEhRG93bmxvYWQgQ3VycmVudGx5IFBsYXlpbmchIVsvQ09MT1JdJywnWEJNQy5SdW5QbHVnaW4oJXM/dXJsPSVzJm1vZGU9MjEmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkpICAgICAgICAgICAKICAgICAgICB1PXN5cy5hcmd2WzBdKyI/IgogICAgICAgIHBsYXlfbGlzdCA9IEZhbHNlCiAgICAgIAogICAgICAgIGlmIHBsYXlsaXN0OgogICAgICAgICAgICBpZiBhZGRvbi5nZXRTZXR0aW5nKCdhZGRfcGxheWxpc3QnKSA9PSAiZmFsc2UiOgogICAgICAgICAgICAgICAgdSArPSAidXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9Iittb2RlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICB1ICs9ICJtb2RlPTEzJm5hbWU9JXMmcGxheWxpc3Q9JXMiICUodXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHN0cihwbGF5bGlzdCkucmVwbGFjZSgnLCcsJ3x8JykpKQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUgKyAnW0NPTE9SIG1hZ2VudGFdICgnICsgc3RyKGxlbihwbGF5bGlzdCkpICsgJyBpdGVtcyApWy9DT0xPUl0nCiAgICAgICAgICAgICAgICBwbGF5X2xpc3QgPSBUcnVlCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdSArPSAidXJsPSIrdXJsbGliLnF1b3RlX3BsdXModXJsKSsiJm1vZGU9Iittb2RlCiAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICB1ICs9ICImcmVnZXhzPSIrcmVnZXhzCiAgICAgICAgaWYgbm90IHNldENvb2tpZSA9PSAnJzoKICAgICAgICAgICAgdSArPSAiJnNldENvb2tpZT0iK3VybGxpYi5xdW90ZV9wbHVzKHNldENvb2tpZSkKICAKICAgICAgICBpZiBkYXRlID09ICcnOgogICAgICAgICAgICBkYXRlID0gTm9uZQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRlc2NyaXB0aW9uICs9ICdcblxuRGF0ZTogJXMnICVkYXRlCiAgICAgICAgbGl6PXhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPSJEZWZhdWx0VmlkZW8ucG5nIiwgdGh1bWJuYWlsSW1hZ2U9aWNvbmltYWdlKQogICAgICAgIGxpei5zZXRJbmZvKHR5cGU9IlZpZGVvIiwgaW5mb0xhYmVscz17ICJUaXRsZSI6IG5hbWUsICJQbG90IjogZGVzY3JpcHRpb24sICJHZW5yZSI6IGdlbnJlLCAiZGF0ZWFkZGVkIjogZGF0ZSB9KQogICAgICAgIGxpei5zZXRQcm9wZXJ0eSgiRmFuYXJ0X0ltYWdlIiwgZmFuYXJ0KQogICAgICAgIAogICAgICAgIGlmIChub3QgcGxheV9saXN0KSBhbmQgbm90IGFueSh4IGluIHVybCBmb3IgeCBpbiBnX2lnbm9yZVNldFJlc29sdmVkKTojICAobm90IHVybC5zdGFydHN3aXRoKCdwbHVnaW46Ly9wbHVnaW4udmlkZW8uZjRtVGVzdGVyJykpOgogICAgICAgICAgICBpZiByZWdleHM6CiAgICAgICAgICAgICAgICBpZiAnJHB5RnVuY3Rpb246cGxheW1lZGlhKCcgbm90IGluIHVybGxpYi51bnF1b3RlX3BsdXMocmVnZXhzKSBhbmQgJ25vdHBsYXlhYmxlJyBub3QgaW4gdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpICA6CiAgICAgICAgICAgICAgICAgICAgI3ByaW50ICdzZXR0aW5nIGlzcGxheWFibGUnLHVybCwgdXJsbGliLnVucXVvdGVfcGx1cyhyZWdleHMpLHVybAogICAgICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnSXNQbGF5YWJsZScsICd0cnVlJykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGxpei5zZXRQcm9wZXJ0eSgnSXNQbGF5YWJsZScsICd0cnVlJykKICAgICAgICBlbHNlOgogICAgICAgICAgICBhZGRvbl9sb2coICdOT1Qgc2V0dGluZyBpc3BsYXlhYmxlJyt1cmwpCiAgICAgICAKICAgICAgICBpZiBzaG93Y29udGV4dDoKICAgICAgICAgICAgY29udGV4dE1lbnUgPSBbXQogICAgICAgICAgICBpZiBzaG93Y29udGV4dCA9PSAnZmF2JzoKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAoJ1JlbW92ZSBmcm9tIEFkZC1vbiBGYXZvcml0ZXMnLCdYQk1DLlJ1blBsdWdpbiglcz9tb2RlPTYmbmFtZT0lcyknCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpKSkKICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbGlmIG5vdCBuYW1lIGluIEZBVjoKICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgPSAoCiAgICAgICAgICAgICAgICAgICAgJyVzP21vZGU9NSZuYW1lPSVzJnVybD0lcyZpY29uaW1hZ2U9JXMmZmFuYXJ0PSVzJmZhdl9tb2RlPTAnCiAgICAgICAgICAgICAgICAgICAgJShzeXMuYXJndlswXSwgdXJsbGliLnF1b3RlX3BsdXMobmFtZSksIHVybGxpYi5xdW90ZV9wbHVzKHVybCksIHVybGxpYi5xdW90ZV9wbHVzKGljb25pbWFnZSksIHVybGxpYi5xdW90ZV9wbHVzKGZhbmFydCkpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgaWYgcGxheWxpc3Q6CiAgICAgICAgICAgICAgICAgICAgZmF2X3BhcmFtcyArPSAncGxheWxpc3Q9Jyt1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKQogICAgICAgICAgICAgICAgaWYgcmVnZXhzOgogICAgICAgICAgICAgICAgICAgIGZhdl9wYXJhbXMgKz0gIiZyZWdleHM9IityZWdleHMKICAgICAgICAgICAgICAgIGNvbnRleHRNZW51LmFwcGVuZCgoJ0FkZCB0byBBZGQtb24gRmF2b3JpdGVzJywnWEJNQy5SdW5QbHVnaW4oJXMpJyAlZmF2X3BhcmFtcykpCiAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51KQogICAgICAgCiAgICAgICAgaWYgbm90IHBsYXlsaXN0IGlzIE5vbmU6CiAgICAgICAgICAgIGlmIGFkZG9uLmdldFNldHRpbmcoJ2FkZF9wbGF5bGlzdCcpID09ICJmYWxzZSI6CiAgICAgICAgICAgICAgICBwbGF5bGlzdF9uYW1lID0gbmFtZS5zcGxpdCgnKSAnKVsxXQogICAgICAgICAgICAgICAgY29udGV4dE1lbnVfID0gWwogICAgICAgICAgICAgICAgICAgICgnUGxheSAnK3BsYXlsaXN0X25hbWUrJyBQbGF5TGlzdCcsJ1hCTUMuUnVuUGx1Z2luKCVzP21vZGU9MTMmbmFtZT0lcyZwbGF5bGlzdD0lcyknCiAgICAgICAgICAgICAgICAgICAgICUoc3lzLmFyZ3ZbMF0sIHVybGxpYi5xdW90ZV9wbHVzKHBsYXlsaXN0X25hbWUpLCB1cmxsaWIucXVvdGVfcGx1cyhzdHIocGxheWxpc3QpLnJlcGxhY2UoJywnLCd8fCcpKSkpCiAgICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgIGxpei5hZGRDb250ZXh0TWVudUl0ZW1zKGNvbnRleHRNZW51XykKICAgICAgICAjcHJpbnQgJ2FkZGluZycsbmFtZQogIyAgICAgICBwcmludCB1cmwsdG90YWxpdGVtcwogICAgICAgIG9rPXhibWNwbHVnaW4uYWRkRGlyZWN0b3J5SXRlbShoYW5kbGU9aW50KHN5cy5hcmd2WzFdKSx1cmw9dSxsaXN0aXRlbT1saXosdG90YWxJdGVtcz10b3RhbCkKICAgICAgICAjcHJpbnQgJ2FkZGVkJyxuYW1lCiAgICAgICAgcmV0dXJuIG9rCgpkZWYgcGxheXNldHJlc29sdmVkKHVybCxuYW1lLGljb25pbWFnZSxzZXRyZXNvbHZlZD1UcnVlKToKICAgIGlmIHNldHJlc29sdmVkOgogICAgICAgIGxpeiA9IHhibWNndWkuTGlzdEl0ZW0obmFtZSwgaWNvbkltYWdlPWljb25pbWFnZSkKICAgICAgICBsaXouc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHM9eydUaXRsZSc6bmFtZX0pCiAgICAgICAgbGl6LnNldFByb3BlcnR5KCJJc1BsYXlhYmxlIiwidHJ1ZSIpCiAgICAgICAgbGl6LnNldFBhdGgoc3RyKHVybCkpCiAgICAgICAgeGJtY3BsdWdpbi5zZXRSZXNvbHZlZFVybChpbnQoc3lzLmFyZ3ZbMV0pLCBUcnVlLCBsaXopCiAgICBlbHNlOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oJ1hCTUMuUnVuUGx1Z2luKCcrdXJsKycpJykgICAgICAKCgojIyBUaGFua3MgdG8gZGFzY2hhY2thLCBhbiBlcGcgc2NyYXBlciBmb3IgaHR0cDovL2kudGVsZWJveS5jaC9wcm9ncmFtbS9zdGF0aW9uX3NlbGVjdC5waHAKIyMgIGh0dHA6Ly9mb3J1bS54Ym1jLm9yZy9wb3N0LnBocD9wPTkzNjIyOCZwb3N0Y291bnQ9MTA3NgpkZWYgZ2V0ZXBnKGxpbmspOgogICAgICAgIHVybD11cmxsaWIudXJsb3BlbihsaW5rKQogICAgICAgIHNvdXJjZT11cmwucmVhZCgpCiAgICAgICAgdXJsLmNsb3NlKCkKICAgICAgICBzb3VyY2UyID0gc291cmNlLnNwbGl0KCJKZXR6dCIpCiAgICAgICAgc291cmNlMyA9IHNvdXJjZTJbMV0uc3BsaXQoJ3Byb2dyYW1tL2RldGFpbC5waHA/Y29uc3RfaWQ9JykKICAgICAgICBzb3VyY2V1aHJ6ZWl0ID0gc291cmNlM1sxXS5zcGxpdCgnPGJyIC8+PGEgaHJlZj0iLycpCiAgICAgICAgbm93dGltZSA9IHNvdXJjZXVocnplaXRbMF1bNDA6bGVuKHNvdXJjZXVocnplaXRbMF0pXQogICAgICAgIHNvdXJjZXRpdGxlID0gc291cmNlM1syXS5zcGxpdCgiPC9hPjwvcD48L2Rpdj4iKQogICAgICAgIG5vd3RpdGxlID0gc291cmNldGl0bGVbMF1bMTc6bGVuKHNvdXJjZXRpdGxlWzBdKV0KICAgICAgICBub3d0aXRsZSA9IG5vd3RpdGxlLmVuY29kZSgndXRmLTgnKQogICAgICAgIHJldHVybiAiICAtICIrbm93dGl0bGUrIiAtICIrbm93dGltZQoKCmRlZiBnZXRfZXBnKHVybCwgcmVnZXgpOgogICAgICAgIGRhdGEgPSBtYWtlUmVxdWVzdCh1cmwpCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpdGVtID0gcmUuZmluZGFsbChyZWdleCwgZGF0YSlbMF0KICAgICAgICAgICAgcmV0dXJuIGl0ZW0KICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIGFkZG9uX2xvZygncmVnZXggZmFpbGVkJykKICAgICAgICAgICAgYWRkb25fbG9nKHJlZ2V4KQogICAgICAgICAgICByZXR1cm4KCgp4Ym1jcGx1Z2luLnNldENvbnRlbnQoaW50KHN5cy5hcmd2WzFdKSwgJ21vdmllcycpCgp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9VTlNPUlRFRCkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9MQUJFTCkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICB4Ym1jcGx1Z2luLmFkZFNvcnRNZXRob2QoaW50KHN5cy5hcmd2WzFdKSwgeGJtY3BsdWdpbi5TT1JUX01FVEhPRF9EQVRFKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIHhibWNwbHVnaW4uYWRkU29ydE1ldGhvZChpbnQoc3lzLmFyZ3ZbMV0pLCB4Ym1jcGx1Z2luLlNPUlRfTUVUSE9EX0dFTlJFKQpleGNlcHQ6CiAgICBwYXNzCgpwYXJhbXM9Z2V0X3BhcmFtcygpCgp1cmw9Tm9uZQpuYW1lPU5vbmUKbW9kZT1Ob25lCnBsYXlsaXN0PU5vbmUKaWNvbmltYWdlPU5vbmUKZmFuYXJ0PUZBTkFSVApwbGF5bGlzdD1Ob25lCmZhdl9tb2RlPU5vbmUKcmVnZXhzPU5vbmUKCnRyeToKICAgIHVybD11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sidXJsIl0pLmRlY29kZSgndXRmLTgnKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIG5hbWU9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbIm5hbWUiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICBpY29uaW1hZ2U9dXJsbGliLnVucXVvdGVfcGx1cyhwYXJhbXNbImljb25pbWFnZSJdKQpleGNlcHQ6CiAgICBwYXNzCnRyeToKICAgIGZhbmFydD11cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1siZmFuYXJ0Il0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgbW9kZT1pbnQocGFyYW1zWyJtb2RlIl0pCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgcGxheWxpc3Q9ZXZhbCh1cmxsaWIudW5xdW90ZV9wbHVzKHBhcmFtc1sicGxheWxpc3QiXSkucmVwbGFjZSgnfHwnLCcsJykpCmV4Y2VwdDoKICAgIHBhc3MKdHJ5OgogICAgZmF2X21vZGU9aW50KHBhcmFtc1siZmF2X21vZGUiXSkKZXhjZXB0OgogICAgcGFzcwp0cnk6CiAgICByZWdleHM9cGFyYW1zWyJyZWdleHMiXQpleGNlcHQ6CiAgICBwYXNzCgphZGRvbl9sb2coIk1vZGU6ICIrc3RyKG1vZGUpKQppZiBub3QgdXJsIGlzIE5vbmU6CiAgICBhZGRvbl9sb2coIlVSTDogIitzdHIodXJsLmVuY29kZSgndXRmLTgnKSkpCmFkZG9uX2xvZygiTmFtZTogIitzdHIobmFtZSkpCgppZiBtb2RlPT1Ob25lOgogICAgYWRkb25fbG9nKCJJbmRleCIpCiAgICBTS2luZGV4KCkJCgplbGlmIG1vZGU9PTE6CiAgICBhZGRvbl9sb2coImdldERhdGEiKQogICAgZ2V0RGF0YSh1cmwsZmFuYXJ0KQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT0yOgogICAgYWRkb25fbG9nKCJnZXRDaGFubmVsSXRlbXMiKQogICAgZ2V0Q2hhbm5lbEl0ZW1zKG5hbWUsdXJsLGZhbmFydCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MzoKICAgIGFkZG9uX2xvZygiZ2V0U3ViQ2hhbm5lbEl0ZW1zIikKICAgIGdldFN1YkNoYW5uZWxJdGVtcyhuYW1lLHVybCxmYW5hcnQpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTQ6CiAgICBhZGRvbl9sb2coImdldEZhdm9yaXRlcyIpCiAgICBnZXRGYXZvcml0ZXMoKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQoKZWxpZiBtb2RlPT01OgogICAgYWRkb25fbG9nKCJhZGRGYXZvcml0ZSIpCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJ1xcICcpWzFdCiAgICBleGNlcHQ6CiAgICAgICAgcGFzcwogICAgdHJ5OgogICAgICAgIG5hbWUgPSBuYW1lLnNwbGl0KCcgIC0gJylbMF0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICBhZGRGYXZvcml0ZShuYW1lLHVybCxpY29uaW1hZ2UsZmFuYXJ0LGZhdl9tb2RlKQoKZWxpZiBtb2RlPT02OgogICAgYWRkb25fbG9nKCJybUZhdm9yaXRlIikKICAgIHRyeToKICAgICAgICBuYW1lID0gbmFtZS5zcGxpdCgnXFwgJylbMV0KICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICB0cnk6CiAgICAgICAgbmFtZSA9IG5hbWUuc3BsaXQoJyAgLSAnKVswXQogICAgZXhjZXB0OgogICAgICAgIHBhc3MKICAgIHJtRmF2b3JpdGUobmFtZSkKCmVsaWYgbW9kZT09NzoKICAgIGFkZG9uX2xvZygiYWRkU291cmNlIikKICAgIGFkZFNvdXJjZSh1cmwpCgplbGlmIG1vZGU9PTg6CiAgICBhZGRvbl9sb2coInJtU291cmNlIikKICAgIHJtU291cmNlKG5hbWUpCgplbGlmIG1vZGU9PTk6CiAgICBhZGRvbl9sb2coImRvd25sb2FkX2ZpbGUiKQogICAgZG93bmxvYWRfZmlsZShuYW1lLCB1cmwpCgplbGlmIG1vZGU9PTEwOgogICAgYWRkb25fbG9nKCJnZXRDb21tdW5pdHlTb3VyY2VzIikKICAgIGdldENvbW11bml0eVNvdXJjZXMoKQoKZWxpZiBtb2RlPT0xMToKICAgIGFkZG9uX2xvZygiYWRkU291cmNlIikKICAgIGFkZFNvdXJjZSh1cmwpCgplbGlmIG1vZGU9PTEyOgogICAgYWRkb25fbG9nKCJzZXRSZXNvbHZlZFVybCIpCiAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoInBsdWdpbjovL3BsdWdpbiIpIG9yIG5vdCBhbnkoeCBpbiB1cmwgZm9yIHggaW4gZ19pZ25vcmVTZXRSZXNvbHZlZCk6I25vdCB1cmwuc3RhcnRzd2l0aCgicGx1Z2luOi8vcGx1Z2luLnZpZGVvLmY0bVRlc3RlciIpIDoKICAgICAgICBpdGVtID0geGJtY2d1aS5MaXN0SXRlbShwYXRoPXVybCkKICAgICAgICB4Ym1jcGx1Z2luLnNldFJlc29sdmVkVXJsKGludChzeXMuYXJndlsxXSksIFRydWUsIGl0ZW0pCiAgICBlbHNlOgogICAgICAgIHByaW50ICdOb3Qgc2V0dGluZyBzZXRSZXNvbHZlZFVybCcKICAgICAgICB4Ym1jLmV4ZWN1dGVidWlsdGluKCdYQk1DLlJ1blBsdWdpbignK3VybCsnKScpCgoKZWxpZiBtb2RlPT0xMzoKICAgIGFkZG9uX2xvZygicGxheV9wbGF5bGlzdCIpCiAgICBwbGF5X3BsYXlsaXN0KG5hbWUsIHBsYXlsaXN0KQoKZWxpZiBtb2RlPT0xNDoKICAgIGFkZG9uX2xvZygiZ2V0X3htbF9kYXRhYmFzZSIpCiAgICBnZXRfeG1sX2RhdGFiYXNlKHVybCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MTU6CiAgICBhZGRvbl9sb2coImJyb3dzZV94bWxfZGF0YWJhc2UiKQogICAgZ2V0X3htbF9kYXRhYmFzZSh1cmwsIFRydWUpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgplbGlmIG1vZGU9PTE2OgogICAgYWRkb25fbG9nKCJicm93c2VfY29tbXVuaXR5IikKICAgIGdldENvbW11bml0eVNvdXJjZXMoVHJ1ZSkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKCmVsaWYgbW9kZT09MTc6CiAgICBhZGRvbl9sb2coImdldFJlZ2V4UGFyc2VkIikKICAgIHVybCxzZXRyZXNvbHZlZCA9IGdldFJlZ2V4UGFyc2VkKHJlZ2V4cywgdXJsKQogICAgaWYgdXJsOgogICAgICAgIHBsYXlzZXRyZXNvbHZlZCh1cmwsbmFtZSxpY29uaW1hZ2Usc2V0cmVzb2x2ZWQpCiAgICBlbHNlOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKERlamFWdSxGYWlsZWQgdG8gZXh0cmFjdCByZWdleC4gLSAiKyJ0aGlzIisiLDQwMDAsIitpY29uKyIpIikKZWxpZiBtb2RlPT0xODoKICAgIGFkZG9uX2xvZygieW91dHViZWRsIikKICAgIHRyeToKICAgICAgICBpbXBvcnQgeW91dHViZWRsCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHhibWMuZXhlY3V0ZWJ1aWx0aW4oIlhCTUMuTm90aWZpY2F0aW9uKERlamFWdSxQbGVhc2UgW0NPTE9SIHllbGxvd11pbnN0YWxsIHRoZSBZb3V0dWJlIEFkZG9uWy9DT0xPUl0gbW9kdWxlICwxMDAwMCwiIikiKQogICAgc3RyZWFtX3VybD15b3V0dWJlZGwuc2luZ2xlX1lEKHVybCkKICAgIHBsYXlzZXRyZXNvbHZlZChzdHJlYW1fdXJsLG5hbWUsaWNvbmltYWdlKQplbGlmIG1vZGU9PTE5OgoJYWRkb25fbG9nKCJHZW5lc2lzY29tbW9ucmVzb2x2ZXJzIikKCXBsYXlzZXRyZXNvbHZlZCAodXJsc29sdmVyKHVybCksbmFtZSxpY29uaW1hZ2UsVHJ1ZSkJCgplbGlmIG1vZGU9PTIxOgogICAgYWRkb25fbG9nKCJkb3dubG9hZCBjdXJyZW50IGZpbGUgdXNpbmcgeW91dHViZS1kbCBzZXJ2aWNlIikKICAgIHl0ZGxfZG93bmxvYWQoJycsbmFtZSwndmlkZW8nKQplbGlmIG1vZGU9PTIzOgogICAgYWRkb25fbG9nKCJnZXQgaW5mbyB0aGVuIGRvd25sb2FkIikKICAgIHl0ZGxfZG93bmxvYWQodXJsLG5hbWUsJ3ZpZGVvJykgCmVsaWYgbW9kZT09MjQ6CiAgICBhZGRvbl9sb2coIkF1ZGlvIG9ubHkgeW91dHViZSBkb3dubG9hZCIpCiAgICB5dGRsX2Rvd25sb2FkKHVybCxuYW1lLCdhdWRpbycpCmVsaWYgbW9kZT09MjU6CiAgICBhZGRvbl9sb2coIllvdVR1YmUvRE1vdGlvbiIpCiAgICBzZWFyY2godXJsKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGU9PTI2OgogICAgYWRkb25fbG9nKCJZb3VUdWJlL0RNb3Rpb24gRnJvbSBTZWFyY2ggSGlzdG9yeSIpCiAgICBuYW1lID0gbmFtZS5zcGxpdCgnOicpCiAgICBzZWFyY2godXJsLHNlYXJjaF90ZXJtPW5hbWVbMV0pCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCmVsaWYgbW9kZT09Mjc6CiAgICBhZGRvbl9sb2coIlVzaW5nIElNREIgaWQgdG8gcGxheSBpbiBQdWxzYXIiKQogICAgcHVsc2FySU1EQj1zZWFyY2godXJsKQogICAgeGJtYy5QbGF5ZXIoKS5wbGF5KHB1bHNhcklNREIpIAplbGlmIG1vZGU9PTMwOgogICAgR2V0U3VibGlua3MobmFtZSx1cmwsaWNvbmltYWdlLGZhbmFydCkKZWxpZiBtb2RlPT0zMToKICAgIFdpekhETWVudSh1cmwsaWNvbmltYWdlLGZhbmFydCkKICAgIHhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkKZWxpZiBtb2RlPT0zMjoKCVdpel9HZXRfdXJsKHVybCkKCXhibWNwbHVnaW4uZW5kT2ZEaXJlY3RvcnkoaW50KHN5cy5hcmd2WzFdKSkJCgkKZWxpZiBtb2RlPT00MDoKICAgIFNlYXJjaENoYW5uZWxzKCkKICAgIFNldFZpZXdUaHVtYm5haWwoKQogICAgeGJtY3BsdWdpbi5lbmRPZkRpcmVjdG9yeShpbnQoc3lzLmFyZ3ZbMV0pKQplbGlmIG1vZGUgPT0gNDEgOiAKICAgIFNlYXJjaF9pbnB1dCh1cmwpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkpCgkKZWxpZiBtb2RlPT01MzoKICAgIGFkZG9uX2xvZygiUmVxdWVzdGluZyBKU09OLVJQQyBJdGVtcyIpCiAgICBwbHVnaW5xdWVyeWJ5SlNPTih1cmwpCiAgICB4Ym1jcGx1Z2luLmVuZE9mRGlyZWN0b3J5KGludChzeXMuYXJndlsxXSkp')
